

<!DOCTYPE html>
<!--[if lt IE 9]>
<html class="no-js lt-ie9" lang="en" dir="ltr">
   <![endif]-->
   <!--[if gt IE 8]><!-->
   <html class="no-js" lang="en" dir="ltr">
      <!--<![endif]-->
      <head>
         <meta charset="utf-8">
         <!-- Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW) wet-boew.github.io/wet-boew/License-en.html / wet-boew.github.io/wet-boew/Licence-fr.html -->
         <title>Get ready to claim</title>
         <meta content="width=device-width,initial-scale=1" name="viewport">
         <meta name="robots" content="noindex, follow">
         <!-- Meta data -->
         <!-- Meta data-->
         <!-- Load closure template scripts -->
         
         <script type="text/javascript" src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_46/cdts/compiled/soyutils.js"></script>
         <script type="text/javascript" src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_46/cdts/compiled/wet-en.js"></script>
         <link href="https://test.canada.ca/covid-19-guidance/proto/css/alpha-beta-banner.css" rel="stylesheet">
         <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"/>
         <link href="https://www.canada.ca/etc/designs/canada/wet-boew/m%C3%A9li-m%C3%A9lo/2023-10-mount-revelstoke.min.css" rel="stylesheet">  
         <link href="https://cra-arc.gc.ca/wet-boew/css/custom/steps.css" rel="stylesheet">  
         <!-- Write closure template -->
         <script type="text/javascript">
            document.write(wet.builder.refTop({
            }));
         </script>
		  <style>
    /* Custom styles for demonstration */
    .example { font-family: monospace; background:#e0f7fa; color:#006064; padding:4px 8px; border-radius:4px; font-weight: bold; }
    .datepicker { margin-bottom: 1rem; }
    .visually-hidden { position: absolute; left: -10000px; top: auto; width: 1px; height: 1px; overflow: hidden; }
  </style>
        <style>
        /* increase width of dt */    
	.dl-horizontal dd {
	  padding-left: 30px;
	}
	
	@media screen and (max-width: 768px) {        
	.dl-horizontal dd {
	  padding-left: 0px;
	}
	}
	
	.dl-horizontal dt {
	  width: 180px;
	}
        </style>      
      </head>
      <body vocab="http://schema.org/" typeof="WebPage" class="experimental">
         <div id="def-top">
         </div>
         <!-- Write closure template -->
         <script type="text/javascript">
            var defTop = document.getElementById("def-top");
            defTop.outerHTML = wet.builder.top({
              lngLinks: [{
                lang: "fr",
                href: "#",
                text: "Français"
              }],
              breadcrumbs: [{
                title: "Canada.ca",
                href: "https://www.canada.ca/en.html"
              },{
                title: "Taxes",
                href: "index.html"
              },{
                title: "Income tax",
                href: "index.html"
              },{
                title: "Corporation income tax",
                href: "index.html"
              },{
                title: "Scientific Research and Experimental Development (SR&ED) tax incentives",
                href: "../index.html"
              }
              ],
              search: true,
              siteMenu: true,
              showPreContent: true
            });
         </script>

         <main role="main" property="mainContentOfPage" class="container">

<nav class="provisional gc-subway"><div>
  <h1 id="gc-document-nav">Scientific Research and Experimental Development (SR&amp;ED) tax incentives</h1>


<div class="section">
                    <h3>Trusts</h3>
	<p><strong>Enter your tax year end to get your dates</strong></p>
	<form class="form-inline">

                    <div class="datepicker form-group">
                        <label class="wb-inv" for="trustYearEnd">Enter your tax year end to get your dates <span class="datepicker-format"> (<abbr title="Four digits year, dash, two digits month, dash, two digits day">YYYY-MM-DD</abbr>)</span></label>
                        <input type="date" id="trustYearEnd" aria-describedby="trustInfo" class="wb-date" />
                        <span id="trustInfo" class="visually-hidden">... details ...</span>
                    </div>
                    <button class="btn btn-primary btn-lg mrgn-lft-sm" type="button" onclick="calculateTrust()" class="btn btn-primary">Submit Trust Dates</button>
                    <div id="trustResults" aria-live="polite"></div>
	</form>
                </div>

                <div class="section">
                    <h3>Corporations</h3>
                    <div class="datepicker">
                        <label for="corpYearEnd">Select Corporation Tax Year-End:</label>
                        <input type="date" id="corpYearEnd" aria-describedby="corpInfo" class="wb-date" />
                        <span id="corpInfo" class="visually-hidden">... details ...</span>
                    </div>
                    <button type="button" onclick="calculateCorporation()" class="btn btn-primary">Submit Corporation Dates</button>
                    <div id="corpResults" aria-live="polite"></div>
                </div>





           
           <div id="def-preFooter"></div>
           <!-- Write closure template -->
           <script type="text/javascript">
               var defPreFooter = document.getElementById("def-preFooter");
               defPreFooter.outerHTML = wet.builder.preFooter({
               dateModified: "2020-03-13",
               showPostContent: true,
               showFeedback: true,
               showShare: true
               });
            </script>
         </main>
         <div id="def-footer">
         </div>
         <!-- Write closure template -->
         <script type="text/javascript">
            var defFooter = document.getElementById("def-footer");
            defFooter.outerHTML = wet.builder.footer({
            showFooter: true,
            showFeatures: true
            });
         </script>
         <!-- Write closure template -->
         <script type="text/javascript">
            document.write(wet.builder.refFooter({
            }));
         </script>
         <script src="https://test.canada.ca/covid-19-guidance/proto/js/alpha-banner.js"></script>
  <script>
    // --- Helper Functions Using UTC for Accuracy (Timezone-Safe) ---

    // Parses the input string (YYYY-MM-DD) into a Date object that is correct in UTC.
    function parseYearEnd(input) {
      const parts = input.split('-').map(Number);
      // Date.UTC(year, monthIndex, day)
      return new Date(Date.UTC(parts[0], parts[1] - 1, parts[2]));
    }

    // Adds a specific number of months reliably using UTC month methods.
    function addMonths(date, months) {
      const d = new Date(date);
      d.setUTCMonth(d.getUTCMonth() + months);
      return d;
    }

    // Adds a specific number of days accurately via millisecond manipulation.
    function addDaysExact(date, days) {
      return new Date(date.getTime() + days * 24 * 60 * 60 * 1000);
    }

    // Formats the Date object into the required YYYY-MM-DD string using UTC values.
    function formatDateUTC(d) {
      const year = d.getUTCFullYear();
      const month = String(d.getUTCMonth() + 1).padStart(2, '0');
      const day = String(d.getUTCDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    // Determines the last day of a month using UTC logic.
    function lastDayOfMonthUTC(year, monthIndex) {
      return new Date(Date.UTC(year, monthIndex + 1, 0)).getUTCDate();
    }

    // Computes the Corporation filing date based on the specific 6-month rules.
    function computeCorporationFilingDate(yearEnd) {
      const origYear = yearEnd.getUTCFullYear();
      const origMonth = yearEnd.getUTCMonth(); // 0-based
      const origDay = yearEnd.getUTCDate();

      // Calculate target month and year
      const totalMonths = origMonth + 6;
      const targetYear = origYear + Math.floor(totalMonths / 12);
      const targetMonth = totalMonths % 12; // 0-based

      const origLastDay = lastDayOfMonthUTC(origYear, origMonth);
      const targetLastDay = lastDayOfMonthUTC(targetYear, targetMonth);

      // Exception A: If original date is last day of original month -> last day of target month
      if (origDay === origLastDay) {
        return new Date(Date.UTC(targetYear, targetMonth, targetLastDay));
      }

      // Exception B (part 1): If the same numeric day exists in target month -> use it
      if (origDay <= targetLastDay) {
        return new Date(Date.UTC(targetYear, targetMonth, origDay));
      }

      // Exception B (part 2): Otherwise (e.g., 31 -> month with 30 days), use last day of target month
      return new Date(Date.UTC(targetYear, targetMonth, targetLastDay));
    }

    // --- Calculation Functions ---

    function calculateTrust() {
      // WET polyfill ensures .value is a YYYY-MM-DD string
      const input = document.getElementById("trustYearEnd").value;
      if (!input) { alert("Please select a Trust tax year-end."); return; }
      
      const yearEnd = parseYearEnd(input);

      // Requirement: Tax filing due date = 90 days after tax year-end
      const filing = addDaysExact(yearEnd, 90);
      
      // Requirement: Reporting deadline = 12 months after filing due date
      const reporting = addMonths(filing, 12);

      document.getElementById("trustResults").innerHTML = `
        <h4>Trust Deadlines:</h4>
        <p><strong>Tax filing due date (90 days after):</strong> <span class='example'>${formatDateUTC(filing)}</span></p>
        <p><strong>Reporting deadline (12 months after filing):</strong> <span class='example'>${formatDateUTC(reporting)}</span></p>
      `;
    }

    function calculateCorporation() {
      // WET polyfill ensures .value is a YYYY-MM-DD string
      const input = document.getElementById("corpYearEnd").value;
      if (!input) { alert("Please select a Corporation tax year-end."); return; }
      
      const yearEnd = parseYearEnd(input);

      // Requirement: Tax filing due date = 6 months after year-end, following Exceptions A/B
      const filing = computeCorporationFilingDate(yearEnd);
      
      // Requirement: Reporting deadline = 12 months after filing due date
      const reporting = addMonths(filing, 12);

      document.getElementById("corpResults").innerHTML = `
        <h4>Corporation Deadlines:</h4>
        <p><strong>Tax filing due date:</strong> <span class='example'>${formatDateUTC(filing)}</span></p>
        <p><strong>Reporting deadline (12 months after filing):</strong> <span class='example'>${formatDateUTC(reporting)}</span></p>
      `;
    }
    // You may also need to run WET initialization code if elements are added dynamically.
    // E.g., $(document).trigger('wb-ready.wb'); or similar WET-specific initialization.
  </script>
      </body>
   </html>
