<!DOCTYPE html>
<!--[if lt IE 9]>
<html class="no-js lt-ie9" lang="fr" dir="ltr">
   <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en" dir="ltr">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<!-- Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW) wet-boew.github.io/wet-boew/License-en.html / wet-boew.github.io/wet-boew/Licence-fr.html -->
<title>Renseignez-vous sur les taux d'imposition progressifs et les tranches de revenu - Canada.ca</title>
<meta content="width=device-width,initial-scale=1" name="viewport">
<!-- Meta data --> 
<!-- Meta data--> 
<!-- Load closure template scripts --> 
<script type="text/javascript" src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v5_0_4/cdts/compiled/soyutils.js"></script> 
<script type="text/javascript" src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v5_0_4/cdts/compiled/wet-en.js"></script>
<link href="https://test.canada.ca/covid-19-guidance/proto/css/alpha-beta-banner.css" rel="stylesheet">
<link rel="stylesheet" href="https://wet-boew.github.io/themes-dist/GCWeb/GCWeb/méli-mélo/2025-12-mille-iles.css" />
<link href="https://www.canada.ca/etc/designs/canada/wet-boew/css/theme.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">

<!-- Write closure template --> 
<script type="text/javascript">
            document.write(wet.builder.refTop({
            }));
         </script>
<style>
/***** Font styling *****/
	.small {
		line-height: 1.44em;
}

/***** Table styling *****/
	.table>tbody>tr>th[scope=row] {
		vertical-align: middle;
		width: 20%;
	}
	.table>thead>tr>th[scope=col] {
		text-align: center;
	}
	td > div.range {
		display: flex;
		flex-direction: column-reverse;
		padding: 0px 20px;
		text-align: center;
	}
	td > div.range meter {
		display: block;
		height: 180px;
		margin-left: auto;
		margin-right: auto;
		position: relative;
		width: 50px;
		writing-mode: vertical-lr;
		transform:scaleY(-1);
	}
	@-moz-document url-prefix() {
		td > div.range meter {
			background: #f4f6f6;
			border: 1px solid black;
			transform: none;
			width: 50px;
		}
	}
	td > div.range meter::-webkit-meter-bar {
		border: 1px solid #333;
		height: 180px;
		width: 50px;
	}
	td > div.range meter::-moz-meter-bar {
		background: #2572b4;
		border-radius: 0px;
		height: 180px;
		width: 50px;
	}
	@media screen and (-webkit-min-device-pixel-ratio: 0) and (min-resolution: 0.001dpcm) {
		td > div.range meter {
			background-clip: content-box;
		}
		td > div.range meter::-webkit-meter-optimum-value {
			background: #2572b4;
		}
		td > div.range meter::-webkit-meter-bar {
			background: #f4f6f6;
		}
	}
	.active-cell, .prev-active {
		font-weight: bold;
	}
	.estimate-borders {
		border: 1px solid #2572b4;
		border-radius: 25px;
		display: inline-block;
		padding: 10px; 10px 10px 15px;
		width: 180px;
	}   
 /***** Range Input Styles *****/
	.wb-input-range {
		--HTooltipPos: 0px;
		--tooltipArrow: none;
	}
	.wb-input-range datalist {
		display: flex;
		justify-content: space-between;
	}
	.wb-input-range output.wb-input-range-tooltip, .wb-input-range div.wb-input-range-tooltip {
		background: #e3e3e3;
		border-radius: 6px;
		color: #333333;
		display: inline-block;
		font-size: 20px;
		line-height: 1.4em;
		min-width: 2em;
		padding-left: 6px;
		padding-right: 6px;
		position: relative;
		text-align: center;
		transform: translate(var(--HTooltipPos), 0px);
	}
	.wb-input-range output.wb-input-range-tooltip {
		height: 28px;
		top: -0.2em;
	}
	.wb-input-range div.wb-input-range-tooltip {
		top: -0.2em;
	}
	output.wb-input-range-tooltip {
		padding-top: 0px;
	}
	.wb-input-range output.wb-input-range-tooltip:before, .wb-input-range div.wb-input-range-tooltip:before {
		border-left: 5px solid transparent;
		border-right: 5px solid transparent;
		border-top: 10px var(--tooltipArrow) #e3e3e3;
		content: "";
		height: 0;
		left: 50%;
		margin-left: -4px;
		margin-top: -1px;
		position: absolute;
		top: 100%;
		width: 0;
	}
	.range-list {
		display: flex;
		justify-content: space-between;
		margin: 0px 2px;
		width: 100%;
	}
	.range-list span {
		font-size: 1em;
		padding: 0px 1px;
		text-align: center;
	}

      /*** webkit styles  ***/
	input[type="range"]::-webkit-slider-thumb {
		background-color: #335075;
		background-image: linear-gradient(to bottom, #335075, #26374A);
		border: none;
		border-radius: 1rem;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		transform: scale(1.5);
	}
	
/***** Sticky slider *****/
	.top-bar-stick {
		background-color: #fff;
		padding-top: 10px;
		position: sticky;
		top: -1px;
		z-index: 10;
	}
	#stickycontent {
		position: relative;
	}
	.wb-frmvld, form, fieldset, legend {
		display: contents;
	}

 /***** Class to prevent horizontal scroll of page inside tables *****/
	.tbl-hidden {
		font-size: 0px;
	}
	
/***** Plus signs *****/
	.float-plus {
		font-weight: bold;
		left: 0;
		position: absolute;
	}
	td.tax-amount {
		position: relative;
	}
	tbody>tr:last-child>td:first-of-type>span.float-plus {
		display:none;
	}
/***** Results link design *****/
	#summaryLink>a:target {
		scroll-margin-top: 170px;
	}
	
/***** Sizing of result *****/
	.grid-label  {
		font-size: 0.9em;
	}
	.grid-amount {
		font-size: 1em;
	}
	.grid-percent {
		font-size: 0.8em;
	}
	@media (min-width: 768px)
	{
		.wb-math-grid div.mg-row > div.mg-cell {
			padding: 10px 0px 10px 0px;
		}
		.grid-label {
			font-size: 1.2em;
		}
		.grid-amount {
			font-size: 2em;
		}
		.grid-percent {
			font-size: 1.3em;
		}
	}	
</style>
	
</head>
<body vocab="http://schema.org/" typeof="WebPage">
<div id="def-top"> </div>
<!-- Write closure template --> 
<script type="text/javascript">
            var defTop = document.getElementById("def-top");
            defTop.outerHTML = wet.builder.top({
            	lngLinks: [{
            		lang: "en",
            		href: "index.html",
            		text: "English"
            	}],
            	breadcrumbs: [{
                title: "Canada.ca",
                href: "https://www.canada.ca/fr.html"
              },{
                title: "Impôts",
                href: "https://www.canada.ca/fr/services/impots.html"
              },{
                title: "Impôt sur le revenu",
                href: "https://www.canada.ca/fr/services/impots/impot-sur-le-revenu.html"
              },{
                title: "Impôt sur le revenu des particuliers",
                href: "https://www.canada.ca/fr/services/impots/impot-sur-le-revenu/impot-sur-le-revenu-des-particuliers.html"
              },{
                title: "Taux d’imposition et tranches de revenu pour les particuliers",
                href: "https://www.canada.ca/fr/agence-revenu/services/impot/particuliers/foire-questions-particuliers/taux-imposition-canadiens-particuliers-annee-courante-annees-passees.html"
              }
              ],
              search: true,
              siteMenu: true,
              showPreContent: true
            });
         </script>
<main role="main" property="mainContentOfPage" class="container">
<h1 property="name" id="wb-cont">Renseignez-vous sur les taux d'imposition progressifs et les tranches de revenu</h1>
<noscript>
<div class="alert alert-warning">
<h2>Cette page nécessite JavaScript</h2>
<p>L’outil sur cette page nécessite JavaScript et un navigateur moderne pour fonctionner. Veuillez vous assurer que votre navigateur est à jour et activer JavaScript.</p>
</noscript>
<p>Ce tableau  interactif utilise les taux de l’année d’imposition <strong id="jsonYear"></strong>.</p>
<p>Le tableau vous montre comment fonctionnent les tranches d’imposition et les taux d’imposition progressifs au Canada et dans chaque province et territoire (sauf au Québec).</p>
<div class="wb-dismissable" id="accessibility-alert">
	<div class="pull-left"><span class="fas fa-arrows-alt-h fa-2x pr-2"></span></div>
	<div class="pl-2 brdr-lft d-flex">
		<p>Le tableau peut utiliser un défilement horizontal avec animation pour montrer comment les taux d'imposition augmentent au fil du temps.</p>
    </div>
  </div>
	<p><span class="mrgn-rght-sm glyphicon glyphicon-exclamation-sign"><span class="wb-inv">Attention :</span></span><strong>Ces renseignements vous sont présentés à des fins éducatives seulement</strong>. Ne les utilisez pas pour calculer votre montant d’impôt réel.</p>
<div class="row">
  <div class="col-xs-12">
    <section class="panel panel-default brdr-rds-0 mrgn-tp-lg nojs-hide">
      <header class="panel-heading">
        <h2 class="panel-title mrgn-tp-md mrgn-bttm-md">Estimez votre impôt à payer</h2>
      </header>
      <div class="fa-stack fa-fw text-muted center-block pstn-tp-xs pstn-lft-xs fa-lg full-width" aria-hidden="true"><span class="fas fa-circle fa-inverse fa-stack-2x"></span> <span class="far fa-circle fa-stack-2x"></span> <span class="far fa-chart-bar fa-stack-1x"></span> </div>
      <div class="panel-body pb-4 px-2">
        <div id="stickycontent">
          <form id="barChart">
            <fieldset class="brdr-0">
              <legend class="h4"><span class="fa-stack" aria-hidden="true"><span class="far fa-circle fa-stack-2x"></span><span class="fa-stack-1x">1</span></span> <span class="wb-inv">Première étape : </span>Sélectionnez une province ou un territoire</legend>
              <p class="mrgn-lft-xl">Les taux d’imposition varient d’une province ou d’un territoire à l’autre au Canada.</p>
              <div class="row panel-body mrgn-bttm-md mrgn-tp-md">
                <div class="dropdown-container col-md-4">
                  <label for="provinceSelect" class="wb-inv">Province ou un territoire</label>
                  <select id="provinceSelect" class="form-control input-lg">
                    <option disabled="disabled" selected="selected" value="">Sélectionner</option>
                  </select>
                </div>
              </div>
            </fieldset>
            <fieldset  id="incomeSliderDesign" class="brdr-0">
              <legend class="h4"><span class="fa-stack" aria-hidden="true"><span class="far fa-circle fa-stack-2x"></span><span class="fa-stack-1x">2</span></span> <span class="wb-inv">Deuxième étape : </span>Inscrivez un montant de revenu<span class="wb-inv"> à l'aide d'une barre de défilement ou d'une boîte de saisie</span></legend>
              <p class="mrgn-lft-xl">Passez de la <strong>barre de défilement </strong> (par paliers de revenu de <span class="nowrap">2 000 $</span>) au <strong>champ de saisie</strong> pour augmenter ou diminuer un montant.</p>
              <div class="top-bar-stick">
                <div class="wb-input-range brdr-rds-0">
                  <div class="row panel-body d-sm-flex">
                    <div class="px-2">
                      <div class="pt-3 hidden-xs"></div>
                      <div class="btn-group d-flex" id="btnSelect">
                        <button id="toggleSlider" class="btn btn-lg btn-default btn-primary btn-toggle" aria-pressed="true" type="button" title="Barre de défilement des paliers de revenu : cliquez sur l’onglet pour sélectionner la case de saisie"><span class="h4">Défilement</span></button>
                        <button id="toggleInput" class="btn btn-lg btn-default btn-toggle" aria-pressed="false" type="button" title="Case de saisie : cliquez sur l’onglet pour sélectionner la barre de défilement des paliers de revenu"><span class="h4">aisie</span></button>
                      </div>
                    </div>
                    <div class="col-xs-10 col-sm-5 col-md-3 px-2 btn-toggle-value hidden" id="toggleInputValue">
                      <label for="incomeInput" class="wb-inv">Champ de saisie pour inscrire le montant en dollars (par paliers de 2 000 $), sans les cents</label>
                      <div class="input-group align-self-center pt-3">
                        <input id="incomeInput" name="incomeAmount" type="number" class="form-control input-lg text-right" value="0" min="0" step="2000" aria-invalid="false" pattern="\d*">
                        <span class="input-group-addon">.00 $</span> </div>
                      <p class="small" aria-hidden="true">La limite du tableau est de <span class="rangelist-max"></span></p>
                    </div>
                    <div class="clearfix visible-xs mrgn-tp-md"></div>
                    <div class="full-width px-2 btn-toggle-value" id="toggleSliderValue">
                      <div class="slider-group align-self-center">
                        <label for="incomeSlider" class="wb-inv" id="incomeSliderLabel">Barre de défilement des paliers de revenu de 0 $ à 400 000 $</label>
                        <div id="incomeTooltip" class="wb-input-range-tooltip" aria-hidden="true"  data-wb-input-range="{&quot;fn&quot;: &quot;currencyFormatter.format&quot;}"> 0 $ </div>
                        <input id="incomeSlider" class="form-range mrgn-tp-sm" type="range" min="0" max="400000" list="amountTicks" value="0" step="2000" name="incomeAmount"  data-wb-input-range="{&quot;target&quot;: [&quot;incomeSlider&quot;, &quot;incomeTooltip&quot;]}" aria-labelledby="incomeTooltip" aria-valuenow="">
                        <datalist id="amountTicks" class="hidden">
                          <option value="0"></option>
                          <option value="200000"></option>
                          <option value="400000"></option>
                          <option value="600000"></option>
                          <option value="800000"></option>
                          <option value="1000000"></option>
                          <option value="1200000"></option>
                        </datalist>
                        <div class="range-list"> <span>0 $</span> <span class="rangelist-max"></span> </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </fieldset>
          </form>
          <p class="small invisible" id="summaryLink"><a href="#summary"><span class="glyphicon glyphicon-arrow-down mrgn-rght-sm"></span>Allez au sommaire</a></p>
          <div id="federalTableWrapper" class="hidden mrgn-bttm-xl">
            <h3 id="results" class="h2">Sommaire de l’impôt progressif</h3>
            <h4 id="federalTableCaption" class="h5"><img src="https://www.canada.ca/content/dam/cra-arc/images/flag-ca.png" alt="" class="mrgn-rght-md">Fédéral <span class="based-income"></span></h4>
            <div id="federalScroll" class="table-responsive table-scroll">
              <table class="table pb-2 text-center" id="federalTable" aria-describedby="federalTableCaption">
                <caption class="wb-inv">
                Fédéral
                </caption>
                <thead id="federalHeader">
                  <tr> </tr>
                </thead>
                <tbody id="federalBody">
                  <tr></tr>
                </tbody>
              </table>
            </div>
            <div class="tax-total d-sm-flex" id="federalTotal"></div>
          </div>
          <div id="provinceTableWrapper" class="hidden" >
            <h4 id="provinceTableCaption" class="h5"><span id="provinceFlag"></span><span id="provinceTitle">Provinciale</span> <span class="based-income"></span></h4>
            <div id="provinceScroll" class="table-responsive table-scroll">
              <table class="table pb-2 text-center" id="provinceTable" aria-describedby="provinceTableCaption">
                <caption class="wb-inv">
                Province ou territoire sélectionné
                </caption>
                <thead id="provinceHeader">
                  <tr> </tr>
                </thead>
                <tbody id="provinceBody">
                  <tr></tr>
                </tbody>
              </table>
            </div>
            <div class="tax-total d-sm-flex" id="provinceTotal"></div>
          </div>
          <div id="quebecNotice">
            <p><img src="https://www.canada.ca/content/dam/cra-arc/images/flag-qc.png" alt="" class="mrgn-rght-md">Pour connaître les taux d’imposition du Québec, veuillez visiter le site officiel de  <a href="https://www.revenuquebec.ca/fr/citoyens/declaration-de-revenus/produire-votre-declaration-de-revenus/taux-dimposition/" target="_blank">Revenu Québec</a></p>
          </div>
          <section id="afterTaxWrapper">
            <div class="row">
              <div class="col-sm-10 col-md-7">
                <div class="panel panel-primary mrgn-tp-lg">
                  <header class="panel-heading">
                    <h3 class="mrgn-bttm-0 panel-title">Répartition de l'impôt</h3>
                    <p class="gc-byline mrgn-bttm-0">Arrondi au dollar près</p>
                  </header>
                  <div class="panel-body">
                    <div class="wb-math-grid mg-spcd">
                      <div class="mg-row">
                        <div class="mg-cell pr-1 grid-label">Fédéral</div>
                        <div class="mg-cell"></div>
                        <div class="mg-cell text-right text-primary grid-amount" id="fedTaxCal">0&nbsp;$</div>
                        <div id="fedTaxPC"  class="mg-cell grid-percent text-right text-primary nowrap pl-1">(0&nbsp;<sup>%</sup>)</div>
                      </div>
                      <div class="mg-row">
                        <div class="mg-cell grid-label pr-1 align-bottom pb-1" id="provTaxName">Provinciale</div>
                        <div class="mg-cell grid-amount text-primary align-bottom pr-1 pb-1">+</div>
                        <div class="mg-cell text-right grid-amount text-primary align-bottom pb-1" id="provTaxCal">0&nbsp;$</div>
                        <div id="provTaxPC" class="mg-cell grid-percent text-right text-primary align-bottom nowrap pl-1 pb-1">(0&nbsp;<sup>%</sup>)</div>
                      </div>
                      <div class="mg-row">
                        <div class="mg-cell grid-label pr-1">Total</div>
                        <div class="mg-cell mg-brdr-tp grid-amount text-primary pr-1">=</div>
                        <div class="mg-cell pt-2 mg-brdr-tp text-right grid-amount text-primary" id="totalTaxCal">0&nbsp;$</div>
                        <div id="totalTaxPC" class="mg-cell grid-percent text-right text-primary nowrap pl-1">(0&nbsp;<sup>%</sup>)</div>
                      </div>
                    </div>
                    <p class="small mrgn-tp-md">Ce montant ne comprend pas les crédits, les prestations ou les déductions des provinces ou territoires auxquels vous pourriez avoir droit.</p>
                  </div>
                </div>
              </div>
            </div>
            <p><span class="mrgn-rght-sm glyphicon glyphicon-exclamation-sign"><span class="wb-inv">Attention :</span></span>: Il se peut  que ces montants ne reflètent pas avec précision ce que vous payez en impôts. Ne les utilisez pas pour déterminer votre impôt réel à payer.</p>
          </section>
        </div>
        <section id="afterTaxHints" class="hidden">
          <div class="row wb-eqht-grd">
            <div class="col-md-7">
              <div class="row">
                <div class="col-xs-12">
                  <div class="panel panel-primary panel-body mrgn-tp-lg eqht-trgt brdr-rds-0">
                    <h4 class="h3 mrgn-tp-sm text-primary">Réduisez l’impôt que vous pourriez devoir.</h4>
                    <p>Vous pourriez demander diverses déductions, crédits et dépenses pour réduire le montant d’impôt que vous devez.</p>
                    <details class="mrgn-bttm-lg" role="button">
                      <summary>Exemple : Montant personnel de base (MPB)</summary>
                      <p>Le MPB est un crédit d’impôt non remboursable. Vous pourriez à la fois demander le MPB fédéral et celui provincial ou territorial.</p>
                      <p>Si vous demandez ce crédit dans votre déclaration de revenus, les deux MPB réduiront l’impôt sur votre revenu dans la première tranche d’imposition.</p>
                      <p>Pour plus de détails, allez à la page sur le  <a href="https://www.canada.ca/fr/agence-revenu/services/impot/particuliers/sujets/tout-votre-declaration-revenus/declaration-revenus/remplir-declaration-revenus/deductions-credits-depenses/ligne-30000-montant-personnel-base.html">montant personnel de base</a>.</p>
                    </details>
                    <p>Pour tous les types de déductions, allez à la page  <a href="https://www.canada.ca/fr/agence-revenu/services/impot/particuliers/sujets/tout-votre-declaration-revenus/declaration-revenus/remplir-declaration-revenus/deductions-credits-depenses.html">demander des déductions, des crédits et des dépenses</a>.</p>
                  </div>
                </div>
                <div class="col-xs-12 pstn-tp-xs text-right"> <span class="fa-stack fa-lg text-primary mrgn-rght-md"><span class="fa-stack-2x  fas fa-circle fa-inverse"></span> <span class="far fa-circle fa-stack-2x"></span><span class="fas fa-dollar-sign fa-stack-1x pr-2"></span><span class="fas fa-long-arrow-alt-down fa-stack-1x pl-3"></span> </span></div>
              </div>
            </div>
            <div class="col-md-5">
              <div class="row">
                <div class="col-xs-12">
                  <div class="panel panel-primary panel-body mrgn-tp-lg eqht-trgt brdr-rds-0">
                    <h4 class="h3 mrgn-tp-sm text-primary">Savoir où vont vos impôts</h4>
                    <p>Le gouvernement utilise les impôts qu’il perçoit pour financer les installations publiques, les programmes et les services que nous utilisons au Canada.</p>
                    <details class="mrgn-bttm-lg" role="button">
                      <summary>Exemples de choses que les impôts aident à financer</summary>
                      <div data-ajax-replace="https://www.canada.ca/en/revenue-agency/services/tax/individuals/educational-programs/purpose-taxes.html#programmes-servicespublics>.fa-ul"></div>
                    </details>
                    <p>Pour savoir comment  fonctionne notre régime fiscal, allez à la page  <a href="https://www.canada.ca/fr/agence-revenu/services/impot/particuliers/programmes-educatifs/quoi-servent-impots.html">à quoi servent les impôts </a>.</p>
                  </div>
                </div>
                <div class="col-xs-12 pstn-tp-xs text-right"> <span class="fa-stack fa-lg text-primary mrgn-rght-md"><span class="fa-stack-2x  fas fa-circle fa-inverse"></span> <span class="far fa-circle fa-stack-2x"></span><span class="fas fa-money-bill-wave fa-stack-1x"></span> </span></div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </section>
  </div>
</div>
<section id="errorMsg" class="mrgn-tp-lg">
  <p><span class="fas fa-exclamation fa-lg mrgn-rght-sm"></span>Erreur lors du chargement du script, tentez <a href="?">d’actualiser la page</a>.</p>
</section>
	<p><a href="?" value="Reset acessibility alert" onclick="localStorage.removeItem( 'accessibility-alert' );" class="small">Reset acessibility alert (remove before launch)</a></p>
  <div id="def-preFooter"> </div>

<!-- Write closure template --> 
<script type="text/javascript">
               var defPreFooter = document.getElementById("def-preFooter");
               defPreFooter.outerHTML = wet.builder.preFooter({
               	dateModified: "Julliet 14, 2025",
               	showPostContent: true,
               	showFeedback: true,
               	showShare: true
               });
            </script>
</main>
<div id="def-footer"> </div>
<!-- Write closure template --> 
<script type="text/javascript">
            var defFooter = document.getElementById("def-footer");
            defFooter.outerHTML = wet.builder.footer({
            	showFooter: true,
            	showFeatures: true
            });
         </script> 
<!-- Write closure template --> 
<script type="text/javascript">
            document.write(wet.builder.refFooter({
            }));
         </script>
  <script src="https://wet-boew.github.io/themes-dist/GCWeb/GCWeb/méli-mélo/2025-12-mille-iles.js"></script>
<script>
/**START Universal variables/functions**/
	var pagelang = document.documentElement.lang;
	function formatCurrency(amount) {
		const currencyFormatter = new Intl.NumberFormat(pagelang + "-CA", {
			style: "currency",
			currency: "CAD",
			minimumFractionDigits: 0,
			maximumFractionDigits: 0,
			roundingPriority: "auto",
			roundingMode: "trunc"
		});
		return currencyFormatter.format(amount);
	}
	/**END Universal variables/functions**/

/**START tooltip function**/
	(function ($, window, wb) {
		"use strict";
		var componentName = "wb-input-range",
			selector = "." + componentName,
			tooltipName = componentName + "-tooltip",
			initEvent = "wb-init" + selector,
			$document = wb.doc,
			defaults = {},
            pagelang = document.documentElement.lang,
			init = function (event) {
				var elm = wb.init(event, componentName, selector),
					$elm,
					settings;

				if (elm) {
					$elm = $(elm);
					// ... Do the plugin initialisation
					// Get the plugin JSON configuration set on attribute data-wb-input-range
					settings = $.extend(
						true,
						{},
						defaults,
						window[componentName],
						wb.getData($elm, componentName)
					);

					// Call my custom event
					$elm.trigger("wb-input-range", settings);
					// Identify that initialization has completed
					wb.ready($elm, componentName);
				}
			},
           
			getFuncValue = function (funcName, inputParam) {
				let funcArr, fnElem;

				if (funcName.includes(".") === true) {
					funcArr = funcName.split(".");
					fnElem = {};
					for (let i = 0; i <= funcArr.length - 1; i = i + 1) {
						if (i === 0) {
							fnElem = funcArr[i];
						} else if (i === funcArr.length - 1 && typeof window[fnElem] !== "undefined" && funcArr[i] in window[fnElem] && typeof window[fnElem][funcArr[i]] === "function") {
							return window[fnElem][funcArr[i]](inputParam);
						} else if (typeof window[fnElem] !== "undefined" && funcArr[i] in window[fnElem] === true) {
							fnElem = fnElem[funcArr[i]];
						}
					}
				} else if (typeof window[funcName] === "function") {
					return window[funcName](inputParam);
				}
				return inputParam;
			},
			attributeDefaultSet = function (atr, defaultVal) {
				if (atr === "") {
					return defaultVal;
				}
				return atr;
			},
			updateTooltipPos = function (inputRangeElm, displayElm, groupElm) {
				const thumbWidth = 14;
				const sideOffset = 4;
				let tooltipPos,
					inputMin = attributeDefaultSet(inputRangeElm.min, 0),
					inputMax = attributeDefaultSet(inputRangeElm.max, 100),
					inputRangeElmWidth = inputRangeElm.getBoundingClientRect().width,
					displayElmWidth = displayElm.getBoundingClientRect().width;

				if (displayElm.classList.contains(tooltipName)) {
					tooltipPos = (((inputRangeElm.valueAsNumber - Number(inputMin)) / (Number(inputMax) - Number(inputMin))) * ((inputRangeElm.getBoundingClientRect().width - (thumbWidth / 2)) - (thumbWidth / 2)));
					groupElm.style.setProperty("--tooltipArrow", "solid");
					tooltipPos = tooltipPos + (thumbWidth / 2) - (displayElmWidth / 2);
					if (tooltipPos < 0 && tooltipPos + displayElmWidth > inputRangeElmWidth) {
						// if tooltip is larger then slider track then center over slider track
						tooltipPos = (inputRangeElmWidth / 2) - (displayElmWidth / 2);
						groupElm.style.setProperty("--tooltipArrow", "none");
					} else if (tooltipPos <= 0 || inputRangeElmWidth === 0) {
						tooltipPos = -sideOffset;
						groupElm.style.setProperty("--tooltipArrow", "none");
					} else if (tooltipPos + displayElmWidth > inputRangeElmWidth) {
						tooltipPos = inputRangeElmWidth - displayElmWidth + sideOffset;
						groupElm.style.setProperty("--tooltipArrow", "none");
					}
					displayElm.style.setProperty("--HTooltipPos", tooltipPos + "px");
				}
			},
			updateValElm = function (inputRangeElm, displayElm, groupElm) {
				let displayText, outputData;

				if (displayElm !== null) {
					outputData = wb.getData(displayElm, "wb-input-range");
					if (typeof outputData !== "undefined" && Object.prototype.hasOwnProperty.call(outputData, "fn") === true) {
						displayText = getFuncValue(outputData.fn, inputRangeElm.value);
					} else {
						displayText = inputRangeElm.value;
					}
					if (displayElm.tagName === "INPUT" || displayElm.tagName === "TEXTAREA") {
						displayElm.value = displayText;
					} else {
						displayElm.textContent = formatCurrency(displayText);
						updateTooltipPos(inputRangeElm, displayElm, groupElm);
						window.onresize = function () {
							updateTooltipPos(inputRangeElm, displayElm, groupElm);
						};
					}
				}
			},
			setRangeValue = function (inputRange) {
				let groupElm = document.getElementById(inputRange.parentId),
					targetArr = wb.getData(inputRange, "wb-input-range");

				if (typeof targetArr !== "undefined" && Object.prototype.hasOwnProperty.call(targetArr, "target") === true) {
					targetArr.target.forEach(function (currentId) {
						updateValElm(inputRange, document.getElementById(currentId), groupElm);
					}, inputRange, groupElm);
				}
			},
			updateRangeFromField = function (elm) {
				let adjustedInputVal, outputData,
					elmMin = attributeDefaultSet(elm.min, 0),
					elmMax = attributeDefaultSet(elm.max, 100),
					elmStep = attributeDefaultSet(elm.step, 1),
					rangeElm = document.getElementById(elm.rangeId);
				outputData = wb.getData(elm, "wb-input-range");
				
				if (typeof outputData !== "undefined" && Object.prototype.hasOwnProperty.call(outputData, "fn") === true) {
					adjustedInputVal = getFuncValue(outputData.fn, parseInt($(elm).val(), 10));
				} else {
					adjustedInputVal = parseInt($(elm).val(), 10) || parseInt(elmMin, 10);
				}
				if (adjustedInputVal < parseInt(elmMin, 10)) {
					$(rangeElm).val(parseInt(elmMin, 10));
				} else if (adjustedInputVal > parseInt(elmMax, 10)) {
					$(rangeElm).val(parseInt(elmMax, 10));
				} else {
					$(rangeElm).val(Math.round(adjustedInputVal / parseInt(elmStep, 10)) * parseInt(elmStep, 10));
				}
			};
		// Add your plugin event handler
		$document.on("wb-input-range", selector, function (event, data) {
			var targetArr,
				groupElm = event.currentTarget,
				$rangeElm = $(groupElm).find("input[type=range]"),
				rangeElm = $rangeElm[0];
			rangeElm.params = [];
			rangeElm.params = data.target;
			
			if (!groupElm.hasAttribute("id")) {
				groupElm.id = wb.getId();
			}
			rangeElm.parentId = groupElm.id;
			setRangeValue(rangeElm);
			targetArr = wb.getData(rangeElm, "wb-input-range");
			
			if (typeof targetArr !== "undefined" && Object.prototype.hasOwnProperty.call(targetArr, "target") === true) {
				targetArr.target.forEach(function (currentId) {
					let displayElm = document.getElementById(currentId);

					if (displayElm !== null && (displayElm.tagName === "INPUT" || displayElm.tagName === "TEXTAREA")) {
						
						if (rangeElm.hasAttribute("id") === false) {
							rangeElm.id = wb.getId();
						}
						displayElm.rangeId = rangeElm.id;
						$(displayElm).on("change input", function () {
							
							let newTargetArr = targetArr.target.slice();
							updateRangeFromField(this);
							for (let i = 0; i <= newTargetArr.length - 1; i = i + 1) {
								if (document.getElementById(newTargetArr[i]).tagName !== "INPUT" && document.getElementById(newTargetArr[i]).tagName !== "TEXTAREA") {
									updateValElm(rangeElm, document.getElementById(newTargetArr[i]), document.getElementById(rangeElm.parentId));
								}
							}
						});
					} else {
						updateValElm(rangeElm, displayElm, groupElm);
					}
				}, rangeElm, groupElm, targetArr);
			}
		});
		$(".wb-input-range").on("change input", "input[type=range]", function () {
			setRangeValue(this);
		});
// disable mouse wheel scroll of slider which only occurs in some browsers
		$(".wb-input-range").on("wheel", "input[type=range]", function (event) {
			window.scrollTo(window.scrollX, window.scrollY + event.originalEvent.deltaY);
			event.preventDefault();
			event.stopPropagation();
		});

// prevent form submission from input element
	 $("#barChart").submit(function(e){
        e.preventDefault();
    });
		$document.on("update" + selector, function (event) {
			setRangeValue(event.target);
		});

		// Bind the init event of the plugin
		$document.on("timerpoke.wb " + initEvent, selector, init);
		// Add the timer poke to initialize the plugin
		wb.add(selector);
	})
		(jQuery, window, wb);
/**END tooltip function**/
	

/*START tax bracket script**/	
//Langauge arrays for dynamic language
	const langToggle = {
		dataTableHeader: {
			en: "based on",
			fr: "basé sur"
		},
		dataTaxBracket: {
			"en": "bracket",
			"fr": "Tranche de"
		},
		dataTaxRate: {
			en: "Tax rate",
			fr: "Taux d’imposition"
		},
		dataIncomeRange: {
			en: "Range<span class=\"wb-inv\"> per tax rate</span>",
			fr: "Palier<span class=\"wb-inv\"> par taux d'imposition</span>"
		},
		dataTaxEstimate: {
			en: "Tax payable per bracket",
			fr: "Impôt à payer par tranche"
		},
		dataMeterFill: {
			en: "meter bar is at: ",
			fr: "La barre de mesure est réglée à  :"
		},  
		dataTotalEstimate: {
			en: "Tax payable<br><small>before claiming deductions, credits and expenses</small>",
			fr: "Impôt à payer<br><small>avant de demander des déductions, crédits et dépensess</small>"
		},
		dataHiddenTo: {
			en: "to",
			fr: "à"
		},
		dataHiddenAndUp: {
			en: "and up",
			fr: "et plus"
		},
		dataSliderRange: {
			en: "Range slider (increments of $2,000): $0 to ",
			fr: "Curseur de plage (incréments de 2 000 $) : 0 à "
		}
	}
		
	const incomeSlider = document.getElementById('incomeSlider'),
		incomeInput = document.getElementById('incomeInput'),
		incomeInputs = document.querySelectorAll('#incomeSlider, #incomeInput'),
		provinceSelect = document.getElementById('provinceSelect'),
		basedIncome = document.querySelectorAll('.based-income'),
		resultsLink = document.getElementById('resultsLink'),
		percentFormatter = new Intl.NumberFormat(pagelang + "-CA", {
			style: "percent",
			minimumFractionDigits: 1,
			maximumFractionDigits: 1
		});    

	//Function to dynamically add date
	function dateFormatter(ymdDateString, mode = 'full') {
		// Create a Date object from the YYYY-MM-DD string.
		// The Date constructor can parse this format directly.
		const dateObject = new Date(ymdDateString);
		// Check if the dateObject is valid (in case of invalid input string)
		
		if (isNaN(dateObject.getTime())) {
			return "Invalid Date";
		}
		if (mode === 'year') {
			return dateObject.getUTCFullYear();
		}
		// Define options for locale-sensitive formatting
		const options = {
			timeZone: 'UTC',
			year: 'numeric',
			month: 'long', 
			day: 'numeric',
  };
if (pagelang == "fr") {
	return dateObject.toLocaleDateString('fr-CA', options);
} else {
	return dateObject.toLocaleDateString('en-CA', options);
};
	}
	
	let taxData = {};
	//Repeat function for UI on input change
	function refreshUI() {
    buildTables();
    setupScrollObserver('federalScroll');
    setupScrollObserver('provinceScroll');
}
	fetch('canada_tax_rates_alt.json')
		.then(response => {
			if (!response.ok) throw new Error(`HTTP error ${response.status}`);
			return	response.json()
		})
		.then(json => {
			// Get JSON date for conversion
			const dateValue = json.date;
			// const fullDate = document.getElementById('jsonDate'); commented out unless full date needed
			const yearDate = document.getElementById('jsonYear');
			yearDate.textContent = dateFormatter(dateValue, "year");
			// fullDate.textContent = dateFormatter(dateValue); commented out unless full date needed 
			//Convert to const data
			const data = json.data;
			//Parse region values to build brackets
			for (const region in data) {
				data[region].brackets.forEach(bracket => {
					if (bracket.threshold === "Infinity") {
						bracket.threshold = Infinity;
					}
				});
			}
			taxData = data;
			populateProvinceDropdown();
			refreshUI();
		})
		.catch(err => {
    document.getElementById('errorMsg').classList.remove('hidden');
		});
	incomeSlider.addEventListener('input', () => {
		incomeInput.value = incomeSlider.value;
		refreshUI();
	});
	incomeInput.addEventListener('input', () => {
		incomeSlider.value = incomeInput.value;
		refreshUI();
	});
	//Change table data if province is updated.
	provinceSelect.addEventListener('change', buildTables);

	function populateProvinceDropdown() {
		//sort alphabetically in en/fr
		const regions = Object.keys(taxData)
			.filter(region => region !== 'federal')
			.sort((a, b) => taxData[a][pagelang].localeCompare(taxData[b][pagelang], pagelang, { sensitivity: 'base' }));
	
		//Build select dropdown	
		for (const region of regions) {
			const option = document.createElement('option');
			option.value = region;
			option.textContent = taxData[region][pagelang];
			option.setAttribute("name", taxData[region][pagelang]);
			provinceSelect.appendChild(option);
		}
	}
let previousTaxValues = { federal: [], province: [] };

	//Function to update tables
	function buildTables() {
		incomeSlider.value = incomeInput.value;
		const income = Number(incomeInput.value) || 0;
		basedIncome.forEach(element => {
			element.innerHTML = `(${langToggle.dataTableHeader[pagelang]} ${formatCurrency(income)})`;
		});
		const provinceSelected = provinceSelect.options[provinceSelect.selectedIndex];
		const selectedProvinceName = provinceSelected.getAttribute('name');
        const selectedProvince = provinceSelect.value;
		
		
		if (!selectedProvince) {
			let elementsToHide = document.querySelectorAll('#incomeSliderDesign, #provinceTableWrapper, #federalTableWrapper, #afterTaxWrapper, #afterTaxHints, #quebecNotice, #errorMsg');
			elementsToHide.forEach(element => {
				element.classList.add('hidden');
			});
			document.getElementById('provinceTitle').textContent = '';
			document.getElementById('provinceTotal').textContent = '';
			return;
		}
		//Set slider maximum
		const provinceMaxAmount  = taxData[selectedProvince].range_max;
		const rangeListMax = document.querySelectorAll('.rangelist-max');
		const incomeSliderLabel = document.getElementById("incomeSliderLabel");
		incomeSlider.setAttribute("max", provinceMaxAmount);
		incomeSliderLabel.textContent = langToggle.dataSliderRange[pagelang] + formatCurrency(provinceMaxAmount);
		rangeListMax.forEach(listmax => {
			listmax.textContent = formatCurrency(provinceMaxAmount);
		});
		const selectedProvinceFlag  = taxData[selectedProvince].flag_url;
		document.getElementById('provinceFlag').innerHTML = `<img src="${selectedProvinceFlag}" alt="" class="mrgn-rght-md">`;
		document.getElementById('provinceTitle').textContent = `${selectedProvinceName}`;
		let federalTaxAmount = 0;
		let provincialTaxAmount = 0;
		if (selectedProvince === 'QC') {
			federalTaxAmount = updateTable('federal', taxData.federal, income);
			let elementsToHide = document.querySelectorAll('#provinceTableWrapper, #afterTaxWrapper');
			elementsToHide.forEach(element => {
				element.classList.add('hidden');
			});
			let elementsToShow = document.querySelectorAll('#incomeSliderDesign, #federalTableWrapper, #quebecNotice, #afterTaxHints');
			elementsToShow.forEach(element => {
				element.classList.remove('hidden');
			});
			$("#incomeSlider").trigger("update.wb-input-range", "#incomeSlider");
		} else {
			let elementsToHide = document.querySelectorAll(' #quebecNotice');
			elementsToHide.forEach(element => {
				element.classList.add('hidden');
			});
			let elementsToShow = document.querySelectorAll('#incomeSliderDesign, #provinceTableWrapper, #federalTableWrapper, #afterTaxWrapper, #afterTaxHints');
			elementsToShow.forEach(element => {
				element.classList.remove('hidden');
			});
			federalTaxAmount = updateTable('federal', taxData.federal, income);
			provincialTaxAmount = updateTable('province', taxData[selectedProvince], income);
			$("#incomeSlider").trigger("update.wb-input-range", "#incomeSlider");
		}
		const afterTax = income - federalTaxAmount - provincialTaxAmount;    
 
		//Functions for estimate section
		function updateCurrency(id, amount) {
			document.getElementById(id).textContent = formatCurrency(amount);
		}
		function updatePercentage(id, amount, income) {
			const percentage = calculatePercentage(amount, income);
			const formatted = percentFormatter.format(percentage / 100);
			document.getElementById(id).innerHTML = `(${formatted})`;
			return percentage;
		}
		function updateText(id, text) {
			document.getElementById(id).textContent = text;
		}

		// Currency updates for math calculation
		const currencyUpdates = [
			{id: 'fedTaxCal', amount: federalTaxAmount},
			{id: 'provTaxCal', amount: provincialTaxAmount },
			{id: 'totalTaxCal', amount: federalTaxAmount + provincialTaxAmount}
		];
		currencyUpdates.forEach(({ id, amount }) => updateCurrency(id, amount));

		// Text updates for math calculation
		const textUpdates = [
			{id: 'provTaxName', text: selectedProvinceName}
		];
		textUpdates.forEach(({ id, text }) => updateText(id, text));

		// Percentage updates
		const percentageUpdates = [
			{id: 'fedTaxPC', amount: federalTaxAmount },
			{id: 'provTaxPC', amount: provincialTaxAmount }
		];
		const percentageValues = {};
		percentageUpdates.forEach(({ id, amount }) => {
			const percentage = updatePercentage(id, amount, income);
			percentageValues[id] = percentage;
		});
		
		//Calculation for total tax percentage based on fed and prov percentage
		const totalTaxPercentage = percentageValues.fedTaxPC + percentageValues.provTaxPC;
		const formattedTotal = percentFormatter.format(totalTaxPercentage / 100);
		document.getElementById('totalTaxPC').innerHTML = `(${formattedTotal})`;
	}		

	//Function to build table
	function updateTable(idPrefix, data, income) {
		const headerRow = document.getElementById(`${idPrefix}Header`);
		const tableBody = document.getElementById(`${idPrefix}Body`);
		const totalDiv = document.getElementById(`${idPrefix}Total`);
		const minIncome = parseInt(incomeSlider.min);
		const maxIncome = parseInt(incomeSlider.max);
		headerRow.innerHTML = '';
		tableBody.innerHTML = ''; 
		let totalTax = 0;
		let previousThreshold = 0;
		let currentTaxValues = [];

		// Determine which bracket the income falls into
		let activeIndex = -1;
		previousThreshold = 0;
		
//Function to build rows/header for tables
		function createHeaderRow(headerText) {
			const row = document.createElement('tr');
			const header = document.createElement('th');
			header.setAttribute('scope', 'row');
			header.innerHTML = headerText; 
			row.appendChild(header);
			return row;
}   
 //Create rate/income/tax payable rows and headers
		const rateRow = createHeaderRow(`${langToggle.dataTaxRate[pagelang]}`);
		const incomeRow = createHeaderRow(`${langToggle.dataIncomeRange[pagelang]}`);
		const payableRow = createHeaderRow(`${langToggle.dataTaxEstimate[pagelang]}`); 
    
		data.brackets.forEach((bracket, index) => {
			const threshold = bracket.threshold;
			const lowerBound = previousThreshold;
			const upperBound = threshold;
			
			if (income >= lowerBound && income < upperBound && activeIndex === -1) {
				activeIndex = index;
			}
			let bracketIncome = Math.max(0, Math.min(income, threshold) - previousThreshold);
			
			if (index === 0) {
				bracketIncome = Math.max(0, bracketIncome);
			}
			const taxEstimate = Math.round(bracketIncome * bracket.rate);
			totalTax += taxEstimate;

			//Meter fill calculation
			function meterFill() {
				if (income < previousThreshold) {
					return 0;
				}
				if (income > previousThreshold && income < threshold) {
					return (income - previousThreshold) / (threshold - previousThreshold);
				}
				return 1;
			}
			
			/* Rate Header */
			const rateCell = document.createElement('th');
			rateCell.setAttribute('scope', 'col');
			//Create content
			if (pagelang == "en") {
				rateCell.innerHTML = `${percentFormatter.format(bracket.rate)} <span class="tbl-hidden"> ${langToggle.dataTaxBracket[pagelang]}</span>`; 
			} else {
				rateCell.innerHTML = `<span class="tbl-hidden"> ${langToggle.dataTaxBracket[pagelang]} </span>${percentFormatter.format(bracket.rate)}`;
			};
			rateRow.appendChild(rateCell);
			
			/* Income range Cell */
			const incomeCell = document.createElement('td');
			let fillAmount = meterFill();
			//Create content
			const rangeDiv = document.createElement("div");
			rangeDiv.className = "range";
			const startDiv = document.createElement("div");
			startDiv.className = "nowrap";
			startDiv.innerHTML = `$${index === 0 ? '0' : previousThreshold.toLocaleString()}<span class="tbl-hidden"> ${langToggle.dataHiddenTo[pagelang]}</span>`;
			rangeDiv.appendChild(startDiv);
			const meter = document.createElement("meter");
			meter.min = previousThreshold;
			meter.max = threshold === Infinity ? maxIncome : threshold;
			meter.value = income;
			meter.setAttribute("aria-hidden", "true");
			rangeDiv.appendChild(meter);
			const endDiv = document.createElement("div");
			endDiv.className = "nowrap";
			if (threshold === Infinity) {
				endDiv.innerHTML = `${formatCurrency(maxIncome)}<span class="glyphicon glyphicon-arrow-up"><span class="tbl-hidden"> ${langToggle.dataHiddenAndUp[pagelang]}</span></span>`;
			} else {
				endDiv.innerHTML = formatCurrency(threshold);
			};
			rangeDiv.appendChild(endDiv);
			incomeCell.appendChild(rangeDiv);
			const p = document.createElement("p");
			p.className = "tbl-hidden";
			p.textContent = `${langToggle.dataMeterFill[pagelang]}${percentFormatter.format(fillAmount)}`;
			incomeCell.appendChild(p);
			incomeRow.appendChild(incomeCell);
    
			/* Tax payable cell*/     
			const payableCell = document.createElement('td'); 
			payableCell.className = `tax-amount${index === activeIndex ? ' active-cell' : ''|| taxEstimate !== 0? ' prev-active': ''}`;
			//Create content
			payableCell.innerHTML += `<span class="float-plus">+ </span>${formatCurrency(taxEstimate)}`;
			payableRow.appendChild(payableCell);

			//Apply values
			currentTaxValues.push(taxEstimate.toFixed(2));
			previousThreshold = threshold;
		});
		headerRow.appendChild(rateRow);
		tableBody.appendChild(incomeRow);
		tableBody.appendChild(payableRow);

		//Write total amount
		function setTotalContent(container, totalValue) {
			container.innerHTML = "";
			const totalTextDiv = document.createElement("p");
			totalTextDiv.className = "mrgn-rght-md mrgn-bttm-0";
			totalTextDiv.innerHTML = `${langToggle.dataTotalEstimate[pagelang]}`;
			container.appendChild(totalTextDiv);
			const totalAmtDiv = document.createElement("div");
			totalAmtDiv.className = "estimate-borders fa-lg text-primary nowrap align-self-center";
			totalAmtDiv.innerHTML = `= ${formatCurrency(totalValue)}`;
			container.appendChild(totalAmtDiv);
		}  
//Federal amount (default)
setTotalContent(totalDiv, totalTax);
		const provinceSelected = provinceSelect.options[provinceSelect.selectedIndex];
		const selectedProvinceName = provinceSelected.getAttribute('name'); 
		const provTotal = document.getElementById("provinceTotal");
		
		if (provTotal) {
			setTotalContent(provTotal, totalTax);
		}
		// Scroll the active cell into view automatically
		const activeCell = document.querySelector(`#${idPrefix}Body .active-cell`);
		
		if (activeCell) {
			const container = activeCell.closest('.table-scroll');
			if (container && !isElementFullyVisible(container, activeCell)) {
				smoothScrollTo(container, activeCell);
			}
		}
		previousTaxValues[idPrefix] = currentTaxValues;
		return totalTax;
	}
	
	function isElementFullyVisible(container, element) {
		const containerLeft = container.scrollLeft,
			containerRight = containerLeft + container.clientWidth,
			elementLeft = element.offsetLeft,
			elementRight = elementLeft + element.offsetWidth;
		return elementLeft >= containerLeft && elementRight <= containerRight;
}
	function smoothScrollTo(container, target, duration = 400) {
		const containerLeft = container.scrollLeft,
			targetLeft = target.offsetLeft,
			targetRight = targetLeft + target.offsetWidth;
		let scrollTo = containerLeft;
		
		if (targetLeft < containerLeft) {
			scrollTo = targetLeft - 20;
		} else if (targetRight > containerLeft + container.clientWidth) {
			scrollTo = targetRight - container.clientWidth;
		} else {
			return;
		}
		const distance = scrollTo - containerLeft;
		const startTime = performance.now();
		
		function scrollStep(currentTime) {
			const elapsed = currentTime - startTime;
			const progress = Math.min(elapsed / duration, 1);
			const ease = 0.5 - Math.cos(progress * Math.PI) / 2;
			container.scrollLeft = containerLeft + distance * ease;
			
			if (progress < 1) {
				requestAnimationFrame(scrollStep);
			}
		}
		requestAnimationFrame(scrollStep);
	}
	
	function setupScrollObserver() {
		document.querySelectorAll('.table-scroll').forEach(container => {
			const cells = container.querySelectorAll('.tax-amount');
		});
	} 
	//Provide percentages in total
	function calculatePercentage(part, total) {
		if (total === 0) {
			return 0; // Avoid division by zero
		}
		const formattedString = percentFormatter.format(part / total),
			numericString = formattedString.replace(',', '.'),
			rawNumber = parseFloat(numericString);
    return Math.round(rawNumber * 10) / 10; // round to one decimal
	}
	
	// Script for button toggle between input and range slider
	const buttons = document.querySelectorAll('.btn-toggle');
	const buttonsValue = document.querySelectorAll(".btn-toggle-value");
	
	buttons.forEach(button => {
		button.addEventListener('click', inputToggle);
	});
	
	function inputToggle(event) {
		buttons.forEach(otherButton => {
			otherButton.classList.remove("btn-primary");
			otherButton.setAttribute("aria-pressed", false); 
			buttonsValue.forEach(otherValue => {
				otherValue.classList.add("hidden");
				const mySlider = document.getElementById('incomeSlider');
				mySlider.value = 0;
				const myInput = document.getElementById('incomeInput');
				myInput.value = 0;
				resultsLink.classList.add('invisible');
				buildTables();
				
				//Reset tables when toggling between options
				$("#incomeSlider").trigger("update.wb-input-range", "#incomeSlider");
			});
            });
		this.classList.add('btn-primary');
		this.setAttribute("aria-pressed", true);
		const getTargetID = event.currentTarget.id;
		const getTargetValue = document.getElementById(getTargetID +"Value");
		getTargetValue.classList.remove("hidden");
	}   
 
	//Script to add class to sticky element
	const el = document.querySelector(".top-bar-stick");
	const childEl = document.querySelector(".wb-input-range");
	const classesToToggle = ["panel", "panel-default"];
	const observer = new IntersectionObserver(
		([e]) => classesToToggle.forEach(className => {
			childEl.classList.toggle(className, e.intersectionRatio < 1)}),
		{
			threshold: [1]
		});
	observer.observe(el);

	
//Script to show/hide results link (for accessibility)
	incomeInputs.forEach(inputElement => {
		inputElement.addEventListener('input', function() {
			resultsLink.classList.remove('invisible');
		});
	});

		//Script for anchor link to offset sticky element above header
	$(document).ready(function() {
		$('a[href^="#summary"]').on('click', function(e) {
			const targetId = $(this).attr('href'),
				headerHeight = $('.top-bar-stick').outerHeight(),
				targetOffset = $(targetId).offset().top,
				scrollTo = targetOffset - headerHeight;
			
			setTimeout(function(){
				history.replaceState("", document.title, window.location.pathname);
			}, 1);
			
			$('html, body').animate({
				scrollTop: scrollTo
			}, 1); // Scroll speed set to almost no animation
		});
	});

		
	</script>
</body>
</html>
