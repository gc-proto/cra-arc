<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Comparison tool - Questionnaire to determine if the worker's corporation was carrying on a personal services business (PSB)</title>
<meta content="width=device-width,initial-scale=1" name="viewport">
<meta name="robots" content="noindex, follow">
<!-- WET Assets -->
<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/soyutils.js"></script>
<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/wet-en.js"></script>
<link href="https://test.canada.ca/covid-19-guidance/proto/css/alpha-beta-banner.css" rel="stylesheet">
<link href="https://www.canada.ca/etc/designs/canada/wet-boew/m%C3%A9li-m%C3%A9lo/2023-10-mount-revelstoke.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"/>
         
<link href="https://www.canada.ca/etc/designs/canada/wet-boew/css/theme.min.css" rel="stylesheet">
<!-- JS Libraries -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- Styles -->
<style>
   body { font-family: Arial, sans-serif; padding: 20px; }
   .match { background-color: #d6f5d6; }
   .mismatch { background-color: #fff3cd; }
   .missing { background-color: #f8d7da; }
   .hidden { display: none !important; }
   #pdfButton { margin-top: 20px; }
</style>
<script type="text/javascript">
   document.write(wet.builder.refTop({}));
</script>
</head>
<body vocab="http://schema.org/" typeof="WebPage" class="experimental">
<div id="def-top"></div>
<main role="main" property="mainContentOfPage" class="container">
<div class="gc-font-2019">
<h1>Comparison tool - Questionnaire to determine if the worker's corporation was carrying on a personal services business (PSB)</h1>
<p>To use the comparison tool:</p>
<ol>
<li>Save the file worker and the file payer on your computer</li>
<li>Upload the response files (JSON) for the worker and the payer</li>
<li>Click compare to view side-by-side results (if the results do not match, they are highlighted)</li>
</ol>
<hr>
<h3>Upload the response files (JSON)</h3>
<ul class="list-unstyled cnjnctn-type-and cnjnctn-sm">
<li class="cnjnctn-col"><label>Worker's response: <input type="file" id="workerFile" accept=".json"></label></li>
<li class="cnjnctn-col"><label>Payer's response: <input type="file" id="payerFile" accept=".json"></label></li>
</ul>
<br>
<button class="btn btn-primary btn-lg" onclick="compare()">Compare</button>
<!-- Filters and Toggle (initially hidden) -->
<div id="filters" class="hidden">
<hr>
<h3 class="mrgn-tp-lg"><span class="fas fa-lg fa-filter"></span> Filter results by:</h3>
<div class="btn-group mrgn-bttm-md" role="group" aria-label="Filter options">
<button class="btn btn-default" onclick="filterTable('all')">All</button>
<button class="btn btn-success" onclick="filterTable('match')">Match</button>
<button class="btn btn-warning" onclick="filterTable('mismatch')">Mismatch</button>
</div>
<div class="checkbox">
<label><input type="checkbox" id="toggleIdCol" onchange="toggleIdColumn()"> Show question ID column</label>
</div>
</div>
<!-- Output -->
<div id="output" class="mrgn-tp-md"></div>
<button id="pdfButton" onclick="downloadPDF()" class="btn btn-secondary hidden">Download PDF</button>
</div>
<script>
     let tableData = [];
     function compare() {
       const workerFile = document.getElementById('workerFile').files[0];
       const payerFile = document.getElementById('payerFile').files[0];
       if (!workerFile || !payerFile) {
         alert("Please select both JSON files.");
         return;
       }
       Promise.all([workerFile.text(), payerFile.text()])
         .then(([workerText, payerText]) => {
           const workerJSON = JSON.parse(workerText);
           const payerJSON = JSON.parse(payerText);
           const workerMap = buildQuestionMap(workerJSON.elements);
           const payerMap = buildQuestionMap(payerJSON.elements);
           const allIds = Array.from(new Set([...Object.keys(workerMap), ...Object.keys(payerMap)]));
           tableData = [];
           allIds.forEach(id => {
             const w = workerMap[id];
             const p = payerMap[id];
             const wTitle = w?.titleEn || '[Missing]';
             const pTitle = p?.titleEn || '[Missing]';
             const wChoices = w?.choices?.map(c => c.en).join(', ') || '[None]';
             const pChoices = p?.choices?.map(c => c.en).join(', ') || '[None]';
             const match = wChoices === pChoices;
             const existsInBoth = !!w && !!p;
             tableData.push({ id, wTitle, pTitle, wChoices, pChoices, match, existsInBoth });
           });
           renderTable();
         });
     }
     function buildQuestionMap(elements) {
       const map = {};
       elements.forEach(el => {
         const qid = el?.properties?.questionId;
         if (qid) {
           map[qid] = {
             titleEn: el.properties.titleEn,
             choices: el.properties.choices || []
           };
         }
       });
       return map;
     }
     function renderTable() {
       document.getElementById('filters').classList.remove('hidden');
       document.getElementById('pdfButton').classList.remove('hidden');
       let html = ` <table id="comparisonTable" class="wb-tables table table-bordered small " data-wb-tables='{"columnDefs": [ { "visible": true, "targets": [ 0 ] } ], "paging": false, "oLanguage": {
                     "sSearch": "Filter by keyword"
                     } }'>
<thead>
<tr>
<th scope="col" class="toggle-column id-col hidden">Question ID</th>
<th scope="col" class="toggle-column">Worker questions</th>
<th scope="col" class="toggle-column">Payer questions</th>
<th scope="col" class="toggle-column">Worker responses</th>
<th scope="col" class="toggle-column">Payer responses</th>
<th scope="col" class="toggle-column">Match</th>
<th scope="col" class="toggle-column">Mismatch</th>
</tr>
</thead>
<tbody>`;
       tableData.forEach(row => {
         const rowClass = row.existsInBoth
           ? (row.match ? "match" : "mismatch")
           : "missing";
         html += `<tr class="${rowClass}">
<td class="id-col hidden">${row.id}</td>
<td>${row.wTitle}</td>
<td>${row.pTitle}</td>
<td>${row.wChoices}</td>
<td>${row.pChoices}</td>
<td>${row.match ? "Yes" : ""}</td>
<td>${!row.match && row.existsInBoth ? "Yes" : ""}</td>
</tr>`;
       });
       html += '</tbody></table>';
       document.getElementById('output').innerHTML = html;
       // Trigger WET reinitialization
       window.wb?.init(document.getElementById('output'));
     }
     function filterTable(type) {
       const rows = document.querySelectorAll("#comparisonTable tbody tr");
       rows.forEach(row => {
         row.style.display = "table-row";
         if (type === "match" && !row.classList.contains("match")) {
           row.style.display = "none";
         } else if (type === "mismatch" && !row.classList.contains("mismatch")) {
           row.style.display = "none";
         }
       });
     }
     function toggleIdColumn() {
       const show = document.getElementById("toggleIdCol").checked;
       const cells = document.querySelectorAll(".id-col");
       cells.forEach(cell => {
         if (show) {
           cell.classList.remove("hidden");
         } else {
           cell.classList.add("hidden");
         }
       });
     }
     function downloadPDF() {
       const { jsPDF } = window.jspdf;
       const doc = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'a4' });
       doc.setFontSize(14);
       doc.text("Questionnaire Comparison Report", 40, 30);
       doc.setFontSize(10);
       let y = 50;
       const lineHeight = 16;
       tableData.forEach(row => {
         if (y > 550) {
           doc.addPage();
           y = 50;
         }
         doc.setTextColor(row.match ? [0, 150, 0] : [200, 150, 0]);
         doc.text(`ID: ${row.id}`, 40, y);
         doc.text(`W: ${row.wTitle}`, 100, y);
         doc.text(`P: ${row.pTitle}`, 300, y);
         y += lineHeight;
       });
       doc.save("questionnaire-comparison.pdf");
     }
</script>
<div id="def-footer"></div>
<div id="def-preFooter"></div>
<script type="text/javascript">
     var defPreFooter = document.getElementById("def-preFooter");
     defPreFooter.outerHTML = wet.builder.preFooter({
       dateModified: "2025-05-27",
       showPostContent: true,
       showFeedback: true,
       showShare: true
     });
</script>
</main>
</body>
</html>
