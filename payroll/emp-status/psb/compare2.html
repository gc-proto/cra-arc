<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PSB CSV Comparison Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>
   body {
     font-family: Arial, sans-serif;
     padding: 20px;
   }
   table {
     border-collapse: collapse;
     width: 100%;
     margin-top: 20px;
   }
   th, td {
     border: 1px solid #ccc;
     padding: 8px;
     text-align: left;
   }
   th {
     background-color: #f4f4f4;
   }
   .match {
     background-color: #d6f5d6; /* light green */
   }
   .mismatch {
     background-color: #fff3cd; /* light yellow */
   }
   .missing {
     background-color: #f8d7da; /* light red */
   }
</style>
</head>
<body>
<h1>PSB Questionnaire Comparison Tool (CSV)</h1>
<label>Worker CSV: <input type="file" id="workerFile" accept=".csv"></label><br><br>
<label>Payer CSV: <input type="file" id="payerFile" accept=".csv"></label><br><br>
<button onclick="compare()">Compare</button>
<div id="output"></div>
<script>
   function parseCSV(file, callback) {
     Papa.parse(file, {
       header: true,
       skipEmptyLines: true,
       complete: results => callback(results.data)
     });
   }
   function compare() {
     const workerFile = document.getElementById('workerFile').files[0];
     const payerFile = document.getElementById('payerFile').files[0];
     if (!workerFile || !payerFile) {
       alert('Please select both CSV files.');
       return;
     }
     parseCSV(workerFile, workerData => {
       parseCSV(payerFile, payerData => {
         const workerMap = {};
         workerData.forEach(row => {
           workerMap[row["Question ID"]] = row;
         });
         const payerMap = {};
         payerData.forEach(row => {
           payerMap[row["Question ID"]] = row;
         });
         const allIds = Array.from(new Set([
           ...Object.keys(workerMap),
           ...Object.keys(payerMap)
         ]));
         let html = `<table>
<thead>
<tr>
<th>Section</th>
<th>Question ID</th>
<th>Question</th>
<th>Worker Answer</th>
<th>Payer Answer</th>
<th>Match</th>
</tr>
</thead>
<tbody>`;
         allIds.forEach(id => {
           const w = workerMap[id] || {};
           const p = payerMap[id] || {};
           const section = w.Section || p.Section || '';
           const label = w.Label || p.Label || '';
           const wAns = w.Answer || '';
           const pAns = p.Answer || '';
           const match = wAns === pAns;
           const exists = wAns || pAns;
           const rowClass = !exists ? "missing" : match ? "match" : "mismatch";
           html += `<tr class="${rowClass}">
<td>${section}</td>
<td>${id}</td>
<td>${label}</td>
<td>${wAns}</td>
<td>${pAns}</td>
<td>${match ? "Yes" : "No"}</td>
</tr>`;
         });
         html += `</tbody></table>`;
         document.getElementById("output").innerHTML = html;
       });
     });
   }
</script>
</body>
</html>
