<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Worker vs. payer questionnaire comparison - Questionnaire to determine if the worker's corporation was carrying on a personal services business (PSB)</title>
<meta content="width=device-width,initial-scale=1" name="viewport">
<meta name="robots" content="noindex, follow">
<!-- WET Assets -->
<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/soyutils.js"></script>
<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/wet-en.js"></script>
<link href="https://test.canada.ca/covid-19-guidance/proto/css/alpha-beta-banner.css" rel="stylesheet">
<link href="https://www.canada.ca/etc/designs/canada/wet-boew/m%C3%A9li-m%C3%A9lo/2023-10-mount-revelstoke.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"/>
<link href="https://www.canada.ca/etc/designs/canada/wet-boew/css/theme.min.css" rel="stylesheet">

<!-- JS Libraries -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- Styles -->
<style>
   body {
     font-family: Arial, sans-serif;
     padding: 20px;
   }
   table {
     width: 100%;
     border-collapse: collapse;
     margin-top: 1em;
   }
   th, td {
     border: 1px solid #ccc;
     padding: 8px;
     text-align: left;
     vertical-align: top;
   }
   th {
     background-color: #f2f2f2;
   }
   pre {
     background: #f4f4f4;
     padding: 10px;
     border-radius: 5px;
   }
</style>
<script type="text/javascript">
   document.write(wet.builder.refTop({}));
</script>
</head>
<body vocab="http://schema.org/" typeof="WebPage" class="experimental">
<div id="def-top"></div>
<main role="main" property="mainContentOfPage" class="container">
<div class="gc-font-2019">
<h1>Worker vs. payer questionnaire comparison <br>
<small>- Questionnaire to determine if the worker's corporation was carrying on a personal services business (PSB)</small></h1>
  <p>To use the comparison tool:</p>
<ol>
<li>Save the file worker and the file payer on your computer</li>
<li>Upload the response files (JSON) for the worker and the payer</li>
<li>Click compare to view side-by-side results (if the results do not match, they are highlighted)</li>
</ol>
<hr> 
<h3>Upload the response files (JSON)</h3>
<ul class="list-unstyled cnjnctn-type-and cnjnctn-sm">
<li class="cnjnctn-col"><label>Worker's response: <input type="file" id="workerJson" accept=".json" /></label></li>
<li class="cnjnctn-col"><label>Payer's response: <input type="file" id="payerJson" accept=".json" /></label></li>
</ul>
<div id="content"></div>
<script>
   let workerData = null;
   let payerData = null;
   document.getElementById('workerJson').addEventListener('change', function(e) {
     readJSONFile(e.target.files[0], data => {
       workerData = data;
       if (payerData) renderComparison();
     });
   });
   document.getElementById('payerJson').addEventListener('change', function(e) {
     readJSONFile(e.target.files[0], data => {
       payerData = data;
       if (workerData) renderComparison();
     });
   });
   function readJSONFile(file, callback) {
     if (!file) return;
     const reader = new FileReader();
     reader.onload = function(e) {
       try {
         const data = JSON.parse(e.target.result);
         callback(data);
       } catch {
         alert("Invalid JSON");
       }
     };
     reader.readAsText(file);
   }
   function renderComparison() {
     const container = document.getElementById('content');
     container.innerHTML = '';
     const table = document.createElement('table');
     const thead = document.createElement('thead');
     const tbody = document.createElement('tbody');
     thead.innerHTML = `<tr><th>Question</th><th>Worker Answer</th><th>Payer Answer</th></tr>`;
     table.appendChild(thead);
     const payerAnswersById = {};
     payerData.forEach(entry => {
       entry.answers.forEach(ans => {
         if (typeof ans.answer === 'string' || typeof ans.answer === 'number') {
           payerAnswersById[ans.questionId] = ans.answer;
         } else if (Array.isArray(ans.answer)) {
           ans.answer.flat().forEach(subAns => {
             payerAnswersById[subAns.questionId] = subAns.answer;
           });
         }
       });
     });
     workerData.forEach(entry => {
       entry.answers.forEach(ans => {
         if (typeof ans.answer === 'string' || typeof ans.answer === 'number') {
           if (!ans.answer) return;
           const row = document.createElement('tr');
           row.innerHTML = `
<td>${ans.questionEn}</td>
<td>${ans.answer}</td>
<td>${payerAnswersById[ans.questionId] || ''}</td>
           `;
           tbody.appendChild(row);
         } else if (Array.isArray(ans.answer)) {
           ans.answer.forEach(group => {
             group.forEach(subAns => {
               if (!subAns.answer) return;
               const row = document.createElement('tr');
               row.innerHTML = `
<td>${subAns.questionEn}</td>
<td>${subAns.answer}</td>
<td>${payerAnswersById[subAns.questionId] || ''}</td>
               `;
               tbody.appendChild(row);
             });
           });
         }
       });
     });
     table.appendChild(tbody);
     container.appendChild(table);
   }
</script></div></main>
</body>
</html>
