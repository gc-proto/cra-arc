


<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Worker vs. payer questionnaire comparison - PSB Determination</title>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="noindex, follow" name="robots"/>
<!-- WET Assets -->
<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/soyutils.js"></script>
<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/wet-en.js"></script>
<link href="https://test.canada.ca/covid-19-guidance/proto/css/alpha-beta-banner.css" rel="stylesheet"/>
<link href="https://www.canada.ca/etc/designs/canada/wet-boew/m%C3%A9li-m%C3%A9lo/2023-10-mount-revelstoke.min.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" rel="stylesheet">
<link href="https://www.canada.ca/etc/designs/canada/wet-boew/css/theme.min.css" rel="stylesheet"/>
<!-- Styles -->
<style>
   body {
     font-family: Arial, sans-serif;
     padding: 20px;
   }
   table {
     width: 100%;
     border-collapse: collapse;
     margin-top: 1em;
   }
   th, td {
     border: 1px solid #ccc;
     padding: 8px;
     vertical-align: top;
   }
   th {
     background-color: #f2f2f2;
   }
    pre {
     background: #f4f4f4;
     padding: 10px;
     border-radius: 5px;
   }
   .probability-bar {
     margin-top: 1em;
     background: #eee;
     border-radius: 5px;
     height: 20px;
     position: relative;
     width: 100%;
   }
   .probability-fill {
     height: 100%;
     border-radius: 5px;
     text-align: center;
     line-height: 20px;
     color: white;
     font-weight: Bold;
   }
</style>
<script type="text/javascript">
   document.write(wet.builder.refTop({}));
</script>
</link></head>
<body class="experimental" typeof="WebPage" vocab="http://schema.org/">
<div id="def-top"></div>
<main class="container" property="mainContentOfPage" role="main">
<div class="gc-font-2019">
<h1>Worker vs. payer questionnaire comparison<br/>
<small>Questionnaire to determine if the worker's corporation was carrying on a personal services business (PSB)</small>
</h1>
<p>To use the comparison tool:</p>
<ol>
<li>Save the worker and payer JSON files on your computer.</li>
<li>Upload both files below.</li>
<li>Click compare to view side-by-side results. To help you quickly spot mismatches between the 2 responses, if the worker and payer answers are different, the cells will be highlighted in <span style="background-color: #fff3cd;">yellow</span>.</li>
</ol>
<h3>Upload the response files (JSON)</h3>
<ul class="list-unstyled cnjnctn-type-and cnjnctn-sm">
<li class="cnjnctn-col">
<label>Worker's response:
<input accept=".json" id="jsonWorkerInput" type="file"/>
</label>
</li>
<li class="cnjnctn-col">
<label>Payer's response:
<input accept=".json" id="jsonPayerInput" type="file"/>
</label>
</li>
</ul>
<details><summary>How to read the <strong>outcome indicator</strong></summary>
<p>The outcome indicator populates the number of questions where the responses resulted in the indicator of employment out of the total questions responses received. Depending on the situation, the result of the response may be neutral.</p>

</details>
<div class="row">
<div class="col-md-9">
<div id="content"></div>
</div>
<div class="col-md-3">
<div id="probability"></div>
</div>
</div>
<script>
   const sectionMap = {
    340: "Section 1: General information", 
   341: "Section 1: General information",
   335: "Section 1: General information",
    161: "Section 1: General information",
   240: "Section 1: General information",
    241: "Section 1: General information",
   243: "Section 1: General information",

    441:  "Section 2: Information about the business", 
   443:  "Section 2: Information about the business",  
  
   315: "Section 2: Information about the business",
    318: "Section 2: Information about the business",
    319: "Section 2: Information about the business",
    317: "Section 2: Information about the business",
    320: "Section 2: Information about the business", 
    321: "Section 2: Information about the business",
    322: "Section 2: Information about the business",
     323: "Section 2: Information about the business",
    324: "Section 2: Information about the business",
    325: "Section 2: Information about the business",
    326: "Section 2: Information about the business", 
    327: "Section 2: Information about the business",
    328: "Section 2: Information about the business",
    329: "Section 2: Information about the business",
    330: "Section 2: Information about the business",
    331: "Section 2: Information about the business", 
    332: "Section 2: Information about the business",
    333: "Section 2: Information about the business",
    334: "Section 2: Information about the business",
    316: "Section 2: Information about the business",
   
 339: "Worker - Section 2a - Employee information",
    170: "Worker - Section 2a - Employee information",
 356: "Worker - Section 2a - Employee information",   
  464: "Worker - Section 2a - Employee information",      

   342: "Worker - Section 2b - Specified shareholder information",     
 245: "Worker - Section 2b - Specified shareholder information",   
 352: "Worker - Section 2b - Specified shareholder information",  
  465: "Worker - Section 2b - Specified shareholder information",     
 
       444: "Payer - Section 3 - Payee (worker) information",   
       445: "Payer - Section 3 - Payee (worker) information",   
       446: "Payer - Section 3 - Payee (worker) information",   
       447: "Payer - Section 3 - Payee (worker) information",   
       448: "Payer - Section 3 - Payee (worker) information",   
       449: "Payer - Section 3 - Payee (worker) information",   
       450: "Payer - Section 3 - Payee (worker) information",   
       451: "Payer - Section 3 - Payee (worker) information",   
       452: "Payer - Section 3 - Payee (worker) information",   

     358: "Worker - Section 3 - Payers (clients) information",  
     314: "Worker - Section 3 - Payers (clients) information",   
              31401: "Worker - Section 3 - Payers (clients) information",   
          31407: "Worker - Section 3 - Payers (clients) information",   
          31402: "Worker - Section 3 - Payers (clients) information",
          31403: "Worker - Section 3 - Payers (clients) information",
          31404: "Worker - Section 3 - Payers (clients) information", 
          31405: "Worker - Section 3 - Payers (clients) information", 
          31410: "Worker - Section 3 - Payers (clients) information", 
          31411: "Worker - Section 3 - Payers (clients) information", 
          31412: "Worker - Section 3 - Payers (clients) information", 
          31406: "Worker - Section 3 - Payers (clients) information", 


 350: "Section 4 - Contract or agreement information",    
 236: "Section 4 - Contract or agreement information",    
 207: "Section 4 - Contract or agreement information",    
 206: "Section 4 - Contract or agreement information",   
 351: "Section 4 - Contract or agreement information",   
 379: "Section 4 - Contract or agreement information",  
 347: "Section 4 - Contract or agreement information", 
 348: "Section 4 - Contract or agreement information", 
 380: "Section 4 - Contract or agreement information", 
 382: "Section 4 - Contract or agreement information", 
 423: "Section 4 - Contract or agreement information", 
 349: "Section 4 - Contract or agreement information", 


189: "Section 5 - Working relationship information",     
389: "Section 5 - Working relationship information",         
    
 390: "Section 5 - Working relationship information - Contract formed in a province or territory other than Quebec",  
   
 192: "Subsection 5a - Control - Duties (1 of 8)", 
 383: "Subsection 5a - Control - Duties (1 of 8)", 
 424: "Subsection 5a - Control - Duties (1 of 8)",  
 258: "Subsection 5a - Control - Duties (1 of 8)",  
 257: "Subsection 5a - Control - Duties (1 of 8)",   

     259: "Subsection 5a - Control - Work schedule (2 of 8)", 
   261: "Subsection 5a - Control - Work schedule (2 of 8)",   
     262: "Subsection 5a - Control - Work schedule (2 of 8)",   
      263: "Subsection 5a - Control - Work schedule (2 of 8)",   
      264: "Subsection 5a - Control - Work schedule (2 of 8)",   
      265: "Subsection 5a - Control - Work schedule (2 of 8)",   

     191: "Subsection 5a - Control - Degree of autonomy (3 of 8)",   
         267: "Subsection 5a - Control - Degree of autonomy (3 of 8)",   
     268: "Subsection 5a - Control - Degree of autonomy (3 of 8)",   
         312: "Subsection 5a - Control - Degree of autonomy (3 of 8)",   
    
    297: "Subsection 5a - Control - Remuneration (4 of 8)",  
    298: "Subsection 5a - Control - Remuneration (4 of 8)",  
     299: "Subsection 5a - Control - Remuneration (4 of 8)",  
     271: "Subsection 5a - Control - Remuneration (4 of 8)",  
     300: "Subsection 5a - Control - Remuneration (4 of 8)",  
     385: "Subsection 5a - Control - Remuneration (4 of 8)",  
     301: "Subsection 5a - Control - Remuneration (4 of 8)",  
    270: "Subsection 5a - Control - Remuneration (4 of 8)",
     302: "Subsection 5a - Control - Remuneration (4 of 8)",
    303: "Subsection 5a - Control - Remuneration (4 of 8)",
    304: "Subsection 5a - Control - Remuneration (4 of 8)",
    306: "Subsection 5a - Control - Remuneration (4 of 8)",
    386: "Subsection 5a - Control - Remuneration (4 of 8)",

 195: "Subsection 5a - Control - Location of services (5 of 8)",    
   296: "Subsection 5a - Control - Location of services (5 of 8)",    
     426: "Subsection 5a - Control - Location of services (5 of 8)",  

     274: "Subsection 5a - Control - Right to exercise punitive action and or terminate the relationship (6 of 8)", 
       275: "Subsection 5a - Control - Right to exercise punitive action and or terminate the relationship (6 of 8)", 
       428: "Subsection 5a - Control - Right to exercise punitive action and or terminate the relationship (6 of 8)", 
       276: "Subsection 5a - Control - Right to exercise punitive action and or terminate the relationship (6 of 8)", 
       388: "Subsection 5a - Control - Right to exercise punitive action and or terminate the relationship (6 of 8)", 
     429: "Subsection 5a - Control - Right to exercise punitive action and or terminate the relationship (6 of 8)", 

      278: "Subsection 5a - Control - How the work is done (7 of 8)", 
          280: "Subsection 5a - Control - How the work is done (7 of 8)", 
         309: "Subsection 5a - Control - How the work is done (7 of 8)", 
          310: "Subsection 5a - Control - How the work is done (7 of 8)", 
      311: "Subsection 5a - Control - How the work is done (7 of 8)", 
    459: "Subsection 5a - Control - How the work is done (7 of 8)", 

      198: "Subsection 5a - Control - Training (8 of 8)", 
          281: "Subsection 5a - Control - Training (8 of 8)", 
          282: "Subsection 5a - Control - Training (8 of 8)", 
          283: "Subsection 5a - Control - Training (8 of 8)", 

    
 290: "Subsection 5b - Ownership of tools or equipment", 
 208: "Subsection 5b - Ownership of tools or equipment", 
 210: "Subsection 5b - Ownership of tools or equipment",  
 284: "Subsection 5b - Ownership of tools or equipment",  
 285: "Subsection 5b - Ownership of tools or equipment", 
 286: "Subsection 5b - Ownership of tools or equipment",  

   430: "Subsection 5c - Financial information",  
     211: "Subsection 5c - Financial information",  
     214: "Subsection 5c - Financial information",  
     216: "Subsection 5c - Financial information",  
     218: "Subsection 5c - Financial information",  
     217: "Subsection 5c - Financial information",  
     215: "Subsection 5c - Financial information",  
     219: "Subsection 5c - Financial information",  
     233: "Subsection 5c - Financial information",  
    234: "Subsection 5c - Financial information",  

 391: "Section 5 - Working relationship information - Contract formed in the province of Quebec",      
   
    
   431: "Subsection 5a - Carrying out the work",   
   397: "Subsection 5a - Carrying out the work", 
     398: "Subsection 5a - Carrying out the work", 
     433: "Subsection 5a - Carrying out the work", 
     399: "Subsection 5a - Carrying out the work", 
     432: "Subsection 5a - Carrying out the work", 
     393: "Subsection 5a - Carrying out the work", 
     394: "Subsection 5a - Carrying out the work", 
     

   400: "Subsection 5b - Remuneration",   
  402: "Subsection 5b - Remuneration", 
  403: "Subsection 5b - Remuneration", 
      434: "Subsection 5b - Remuneration", 
      404: "Subsection 5b - Remuneration", 
      435: "Subsection 5b - Remuneration", 
      405: "Subsection 5b - Remuneration", 
      406: "Subsection 5b - Remuneration", 
      407: "Subsection 5b - Remuneration", 
      408: "Subsection 5b - Remuneration", 
      410: "Subsection 5b - Remuneration", 
      436: "Subsection 5b - Remuneration", 
      411: "Subsection 5b - Remuneration", 

     
     412: "Subsection 5c - Relationship of subordination", 
     413: "Subsection 5c - Relationship of subordination",  
    414: "Subsection 5c - Relationship of subordination",  
    415: "Subsection 5c - Relationship of subordination",  
    416: "Subsection 5c - Relationship of subordination",  
    417: "Subsection 5c - Relationship of subordination",  
    418: "Subsection 5c - Relationship of subordination",  
    419: "Subsection 5c - Relationship of subordination",  
    420: "Subsection 5c - Relationship of subordination",  
    421: "Subsection 5c - Relationship of subordination",  
   422: "Subsection 5c - Relationship of subordination",  
   438: "Subsection 5c - Relationship of subordination",  
   439: "Subsection 5c - Relationship of subordination",   
   460: "Subsection 5c - Relationship of subordination",    

 360: "Section 6 - Certification", 
 363: "Section 6 - Certification", 
  376: "Section 6 - Certification", 
     364: "Section 6 - Certification", 
     366: "Section 6 - Certification", 
     373: "Section 6 - Certification", 
    375: "Section 6 - Certification", 
     362: "Section 6 - Certification"
   // Add more mappings as needed
 };



const excludedSections = new Set([
  "section 1: general information",
  "worker - section 2a - employee information",
  "worker - section 2b - specified shareholder information",
  "payer - section 3 - payee (worker) information",
  "worker - section 3 - payers (clients) information",
  "section 6 - certification"
]);
let workerData = null;
let payerData = null;
document.getElementById('jsonWorkerInput').addEventListener('change', function (event) {
 const file = event.target.files[0];
 if (!file) return;
 const reader = new FileReader();
 reader.onload = function (e) {
   try {
     workerData = JSON.parse(e.target.result);
     tryRenderBoth();
   } catch (err) {
     alert("Invalid worker JSON file");
   }
 };
 reader.readAsText(file);
});
    
document.getElementById('jsonPayerInput').addEventListener('change', function (event) {
 const file = event.target.files[0];
 if (!file) return;
 const reader = new FileReader();
 reader.onload = function (e) {
   try {
     payerData = JSON.parse(e.target.result);
     tryRenderBoth();
   } catch (err) {
     alert("Invalid payer JSON file");
   }
 };
 reader.readAsText(file);
});
function tryRenderBoth() {
  if (workerData && payerData) {
    const container = document.getElementById('content');
    container.innerHTML = '';
    container.appendChild(renderJSON(workerData, payerData));
    
    // Add this line to render the probability score
    renderProbabilityScore(workerData, payerData);
  }
}


 function renderJSON(workerData, payerData) {
   const sectioned = {};

   function addToSection(ans, isPayer = false) {
    const section = sectionMap[ans.questionId] || "Other";
    if (!sectioned[section]) sectioned[section] = {};
    if (!sectioned[section][ans.questionEn]) {
      sectioned[section][ans.questionEn] = {
        worker: "", payer: "", rawWorker: "", rawPayer: ""
      };
    }
    const formatted = formatAnswer(ans.answer);
    
const raw = typeof ans.answer === 'string' ? ans.answer.trim().toLowerCase() : JSON.stringify(ans.answer);
  
    if (isPayer) {
      sectioned[section][ans.questionEn].payer = formatted;
      sectioned[section][ans.questionEn].rawPayer = raw;
    } else {
      sectioned[section][ans.questionEn].worker = formatted;
      sectioned[section][ans.questionEn].rawWorker = raw;
    }
  }

  function formatAnswer(answer) {
    if (Array.isArray(answer)) {
      return answer.map(group =>
        group.map(sub =>
          `${sub.questionEn}: ${sub.answer}`
        ).join("<br>")
      ).join("<hr>");
    }
    return answer || "";
  }

    const skipMismatchHighlighting = [
  "Section 1: General information",
  "Section 2: Information about the business",
  "Worker - Section 2a - Employee information",
  "Worker - Section 2b - Specified shareholder information",
  "Payer - Section 3 - Payee (worker) information",
  "Worker - Section 3 - Payers (clients) information",
  "Section 6 - Certification"
      
];

 

  workerData.forEach(entry => entry.answers.forEach(ans => addToSection(ans, false)));
  payerData.forEach(entry => entry.answers.forEach(ans => addToSection(ans, true)));
  const container = document.createElement('div');



  for (const [section, questions] of Object.entries(sectioned)) {
    const table = document.createElement('table');

    const showWorker = !["Payer - Section 3 - Payee (worker) information"].includes(section);
    const showPayer = ![
      "Section 1: General information",
      "Worker - Section 2a - Employee information",
      "Worker - Section 2b - Specified shareholder information",
      "Worker - Section 3 - Payers (clients) information"
    ].includes(section);

    if (!showWorker && !showPayer) continue;

    let theadHTML = '<thead><tr><th>Question</th>';
    if (showWorker) theadHTML += '<th>Worker</th>';
    if (showPayer) theadHTML += '<th>Payer</th>';
    theadHTML += '</tr></thead>';
    table.innerHTML = theadHTML;

    const tbody = document.createElement('tbody');
    let rowCount = 0;

    for (const [question, data] of Object.entries(questions)) {
      const { worker, payer, rawWorker, rawPayer } = data;
      if (!worker && !payer) continue;

    
    
      const isMismatch = !skipMismatchHighlighting.includes(section) &&
                   rawWorker && rawPayer && rawWorker !== rawPayer;



      const row = document.createElement('tr');
      let rowHTML = `<td>${question}</td>`;
      if (showWorker) rowHTML += `<td style="${isMismatch ? 'background-color: #fff3cd;' : ''}">${worker}</td>`;
      if (showPayer) rowHTML += `<td style="${isMismatch ? 'background-color: #fff3cd;' : ''}">${payer}</td>`;
      row.innerHTML = rowHTML;
      tbody.appendChild(row);
      rowCount++;
    }

    if (rowCount > 0) {
      const sectionHeader = document.createElement('h3');
      sectionHeader.textContent = section;
      container.appendChild(sectionHeader);
      table.appendChild(tbody);
      container.appendChild(table);
    }
  }

  return container;
}

 
function generateBar(label, percent) {
 let color = "#1a2695"; // dark blue
 if (percent < 80) color = "#1a2695"; // dark blue
 if (percent < 50) color = "#ffc107"; // yellow
 if (percent < 20) color = "#1a2695"; // dark blue
 return `
<div style="margin-bottom:1em">
<label>${label} ${describeProbability(percent)}</label>
<div class="probability-bar">
<div class="probability-fill" style="width: ${percent}%; background-color: ${color};">
         ${percent}%
</div>
</div>
</div>
 `;
}

   function describeProbability(percent) {
 if (percent >= 90) return "Highly unlikely: Indicator of employment";	   
 if (percent >= 80) return "Highly unlikely: Indicator of employment";
 if (percent >= 60) return "Unlikely: Indicator of employment";
 if (percent >= 40) return "Neutral: Indicator of employment";
 if (percent >= 20) return "Propable: Indicator of employment";
 if (percent >= 10) return "Likely: Indicator of employment";	 
 if (percent >= 0) return "Highly likely: Indicator of employment";	   
 return "Highly likely: Indicator of employment";
}

</script>

<!-- Probability bar container -->
<div id="probability" style="margin-top: 2em;"></div>

<script>
const customScoringRules = {
   
	
    206: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
    351: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
   
  347: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  348: answer => {
    switch (answer.toLowerCase()) {
      case "no": return 1;
      default: return 0;
    }
  },
  380: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
    382: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  192: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
    383: answer => {
    switch (answer.toLowerCase()) {
      case "payer": return 1;
      default: return 0;
    }
  },
    258: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
    257: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
	259: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  261: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
262: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  263: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  264: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  265: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  191: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
 267: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },

 268: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
   297: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  
   298: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  
   299: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
   271: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
 300: answer => {
    switch (answer.toLowerCase()) {
      case "hourly": return 1;
      default: return 0;
    }
  },
   301: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
   270: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
   302: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
   303: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
   304: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
   306: answer => {
    switch (answer.toLowerCase()) {
      case "hourly": return 1;
      default: return 0;
    }
  },
   195: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
   296: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  274: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  275: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  428: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  276: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  429: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  
  278: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  280: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  
  309: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  310: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  459: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  198: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  281: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  282: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  283: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  290: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  208: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  284: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  285: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  286: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  430: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  
  211: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  214: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  216: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  217: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  219: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  233: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  
    431: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  397: answer => {
    switch (answer.toLowerCase()) {
      case "payer's location": return 1;
      default: return 0;
    }
  },
  398: answer => {
    switch (answer.toLowerCase()) {
      case "payer": return 1;
      default: return 0;
    }
  },
  399: answer => {
    switch (answer.toLowerCase()) {
      case "payer": return 1;
      default: return 0;
    }
  },
  393: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  394: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  400: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  402: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  403: answer => {
    switch (answer.toLowerCase()) {
      case "yes - t4 and rl-1 slips": return 1;
      default: return 0;
    }
  },
  404: answer => {
    switch (answer.toLowerCase()) {
      case "hourly": return 1;
      default: return 0;
    }
  },
  405: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  406: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  407: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  408: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  410: answer => {
    switch (answer.toLowerCase()) {
      case "filing a timesheet": return 1;
      default: return 0;
    }
  },
  411: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  412: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  413: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  414: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  415: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  416: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  417: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  418: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  419: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  420: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  421: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  422: answer => {
    switch (answer.toLowerCase()) {
      case "yes - with cause": return 1;
      default: return 0;
    }
  },
   438: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
  439: answer => {
    switch (answer.toLowerCase()) {
      case "yes": return 1;
      default: return 0;
    }
  },
};


function scoreAnswer(answer, questionId) {
  if (typeof answer !== 'string') return 0;
  const trimmed = answer.trim().toLowerCase();
  if (customScoringRules[questionId]) {
    return customScoringRules[questionId](trimmed);
  }
  return 0;
}
</script>

<script>
function calculateSectionScores(data) {
  const scores = {};
  const totals = {};

  data.forEach(entry => {
    entry.answers.forEach(ans => {
      const section = sectionMap[ans.questionId] || "Other";
      const normalizedSection = section.trim();
      if (!excludedSections.has(normalizedSection.toLowerCase())) {
        if (!scores[normalizedSection]) {
          scores[normalizedSection] = 0;
          totals[normalizedSection] = 0;
        }
        scores[normalizedSection] += scoreAnswer(ans.answer, ans.questionId);
        totals[normalizedSection]++;
      }
    });
  });

  return { scores, totals };
}

function renderProbabilityScore(workerData, payerData) {
  let totalQuestions = 0;
  let workerScore = 0;
  let payerScore = 0;

  workerData.forEach(entry => {
    entry.answers.forEach(ans => {
      const section = sectionMap[ans.questionId] || "Other";
      const normalizedSection = section.trim().toLowerCase();
      if (!excludedSections.has(normalizedSection)) {
        totalQuestions++;
        workerScore += scoreAnswer(ans.answer, ans.questionId);
      }
    });
  });

  payerData.forEach(entry => {
    entry.answers.forEach(ans => {
      const section = sectionMap[ans.questionId] || "Other";
      const normalizedSection = section.trim().toLowerCase();
      if (!excludedSections.has(normalizedSection)) {
        payerScore += scoreAnswer(ans.answer, ans.questionId);
      }
    });
  });

  const workerPercent = totalQuestions ? Math.round((workerScore / totalQuestions) * 100) : 0;
  const payerPercent = totalQuestions ? Math.round((payerScore / totalQuestions) * 100) : 0;

  const probabilityDiv = document.getElementById('probability');
  probabilityDiv.innerHTML = `
    <h3>Overall outcome indicator</h3>
    <section class="panel panel-primary">
      <header class="panel-heading">
        <h5 class="panel-title">Worker's response</h5>
      </header>
      <div class="panel-body">
        <p> ${generateBar("", workerPercent)}</p>
      </div>
    </section>
    <section class="panel panel-primary">
      <header class="panel-heading">
        <h5 class="panel-title">Payer's response</h5>
      </header>
      <div class="panel-body">
        <p> ${generateBar("", payerPercent)}</p>
      </div>
    </section>
    <p><small>Percentage is the confidence level based on answers</small></p>
<hr>
    <h3>Section-based scores</h3>
  `;

  const worker = calculateSectionScores(workerData);
  const payer = calculateSectionScores(payerData);

  for (const section of Object.keys(worker.scores)) {
    if (worker.totals[section]) {
      const workerPercent = Math.round((worker.scores[section] / worker.totals[section]) * 100);
      const payerPercent = payer.totals[section] ? Math.round((payer.scores[section] / payer.totals[section]) * 100) : 0;

      probabilityDiv.innerHTML += `
        <section class="panel panel-default">
          <header class="panel-heading"><h5 class="panel-title">${section}</h5></header>
          <div class="panel-body">
            <p><strong>Worker:</strong> ${workerPercent}%</p>
            <p><strong>Payer:</strong> ${payerPercent}%</p>
          </div>
        </section>
      `;
    }
  }
}
</script>

<script>

 // Optional: WET preFooter
 var defPreFooter = document.getElementById("def-preFooter");
 defPreFooter.outerHTML = wet.builder.preFooter({
   dateModified: "2025-06-02",
   showPostContent: true,
   showFeedback: true,
   showShare: true
 });
</script>
</div></main>

</body>
</html>
