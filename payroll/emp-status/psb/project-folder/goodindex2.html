<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Worker vs. payer questionnaire comparison - PSB Determination</title>
<meta content="width=device-width,initial-scale=1" name="viewport">
<meta name="robots" content="noindex, follow">
<!-- WET Assets -->
<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/soyutils.js"></script>
<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/wet-en.js"></script>
<link href="https://test.canada.ca/covid-19-guidance/proto/css/alpha-beta-banner.css" rel="stylesheet">
<link href="https://www.canada.ca/etc/designs/canada/wet-boew/m%C3%A9li-m%C3%A9lo/2023-10-mount-revelstoke.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" crossorigin="anonymous"/>
<link href="https://www.canada.ca/etc/designs/canada/wet-boew/css/theme.min.css" rel="stylesheet">
<!-- Styles -->
<style>
   body {
     font-family: Arial, sans-serif;
     padding: 20px;
   }
   table {
     width: 100%;
     border-collapse: collapse;
     margin-top: 1em;
   }
   th, td {
     border: 1px solid #ccc;
     padding: 8px;
     vertical-align: top;
   }
   th {
     background-color: #f2f2f2;
   }
   .probability-bar {
     margin-top: 2em;
     background: #eee;
     border-radius: 5px;
     height: 30px;
     position: relative;
     width: 100%;
   }
   .probability-fill {
     height: 100%;
     border-radius: 5px;
     text-align: center;
     line-height: 30px;
     color: white;
     font-weight: bold;
   }
</style>
<script type="text/javascript">
   document.write(wet.builder.refTop({}));
</script>
</head>
<body vocab="http://schema.org/" typeof="WebPage" class="experimental">
<div id="def-top"></div>
<main role="main" property="mainContentOfPage" class="container">
<div class="gc-font-2019">
<h1>Worker vs. payer questionnaire comparison<br>
<small>Questionnaire to determine if the worker's corporation was carrying on a personal services business (PSB)</small>
</h1>
<p>To use the comparison tool:</p>
<ol>
<li>Save the worker and payer JSON files on your computer.</li>
<li>Upload both files below.</li>
<li>Click compare to view side-by-side results and risk score.</li>
</ol>
<h3>Upload the response files (JSON)</h3>
<ul class="list-unstyled cnjnctn-type-and cnjnctn-sm">
<li class="cnjnctn-col">
<label>Worker's response:
<input type="file" id="jsonWorkerInput" accept=".json" />
</label>
</li>
<li class="cnjnctn-col">
<label>Payer's response:
<input type="file" id="jsonPayerInput" accept=".json" />
</label>
</li>
</ul>
<div id="content"></div>
<div id="probability"></div>

<script>
let workerData = null;
let payerData = null;
const scoringRules = {
 "s2a_q1": { weight: 1, yes: 1, no: 0 },
 "q5a_q8_1": { weight: 2, yes: 1, no: -1 },
 "q5a_q8_2": { weight: 1, yes: 0.5, no: 0 },
 "q5a_q8_3": { weight: 3, yes: 1, no: 0 },
 // Add your actual questionId keys here
};
document.getElementById('jsonWorkerInput').addEventListener('change', function(event) {
 const file = event.target.files[0];
 if (!file) return;
 const reader = new FileReader();
 reader.onload = function(e) {
   try {
     workerData = JSON.parse(e.target.result);
     tryRenderBoth();
   } catch (err) {
     alert("Invalid Worker JSON.");
   }
 };
 reader.readAsText(file);
});
document.getElementById('jsonPayerInput').addEventListener('change', function(event) {
 const file = event.target.files[0];
 if (!file) return;
 const reader = new FileReader();
 reader.onload = function(e) {
   try {
     payerData = JSON.parse(e.target.result);
     tryRenderBoth();
   } catch (err) {
     alert("Invalid Payer JSON.");
   }
 };
 reader.readAsText(file);
});
function tryRenderBoth() {
 if (workerData && payerData) {
   const container = document.getElementById('content');
   container.innerHTML = '';
   container.appendChild(renderJSON(workerData, payerData));
   renderProbabilityScore(workerData, payerData);
 }
}
function renderJSON(workerData, payerData) {
 const sectioned = {};
 function addToSection(ans, isPayer = false) {
   const section = sectionMap[ans.questionId] || "Other";
   if (!sectioned[section]) sectioned[section] = {};
   if (!sectioned[section][ans.questionEn]) {
     sectioned[section][ans.questionEn] = { worker: "", payer: "" };
   }
   const formatted = formatAnswer(ans.answer);
   if (isPayer) {
     sectioned[section][ans.questionEn].payer = formatted;
   } else {
     sectioned[section][ans.questionEn].worker = formatted;
   }
 }
 function formatAnswer(answer) {
   if (Array.isArray(answer)) {
     return answer.map(group =>
       group.map(sub =>
         `${sub.questionEn}: ${sub.answer}`
       ).join("<br>")
     ).join("<hr>");
   }
   return answer || "";
 }
 workerData.forEach(entry => entry.answers.forEach(ans => addToSection(ans, false)));
 payerData.forEach(entry => entry.answers.forEach(ans => addToSection(ans, true)));
 const container = document.createElement('div');
 for (const [section, questions] of Object.entries(sectioned)) {
   const sectionHeader = document.createElement('h3');
   sectionHeader.textContent = section;
   container.appendChild(sectionHeader);
   const showWorker = ![
     "Payee - Section 3 - Payee (worker) information"
   ].includes(section);
   const showPayer = ![
     "Section 1: General information",
     "Worker - Section 2a - Employee information",
     "Worker - Section 2b - Specified shareholder information",
     "Worker - Section 3 - Payers (clients) information"
   ].includes(section);
   if (!showWorker && !showPayer) continue;
   let table = document.createElement('table');
   let theadHTML = '<thead><tr><th>Question</th>';
   if (showWorker) theadHTML += '<th>Worker</th>';
   if (showPayer) theadHTML += '<th>Payer</th>';
   theadHTML += '</tr></thead>';
   table.innerHTML = theadHTML;
   const tbody = document.createElement('tbody');
   for (const [question, { worker, payer }] of Object.entries(questions)) {
     if (!worker && !payer) continue;
     const row = document.createElement('tr');
     let rowHTML = `<td>${question}</td>`;
     if (showWorker) rowHTML += `<td>${worker}</td>`;
     if (showPayer) rowHTML += `<td>${payer}</td>`;
     row.innerHTML = rowHTML;
     tbody.appendChild(row);
   }
   table.appendChild(tbody);
   container.appendChild(table);
 }
 return container;
}
function scoreAnswerById(questionId, answer) {
 const rule = scoringRules[questionId];
 if (!rule) return { score: 0, weight: 0 };
 const normalized = (answer || "").trim().toLowerCase();
 let value = 0;
 if (normalized === "yes") value = rule.yes;
 else if (normalized === "no") value = rule.no;
 return { score: value * rule.weight, weight: rule.weight };
}
function renderProbabilityScore(workerData, payerData) {
 let worker = { totalScore: 0, totalWeight: 0 };
 let payer = { totalScore: 0, totalWeight: 0 };
 function accumulate(data, person) {
   data.forEach(entry => {
     entry.answers.forEach(ans => {
       const { score, weight } = scoreAnswerById(ans.questionId, ans.answer);
       person.totalScore += score;
       person.totalWeight += weight;
     });
   });
 }
 accumulate(workerData, worker);
 accumulate(payerData, payer);
 const workerPercent = worker.totalWeight ? Math.round((worker.totalScore / worker.totalWeight) * 100) : 0;
 const payerPercent = payer.totalWeight ? Math.round((payer.totalScore / payer.totalWeight) * 100) : 0;
 const probabilityDiv = document.getElementById('probability');
 probabilityDiv.innerHTML = `
<h3>Probability Assessment (Weighted)</h3>
   ${generateBar("Worker", workerPercent)}
   ${generateBar("Payer", payerPercent)}
 `;
}
function generateBar(label, percent) {
 let color;
 if (percent >= 75) color = "#d9534f";       // Red = High PSB risk
 else if (percent >= 50) color = "#f0ad4e";   // Orange = Moderate
 else color = "#5cb85c";                      // Green = Low PSB risk
 return `
<div style="margin-bottom: 1em;">
<strong>${label} Probability: ${percent}%</strong>
<div style="width: 100%; background: #eee; height: 24px; border-radius: 4px;">
<div style="width: ${percent}%; background: ${color}; height: 100%; border-radius: 4px;"></div>
</div>
</div>
 `;
}
</script>

</main>
</body>
</html>
