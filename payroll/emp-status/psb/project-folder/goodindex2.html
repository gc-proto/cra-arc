<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Worker vs. payer questionnaire comparison - PSB Determination</title>
<meta content="width=device-width,initial-scale=1" name="viewport">
<meta name="robots" content="noindex, follow">
<!-- WET Assets -->
<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/soyutils.js"></script>
<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/wet-en.js"></script>
<link href="https://test.canada.ca/covid-19-guidance/proto/css/alpha-beta-banner.css" rel="stylesheet">
<link href="https://www.canada.ca/etc/designs/canada/wet-boew/m%C3%A9li-m%C3%A9lo/2023-10-mount-revelstoke.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" crossorigin="anonymous"/>
<link href="https://www.canada.ca/etc/designs/canada/wet-boew/css/theme.min.css" rel="stylesheet">
<!-- Styles -->
<style>
   body {
     font-family: Arial, sans-serif;
     padding: 20px;
   }
   table {
     width: 100%;
     border-collapse: collapse;
     margin-top: 1em;
   }
   th, td {
     border: 1px solid #ccc;
     padding: 8px;
     vertical-align: top;
   }
   th {
     background-color: #f2f2f2;
   }
    pre {
     background: #f4f4f4;
     padding: 10px;
     border-radius: 5px;
   }
   .probability-bar {
     margin-top: 2em;
     background: #eee;
     border-radius: 5px;
     height: 30px;
     position: relative;
     width: 100%;
   }
   .probability-fill {
     height: 100%;
     border-radius: 5px;
     text-align: center;
     line-height: 30px;
     color: white;
     font-weight: bold;
   }
</style>
<script type="text/javascript">
   document.write(wet.builder.refTop({}));
</script>
</head>
<body vocab="http://schema.org/" typeof="WebPage" class="experimental">
<div id="def-top"></div>
<main role="main" property="mainContentOfPage" class="container">
<div class="gc-font-2019">
<h1>Worker vs. payer questionnaire comparison<br>
<small>Questionnaire to determine if the worker's corporation was carrying on a personal services business (PSB)</small>
</h1>
<p>To use the comparison tool:</p>
<ol>
<li>Save the worker and payer JSON files on your computer.</li>
<li>Upload both files below.</li>
<li>Click compare to view side-by-side results and risk score.</li>
</ol>
<h3>Upload the response files (JSON)</h3>
<ul class="list-unstyled cnjnctn-type-and cnjnctn-sm">
<li class="cnjnctn-col">
<label>Worker's response:
<input type="file" id="jsonWorkerInput" accept=".json" />
</label>
</li>
<li class="cnjnctn-col">
<label>Payer's response:
<input type="file" id="jsonPayerInput" accept=".json" />
</label>
</li>
</ul>
<details><summary>How to read the results</summary>
    <h4>Confidence level score</h4>
    <ul>
      <li>Each question has a weight (for example: 2 points for important questions)</li>
      <li>If the answer is <strong>Yes</strong>, the weight is 1</li>
      <li>If the answer is <strong>No</strong>, the weight is 0</li>
      <li>Only questions from Sections 4 and 5 are included in the results</li>
      <li>The final percentage is based on the total weighted answers</li>
    </ul>

    <h4>Yellow highlighting</h4>
    <ul>
      <li>If the worker and payer answers are different, the row is highlighted in <span style="background-color: #fff3cd;">yellow</span></li>
      <li>This helps you quickly spot mismatches between the two responses</li>
    </ul>
 
</details>

<div class="row">
  <div class="col-md-9">
<div id="content"></div>
</div>
   <div class="col-md-3">   
<div id="probability"></div>
</div>
</div>

 <script>
   const sectionMap = {
    340: "Section 1: General information", 
   341: "Section 1: General information",
   335: "Section 1: General information",
    161: "Section 1: General information",
   240: "Section 1: General information",
    241: "Section 1: General information",
   243: "Section 1: General information",

    441:  "Section 2: Information about the business", 
   443:  "Section 2: Information about the business",  
  
   315: "Section 2: Information about the business",
    318: "Section 2: Information about the business",
    319: "Section 2: Information about the business",
    317: "Section 2: Information about the business",
    320: "Section 2: Information about the business", 
    321: "Section 2: Information about the business",
    322: "Section 2: Information about the business",
     323: "Section 2: Information about the business",
    324: "Section 2: Information about the business",
    325: "Section 2: Information about the business",
    326: "Section 2: Information about the business", 
    327: "Section 2: Information about the business",
    328: "Section 2: Information about the business",
    329: "Section 2: Information about the business",
    330: "Section 2: Information about the business",
    331: "Section 2: Information about the business", 
    332: "Section 2: Information about the business",
    333: "Section 2: Information about the business",
    334: "Section 2: Information about the business",
    316: "Section 2: Information about the business",
   
 339: "Worker - Section 2a - Employee information",
    170: "Worker - Section 2a - Employee information",
 356: "Worker - Section 2a - Employee information",   
  464: "Worker - Section 2a - Employee information",      

   342: "Worker - Section 2b - Specified shareholder information",     
 245: "Worker - Section 2b - Specified shareholder information",   
 352: "Worker - Section 2b - Specified shareholder information",  
  465: "Worker - Section 2b - Specified shareholder information",     
 
       444: "Payer - Section 3 - Payee (worker) information",   
       445: "Payer - Section 3 - Payee (worker) information",   
       446: "Payer - Section 3 - Payee (worker) information",   
       447: "Payer - Section 3 - Payee (worker) information",   
       448: "Payer - Section 3 - Payee (worker) information",   
       449: "Payer - Section 3 - Payee (worker) information",   
       450: "Payer - Section 3 - Payee (worker) information",   
       451: "Payer - Section 3 - Payee (worker) information",   
       452: "Payer - Section 3 - Payee (worker) information",   

     358: "Worker - Section 3 - Payers (clients) information",  
     314: "Worker - Section 3 - Payers (clients) information",   
              31401: "Worker - Section 3 - Payers (clients) information",   
          31407: "Worker - Section 3 - Payers (clients) information",   
          31402: "Worker - Section 3 - Payers (clients) information",
          31403: "Worker - Section 3 - Payers (clients) information",
          31404: "Worker - Section 3 - Payers (clients) information", 
          31405: "Worker - Section 3 - Payers (clients) information", 
          31410: "Worker - Section 3 - Payers (clients) information", 
          31411: "Worker - Section 3 - Payers (clients) information", 
          31412: "Worker - Section 3 - Payers (clients) information", 
          31406: "Worker - Section 3 - Payers (clients) information", 


 350: "Section 4 - Contract or agreement information",    
 236: "Section 4 - Contract or agreement information",    
 207: "Section 4 - Contract or agreement information",    
 206: "Section 4 - Contract or agreement information",   
 351: "Section 4 - Contract or agreement information",   
 379: "Section 4 - Contract or agreement information",  
 347: "Section 4 - Contract or agreement information", 
 348: "Section 4 - Contract or agreement information", 
 380: "Section 4 - Contract or agreement information", 
 382: "Section 4 - Contract or agreement information", 
 423: "Section 4 - Contract or agreement information", 
 349: "Section 4 - Contract or agreement information", 


189: "Section 5 - Working relationship information",     
389: "Section 5 - Working relationship information",         
    
 390: "Section 5 - Working relationship information - Contract formed in a province or territory other than Quebec",  
   
 192: "Subsection 5a - Control - Duties (1 of 8)", 
 383: "Subsection 5a - Control - Duties (1 of 8)", 
 424: "Subsection 5a - Control - Duties (1 of 8)",  
 258: "Subsection 5a - Control - Duties (1 of 8)",  
 257: "Subsection 5a - Control - Duties (1 of 8)",   

     259: "Subsection 5a - Control - Work schedule (2 of 8)", 
   261: "Subsection 5a - Control - Work schedule (2 of 8)",   
     262: "Subsection 5a - Control - Work schedule (2 of 8)",   
      263: "Subsection 5a - Control - Work schedule (2 of 8)",   
      264: "Subsection 5a - Control - Work schedule (2 of 8)",   
      265: "Subsection 5a - Control - Work schedule (2 of 8)",   

     191: "Subsection 5a - Control - Degree of autonomy (3 of 8)",   
         267: "Subsection 5a - Control - Degree of autonomy (3 of 8)",   
     268: "Subsection 5a - Control - Degree of autonomy (3 of 8)",   
         312: "Subsection 5a - Control - Degree of autonomy (3 of 8)",   
    
    297: "Subsection 5a - Control - Remuneration (4 of 8)",  
    298: "Subsection 5a - Control - Remuneration (4 of 8)",  
     299: "Subsection 5a - Control - Remuneration (4 of 8)",  
     271: "Subsection 5a - Control - Remuneration (4 of 8)",  
     300: "Subsection 5a - Control - Remuneration (4 of 8)",  
     385: "Subsection 5a - Control - Remuneration (4 of 8)",  
     301: "Subsection 5a - Control - Remuneration (4 of 8)",  
    270: "Subsection 5a - Control - Remuneration (4 of 8)",
     302: "Subsection 5a - Control - Remuneration (4 of 8)",
    303: "Subsection 5a - Control - Remuneration (4 of 8)",
    304: "Subsection 5a - Control - Remuneration (4 of 8)",
    306: "Subsection 5a - Control - Remuneration (4 of 8)",
    386: "Subsection 5a - Control - Remuneration (4 of 8)",

 195: "Subsection 5a - Control - Location of services (5 of 8)",    
   296: "Subsection 5a - Control - Location of services (5 of 8)",    
     426: "Subsection 5a - Control - Location of services (5 of 8)",  

     274: "Subsection 5a - Control - Right to exercise punitive action and or terminate the relationship (6 of 8)", 
       275: "Subsection 5a - Control - Right to exercise punitive action and or terminate the relationship (6 of 8)", 
       428: "Subsection 5a - Control - Right to exercise punitive action and or terminate the relationship (6 of 8)", 
       276: "Subsection 5a - Control - Right to exercise punitive action and or terminate the relationship (6 of 8)", 
       388: "Subsection 5a - Control - Right to exercise punitive action and or terminate the relationship (6 of 8)", 
     429: "Subsection 5a - Control - Right to exercise punitive action and or terminate the relationship (6 of 8)", 

      278: "Subsection 5a - Control - How the work is done (7 of 8)", 
          280: "Subsection 5a - Control - How the work is done (7 of 8)", 
         309: "Subsection 5a - Control - How the work is done (7 of 8)", 
          310: "Subsection 5a - Control - How the work is done (7 of 8)", 
      311: "Subsection 5a - Control - How the work is done (7 of 8)", 
    459: "Subsection 5a - Control - How the work is done (7 of 8)", 

      198: "Subsection 5a - Control - Training (8 of 8)", 
          281: "Subsection 5a - Control - Training (8 of 8)", 
          282: "Subsection 5a - Control - Training (8 of 8)", 
          283: "Subsection 5a - Control - Training (8 of 8)", 

    
 290: "Subsection 5b - Ownership of tools or equipment", 
 208: "Subsection 5b - Ownership of tools or equipment", 
 210: "Subsection 5b - Ownership of tools or equipment",  
 284: "Subsection 5b - Ownership of tools or equipment",  
 285: "Subsection 5b - Ownership of tools or equipment", 
 286: "Subsection 5b - Ownership of tools or equipment",  

   430: "Subsection 5c - Financial information",  
     211: "Subsection 5c - Financial information",  
     214: "Subsection 5c - Financial information",  
     216: "Subsection 5c - Financial information",  
     218: "Subsection 5c - Financial information",  
     217: "Subsection 5c - Financial information",  
     215: "Subsection 5c - Financial information",  
     219: "Subsection 5c - Financial information",  
     233: "Subsection 5c - Financial information",  
    234: "Subsection 5c - Financial information",  

 391: "Section 5 - Working relationship information - Contract formed in the province of Quebec",      
   
    
   431: "Subsection 5a - Carrying out the work",   
   397: "Subsection 5a - Carrying out the work", 
     398: "Subsection 5a - Carrying out the work", 
     433: "Subsection 5a - Carrying out the work", 
     399: "Subsection 5a - Carrying out the work", 
     432: "Subsection 5a - Carrying out the work", 
     393: "Subsection 5a - Carrying out the work", 
     394: "Subsection 5a - Carrying out the work", 
     

   400: "Subsection 5b - Remuneration",   
  402: "Subsection 5b - Remuneration", 
  403: "Subsection 5b - Remuneration", 
      434: "Subsection 5b - Remuneration", 
      404: "Subsection 5b - Remuneration", 
      435: "Subsection 5b - Remuneration", 
      405: "Subsection 5b - Remuneration", 
      406: "Subsection 5b - Remuneration", 
      407: "Subsection 5b - Remuneration", 
      408: "Subsection 5b - Remuneration", 
      410: "Subsection 5b - Remuneration", 
      436: "Subsection 5b - Remuneration", 
      411: "Subsection 5b - Remuneration", 

     
     412: "Subsection 5c - Relationship of subordination", 
     413: "Subsection 5c - Relationship of subordination",  
    414: "Subsection 5c - Relationship of subordination",  
    415: "Subsection 5c - Relationship of subordination",  
    416: "Subsection 5c - Relationship of subordination",  
    417: "Subsection 5c - Relationship of subordination",  
    418: "Subsection 5c - Relationship of subordination",  
    419: "Subsection 5c - Relationship of subordination",  
    420: "Subsection 5c - Relationship of subordination",  
    421: "Subsection 5c - Relationship of subordination",  
   422: "Subsection 5c - Relationship of subordination",  
   438: "Subsection 5c - Relationship of subordination",  
   439: "Subsection 5c - Relationship of subordination",   
   460: "Subsection 5c - Relationship of subordination",    

 360: "Section 6 - Certification", 
 363: "Section 6 - Certification", 
  376: "Section 6 - Certification", 
     364: "Section 6 - Certification", 
     366: "Section 6 - Certification", 
     373: "Section 6 - Certification", 
    375: "Section 6 - Certification", 
     362: "Section 6 - Certification"
   // Add more mappings as needed
 };

    const questionWeights = {

       170: 2, 
       245: 2,
       31411: 1, 
       31412: 1, 
       31406: 1,
       451: 1,
       452: 1,
       206: 0,
       351: 1,
       347: 1,
       348: 1,
       380: 1,
       382: 1,
       192: 1,  
       383: 1,  
       258: 1,   
       257: 1,        
       259: 1,    
       261: 1,        
       262: 1,         
       263: 1,         
       264: 1,         
       265: 1,        
       191: 1,            
       267: 1,        
       268: 1,            
       297: 1,      
       298: 1,       
       299: 1,       
       271: 1,       
       300: 1,       
       301: 1,      
       270: 1,     
       302: 1,    
       303: 1,    
       304: 1,    
       306: 1,    
       195: 1,       
       296: 1,         
       274: 1,        
       275: 1,        
       428: 1,        
       276: 1,        
       429: 1, 
       278: 1,           
       280: 1,          
       309: 1,           
       310: 1,       
       459: 1,       
       198: 1,         
       281: 1,           
       282: 1,           
       283: 1,  
       290: 1,  
       208: 1,  
       284: 1,   
       285: 1,  
       286: 1,     
       430: 1,       
       211: 1,       
       214: 1,       
       216: 1,       
       217: 1,       
       219: 1,       
       233: 1,      
       431: 1,  
       397: 1,      
       398: 1,      
       399: 1,      
       393: 1,      
       394: 1,      
       400: 1,     
       402: 1,   
       403: 1,       
       434: 1,       
       404: 1,       
       405: 1, 
       406: 1,       
       407: 1,       
       408: 1,       
       410: 1,       
       411: 1,
       412: 1,
       413: 1,
       414: 1,
       415: 1,
       416: 1,
       417: 1,
       418: 1,
       419: 1,
       420: 1,
       421: 1,
       422: 1,
       438: 1,
       439: 1,
      
       350: 1,
       236: 1,  
       207: 1,     
       206: 1,    
       351: 1,    
       379: 1,   
       347: 1,  
       348: 1,  
       380: 1,  
       382: 1,  
       423: 1,  
       349: 1, 

       192: 1,  
       383: 1,  
       424: 1,   
       258: 1,   
       257: 1,        
       259: 1,    
       261: 1,        
       262: 1,         
       263: 1,         
       264: 1,         
       265: 1,        
       191: 1,            
       267: 1,        
       268: 1,            
       312: 1,           
       297: 1,      
       298: 1,       
       299: 1,       
       271: 1,       
       300: 1,       
       385: 1,       
       301: 1,      
       270: 1,     
       302: 1,    
       303: 1,    
       304: 1,    
       306: 1    
    
};

const excludedSections = new Set([
  "Section 1: General information",
  "Section 2: Information about the business",
  "Worker - Section 2a - Employee information",
  "Worker - Section 2b - Specified shareholder information",
  "Payer - Section 3 - Payee (worker) information",
  "Worker - Section 3 - Payers (clients) information",
  "Section 6 - Certification"
]);
let workerData = null;
let payerData = null;
document.getElementById('jsonWorkerInput').addEventListener('change', function (event) {
 const file = event.target.files[0];
 if (!file) return;
 const reader = new FileReader();
 reader.onload = function (e) {
   try {
     workerData = JSON.parse(e.target.result);
     tryRenderBoth();
   } catch (err) {
     alert("Invalid worker JSON file");
   }
 };
 reader.readAsText(file);
});
    
document.getElementById('jsonPayerInput').addEventListener('change', function (event) {
 const file = event.target.files[0];
 if (!file) return;
 const reader = new FileReader();
 reader.onload = function (e) {
   try {
     payerData = JSON.parse(e.target.result);
     tryRenderBoth();
   } catch (err) {
     alert("Invalid payer JSON file");
   }
 };
 reader.readAsText(file);
});
function tryRenderBoth() {
  if (workerData && payerData) {
    const container = document.getElementById('content');
    container.innerHTML = '';
    container.appendChild(renderJSON(workerData, payerData));
    
    // Add this line to render the probability score
    renderProbabilityScore(workerData, payerData);
  }
}


 function renderJSON(workerData, payerData) {
   const sectioned = {};

   function addToSection(ans, isPayer = false) {
    const section = sectionMap[ans.questionId] || "Other";
    if (!sectioned[section]) sectioned[section] = {};
    if (!sectioned[section][ans.questionEn]) {
      sectioned[section][ans.questionEn] = {
        worker: "", payer: "", rawWorker: "", rawPayer: ""
      };
    }
    const formatted = formatAnswer(ans.answer);
    
const raw = typeof ans.answer === 'string' ? ans.answer.trim().toLowerCase() : JSON.stringify(ans.answer);
  
    if (isPayer) {
      sectioned[section][ans.questionEn].payer = formatted;
      sectioned[section][ans.questionEn].rawPayer = raw;
    } else {
      sectioned[section][ans.questionEn].worker = formatted;
      sectioned[section][ans.questionEn].rawWorker = raw;
    }
  }

  function formatAnswer(answer) {
    if (Array.isArray(answer)) {
      return answer.map(group =>
        group.map(sub =>
          `${sub.questionEn}: ${sub.answer}`
        ).join("<br>")
      ).join("<hr>");
    }
    return answer || "";
  }

    const skipMismatchHighlighting = [
  "Section 1: General information",
  "Section 2: Information about the business",
  "Worker - Section 2a - Employee information",
  "Worker - Section 2b - Specified shareholder information",
  "Payer - Section 3 - Payee (worker) information",
  "Worker - Section 3 - Payers (clients) information",
  "Section 6 - Certification"
      
];

 

  workerData.forEach(entry => entry.answers.forEach(ans => addToSection(ans, false)));
  payerData.forEach(entry => entry.answers.forEach(ans => addToSection(ans, true)));
  const container = document.createElement('div');



  for (const [section, questions] of Object.entries(sectioned)) {
    const table = document.createElement('table');

    const showWorker = !["Payer - Section 3 - Payee (worker) information"].includes(section);
    const showPayer = ![
      "Section 1: General information",
      "Worker - Section 2a - Employee information",
      "Worker - Section 2b - Specified shareholder information",
      "Worker - Section 3 - Payers (clients) information"
    ].includes(section);

    if (!showWorker && !showPayer) continue;

    let theadHTML = '<thead><tr><th>Question</th>';
    if (showWorker) theadHTML += '<th>Worker</th>';
    if (showPayer) theadHTML += '<th>Payer</th>';
    theadHTML += '</tr></thead>';
    table.innerHTML = theadHTML;

    const tbody = document.createElement('tbody');
    let rowCount = 0;

    for (const [question, data] of Object.entries(questions)) {
      const { worker, payer, rawWorker, rawPayer } = data;
      if (!worker && !payer) continue;

    
    
      const isMismatch = !skipMismatchHighlighting.includes(section) &&
                   rawWorker && rawPayer && rawWorker !== rawPayer;



      const row = document.createElement('tr');
      let rowHTML = `<td>${question}</td>`;
      if (showWorker) rowHTML += `<td style="${isMismatch ? 'background-color: #fff3cd;' : ''}">${worker}</td>`;
      if (showPayer) rowHTML += `<td style="${isMismatch ? 'background-color: #fff3cd;' : ''}">${payer}</td>`;
      row.innerHTML = rowHTML;
      tbody.appendChild(row);
      rowCount++;
    }

    if (rowCount > 0) {
      const sectionHeader = document.createElement('h3');
      sectionHeader.textContent = section;
      container.appendChild(sectionHeader);
      table.appendChild(tbody);
      container.appendChild(table);
    }
  }

  return container;
}

    
function renderProbabilityScore(workerData, payerData) {
  let totalQuestions = 0;
  let workerScore = 0;
  let payerScore = 0;

  function scoreAnswer(answer, questionId) {
    if (typeof answer === 'string') {
      return answer.trim().toLowerCase() === 'yes' ? (questionWeights[questionId] || 1) : 0;
    }
    return 0;
  }

  workerData.forEach(entry => {
    entry.answers.forEach(ans => {
      const section = sectionMap[ans.questionId] || "Other";
      const normalizedSection = section.trim().toLowerCase();
      if (!excludedSections.has(normalizedSection)) {
        totalQuestions++;
        workerScore += scoreAnswer(ans.answer, ans.questionId);
      }
    });
  });

  payerData.forEach(entry => {
    entry.answers.forEach(ans => {
      const section = sectionMap[ans.questionId] || "Other";
      const normalizedSection = section.trim().toLowerCase();
      if (!excludedSections.has(normalizedSection)) {
        payerScore += scoreAnswer(ans.answer, ans.questionId);
      }
    });
  });

  const workerPercent = totalQuestions ? Math.round((workerScore / totalQuestions) * 100) : 0;
  const payerPercent = totalQuestions ? Math.round((payerScore / totalQuestions) * 100) : 0;

  const probabilityDiv = document.getElementById('probability');
  probabilityDiv.innerHTML = `
    <h3>Confidence level</h3>
    <p><strong>Based on the answers:</strong><br> The percentage is the confidence level <strong>indicator of employment</strong></p>
    ${generateBar("Worker's response", workerPercent)}
    ${generateBar("Payer's response", payerPercent)}
  `;
}

    
function generateBar(label, percent) {
 let color = "#28a745"; // green
 if (percent < 75) color = "#ffc107"; // yellow
 if (percent < 50) color = "#fd7e14"; // orange
 if (percent < 25) color = "#dc3545"; // red
 return `
<div style="margin-bottom:1em">
<label>${label}: ${percent}% (${describeProbability(percent)})</label>
<div class="probability-bar">
<div class="probability-fill" style="width: ${percent}%; background-color: ${color};">
         ${percent}%
</div>
</div>
</div>
 `;
}

   function describeProbability(percent) {
 if (percent >= 20) return "highly probable";
 if (percent >= 40) return "probable";
 if (percent >= 60) return "neutral";
 if (percent >= 80) return "unlikely";
 return "highly unlikely";
}

 // Optional: WET preFooter
 var defPreFooter = document.getElementById("def-preFooter");
 defPreFooter.outerHTML = wet.builder.preFooter({
   dateModified: "2025-06-02",
   showPostContent: true,
   showFeedback: true,
   showShare: true
 });
</script>
  <!-- Probability bar container -->
<div id="probability" style="margin-top: 2em;"></div>
<!-- WET PreFooter -->

</div></main>

</body>
</html>
