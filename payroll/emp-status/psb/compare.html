<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!-- Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW) wet-boew.github.io/wet-boew/License-en.html / wet-boew.github.io/wet-boew/Licence-fr.html -->
<title>Comparison tool - Questionnaire to determine if the worker's corporation was carrying on a personal services business (PSB)</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
 
         <meta content="width=device-width,initial-scale=1" name="viewport">
<meta name="robots" content="noindex, follow">
<!-- Meta data-->
<!-- Load closure template scripts -->
<script type="text/javascript" src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/soyutils.js"></script>
<script type="text/javascript" src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/wet-en.js"></script>
<link href="https://test.canada.ca/covid-19-guidance/proto/css/alpha-beta-banner.css" rel="stylesheet">
<link href="https://www.canada.ca/etc/designs/canada/wet-boew/m%C3%A9li-m%C3%A9lo/2023-10-mount-revelstoke.min.css" rel="stylesheet">
<link href="https://www.canada.ca/etc/designs/canada/wet-boew/css/theme.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
<!-- Write closure template -->
<script type="text/javascript">
            document.write(wet.builder.refTop({
            }));
</script>
<style>
   body { font-family: Arial, sans-serif; padding: 20px; }
   table { width: 100%; border-collapse: collapse; margin-top: 20px; }
   th, td { border: 1px solid #ccc; padding: 8px; text-align: left; font-size: 14px; }
   th { background-color: #f4f4f4; }
   .match { background-color: #d6f5d6; }      /* Light green */
   .mismatch { background-color: #fff3cd; }   /* Light yellow */
   .missing { background-color: #f8d7da; }    /* Light red */
   #pdfButton { margin-top: 20px; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body vocab="http://schema.org/" typeof="WebPage" class="experimental">
<div id="def-top">         </div>
<main role="main" property="mainContentOfPage" class="container">

<div class="gc-font-2019">
<h1>Comparison tool - Questionnaire to determine if the worker's corporation was carrying on a personal services business (PSB)</h1>
<p>To use the comparison tool:</p>
<ol>
<li>Save the file worker and the file payer on your computer</li>
<li>Upload the response files (JSON) for the worker and the payer</li>
<li>Click compare to view side-by-side results (if the results do not match, they are highlighted in red)</li>
</ol>
<hr>
<h2>Upload the response files (JSON)</h2>
 <ul class="list-unstyled cnjnctn-type-and cnjnctn-sm">
   <li class="cnjnctn-col"><h3>Worker</h3>
<label>Worker' response: <input type="file" id="workerFile" class="gc-font-2019" accept=".json"></label></li>
<li class="cnjnctn-col"><h3>Payer</h3>
<label>Payer's response: <input type="file" id="payerFile" class="gc-font-2019" accept=".json"></label></li>
</ul>

<button class="btn btn-primary btn-lg" onclick="compare()">Compare</button>



<div id="output"></div>
<script>
   let tableData = [];
   function compare() {
     const workerFile = document.getElementById('workerFile').files[0];
     const payerFile = document.getElementById('payerFile').files[0];
     if (!workerFile || !payerFile) {
       alert("Please select both JSON files.");
       return;
     }
     Promise.all([workerFile.text(), payerFile.text()])
       .then(([workerText, payerText]) => {
         const workerJSON = JSON.parse(workerText);
         const payerJSON = JSON.parse(payerText);
         const workerMap = buildQuestionMap(workerJSON.elements);
         const payerMap = buildQuestionMap(payerJSON.elements);
         const allIds = Array.from(new Set([...Object.keys(workerMap), ...Object.keys(payerMap)]));
         tableData = [];
         allIds.forEach(id => {
           const w = workerMap[id];
           const p = payerMap[id];
           const wTitle = w?.titleEn || '[Missing]';
           const pTitle = p?.titleEn || '[Missing]';
           const wChoices = w?.choices?.map(c => c.en).join(', ') || '[None]';
           const pChoices = p?.choices?.map(c => c.en).join(', ') || '[None]';
           const match = wChoices === pChoices;
           const existsInBoth = !!w && !!p;
           tableData.push({
             id,
             wTitle,
             pTitle,
             wChoices,
             pChoices,
             match,
             existsInBoth
           });
         });
         renderTable();
       });
   }
   function buildQuestionMap(elements) {
     const map = {};
     elements.forEach(el => {
       const qid = el?.properties?.questionId;
       if (qid) {
         map[qid] = {
           titleEn: el.properties.titleEn,
           choices: el.properties.choices || []
         };
       }
     });
     return map;
   }
   function renderTable() {
     let html = `<table>
<thead>
<tr>
<th>Question ID</th>
<th>Worker question</th>
<th>Payer question</th>
<th>Worker choices</th>
<th>Payer choices</th>
<th>Match</th>
<th>Mismatch</th>
</tr>
</thead>
<tbody>`;
     tableData.forEach(row => {
       const rowClass = row.existsInBoth
         ? (row.match ? "match" : "mismatch")
         : "missing";
       html += `<tr class="${rowClass}">
<td>${row.id}</td>
<td>${row.wTitle}</td>
<td>${row.pTitle}</td>
<td>${row.wChoices}</td>
<td>${row.pChoices}</td>
<td>${row.match ? "Yes" : ""}</td>
<td>${!row.match && row.existsInBoth ? "Yes" : ""}</td>
</tr>`;
     });
     html += '</tbody></table>';
     document.getElementById('output').innerHTML = html;
     document.getElementById('pdfButton').style.display = 'inline-block';
   }
   function downloadPDF() {
     const { jsPDF } = window.jspdf;
     const doc = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'a4' });
     doc.setFontSize(14);
     doc.text("Questionnaire Comparison Report", 40, 30);
     doc.setFontSize(10);
     let y = 50;
     const lineHeight = 16;
     tableData.forEach(row => {
       if (y > 550) {
         doc.addPage();
         y = 50;
       }
       doc.setTextColor(row.match ? [0, 150, 0] : [200, 150, 0]);
       doc.text(`ID: ${row.id}`, 40, y);
       doc.text(`W: ${row.wTitle}`, 100, y);
       doc.text(`P: ${row.pTitle}`, 300, y);
       y += lineHeight;
     });
     doc.save("questionnaire-comparison.pdf");
   }
</script></div>
<div id="def-footer">
</div>
<div id="def-preFooter"></div>
<!-- Write closure template -->
<script type="text/javascript">
               var defPreFooter = document.getElementById("def-preFooter");
               defPreFooter.outerHTML = wet.builder.preFooter({
               dateModified: "2025-05-27",
               showPostContent: true,
               showFeedback: true,
               showShare: true
               });
</script>
   </main>
</body>
</html>
