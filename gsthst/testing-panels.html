<!DOCTYPE html>
<!--[if lt IE 9]>
<html class="no-js lt-ie9" lang="en" dir="ltr">
   <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" dir="ltr" lang="en" xmlns="http://www.w3.org/1999/xhtml">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <!-- Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW) wet-boew.github.io/wet-boew/License-en.html / wet-boew.github.io/wet-boew/Licence-fr.html -->
    <title>Tax-Free First Home Savings Account Estimators - Canada.ca</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta name="robots" content="noindex, follow">
    <!-- Meta data -->
    <!-- Meta data-->
    <!-- Load closure template scripts -->
    <script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_43/cdts/compiled/soyutils.js"></script>
    <script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_43/cdts/compiled/wet-en.js"></script>
    <link rel="stylesheet" href="https://www.canada.ca/etc/designs/canada/wet-boew/css/theme.min.css">
    <link rel="stylesheet" href="https://wet-boew.github.io/themes-dist/GCWeb/GCWeb/méli-mélo/2024-09-kejimkujik.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <style>

      /* CSS Document */
      h1#wb-cont {
          border-bottom: none;
      }

      /* Remove text decoration for abbr tags (equations) */
      abbr.brdr-0 {
          text-decoration: none !important;
      }

      section.gc-nav h1 {
          font-size: 1.3em;
          color: #555;
          border-bottom: none;
      }

      /*page structure desktop (new) */
      @media all and (min-width:992px) {
          section.gc-nav nav {
              position: relative;
              width: 33.33%;
              left: 66.66%;
              float: left;
              padding-left: 15px;
              margin-bottom: 30px;
          }

          section.gc-nav h1 {
              width: 66.66%;
              padding-right: 15px;
              margin-top: 20px;
              margin-bottom: -5px;
              font-weight: 200;
          }

          section.gc-nav-section {
              position: relative;
              width: 66.66%;
              float: left;
              padding-right: 15px;
          }

          section.gc-nav~section.gc-nav-section {
              right: 33.33%;
          }

          section.gc-nav~section.gc-nav-section h1 {
              margin-top: 0px
          }

          section.gc-nav-section+.pagedetails {
              clear: both;
          }
      }

      #gc-navseq-header {
          font-size: 1.2em;
          margin-top: 0px;
      }

      .gc-navseq {
          padding-left: 0.9em;
      }

      .gc-navseq .small, .gc-navseq small {
          line-height: 0em;
      }

      .gc-navseq * {
          font-weight: inherit !important;
          line-height: inherit !important
      }

      .gc-navseq>li, ul.gc-navseq-fa>li {
          padding-bottom: 20px;
          padding-right: 20px;
          list-style: none;
          padding-left: 1.2em;
          border-left: 5px solid #26374a;
          position: relative;
      }

      ul.gc-navseq-fa>li .fa-li {
          left: 0em;
          position: relative;
      }

      ul.gc-navseq-fa {
          margin-left: 0.9em
      }

      li .gc-navseq {
          margin-top: 16px;
      }

      .gc-navseq>li>:first-child::before, ul.gc-navseq-fa li span.fa-li {
          border-radius: 50%;
          border: 3px solid #26374a;
          background-color: #fff;
          float: left;
          text-decoration: none;
          box-sizing: content-box;
          line-height: 1.3em;
          text-align: center;
          padding: 3px;
          font-size: 1.0em;
          /* transition: width 0.2s, height 0.2s, margin-top 0.2s, font-size 0.2s, margin-left 0.2s, line-height 0.2s; */
      }

      ul.gc-navseq-fa li span.fa-li {
          height: 1.3em;
          width: 1.3em;
          margin-left: -2.3em;
      }

      ul.gc-navseq>li>:first-child::before {
          height: 0.8em;
          width: 0.8em;
          margin-left: -2.05em;
          content: "";
      }

      @-moz-document url-prefix() {
          ul.gc-navseq>li>:first-child::before {
              margin-left: -2.0em;
          }
      }

      .gc-navseq li a::before {
          text-decoration: underline;
      }

      ul.gc-navseq.noline>li {
          border-left: 5px solid transparent
      }

      .gc-navseq>li:last-child, .gc-navseq>li.completed:last-child, ul.gc-navseq-fa li:last-child {
          border-left: 5px solid transparent;
          padding-bottom: 0;
      }

      ul.gc-navseq.noline>li>:first-child::before {
          margin-top: 0.2em
      }

      /*active*/
      .gc-navseq li.active>:first-child::before, .gc-navseq-fa li.active span.fa-li {
          background-color: #26374a;
          color: #fff;
      }

      /*sub-steps*/
      .gc-navseq li ul {
          margin-top: 16px !important;
      }

      /*Hover animation */
      ul.gc-navseq>li>a[href]:hover::before {
          width: 0.83em;
          height: 0.83em;
          margin-top: -0.1em;
          font-size: 1.2em;
          margin-left: -1.775em;
          line-height: 1.55;
      }

      ul.gc-navseq.noline>li>a[href]:hover::before {
          margin-top: 0.15em;
      }

      .gc-navseq-fa>li>a[href]:hover span.fa-li {
          width: 1.55em;
          height: 1.55em;
          margin-top: -0.05em;
          margin-left: -2.45em;
      }

      .gc-navseq-fa>li>a[href]:hover span.fa-li::before {
          margin-top: -0.1em;
      }

      /*Vertical steps in mobile */
      @media screen and (max-width:991px) {
          section.gc-nav {
              margin-top: 30px;
              border-right: 5px solid #26374a;
              border-top: 5px solid #26374a;
              border-radius: 0 6px 6px 0;
          }

          section.gc-nav nav>.gc-navseq {
              padding-top: 15px;
              margin-top: -18px;
              clear: both;
          }

          section.gc-nav nav>.gc-navseq>li:last-child {
              border-bottom: 5px solid #26374a;
              border-left: 5px solid #26374a;
              border-bottom-left-radius: 6px;
              padding-bottom: 24px;
          }

          section.gc-nav h1 {
              margin-bottom: -18px;
              margin-right: 20px;
              background-color: white;
              padding: 20px 10px 10px 20px;
              display: block;
              margin-left: -20px;
              margin-top: -40px;
              float: left;
          }
      }

      /*nav buttons */
      .gc-navseq-nav-btn:hover, .gc-navseq-nav-btn:focus, .gc-navseq-nav-btn:visited {
          display: inline-block;
          color: #fff;
          text-decoration: none;
          padding: 5px;
      }

      .gc-navseq-nav-btn {
          background-color: #26374a;
      }

      .gc-navseq-nav-btn:hover {
          background-color: #444;
      }

      .gc-navseq-nav-btn:not(:focus) {
          clip: rect(1px, 1px, 1px, 1px);
          height: 1px;
          margin: 0;
          overflow: hidden;
          position: absolute;
          width: 1px;
      }

      @media all and (min-width:992px) {
          #gc-navseq-nav {
              display: flex;
          }
      }

      /*Navigation template in mobile */
      @media all and (max-width:991px) {
          .gc-nav nav {
              padding-top: 40px;
          }
      }

      #gc-navseq-nav {
          margin-bottom: 0;
          list-style: none;
          padding-left: 0;
      }

      .gc-navseq-nav-btn:focus {
          position: relative;
      }

      /* new topic style */
      h1 {
          border-bottom: none;
      }

      h1#wb-cont::after {
          content: "";
          /* This is necessary for the pseudo element to work. */
          display: block;
          /* This will put the pseudo element on its own line. */
          width: 70px;
          /* Change this to whatever width you want to have before hover. */
          padding-bottom: 8px;
          /* This creates some space between the element and the border. */
          border-bottom: .18em solid #af3c43;
          /* This creates the border. Replace black with whatever color you want. */
      }

      /* Styled ordered list design */
      ol.lst-stps, .lst-stps {
          counter-reset: item;
      }

      ol.lst-stps, .lst-stps {
          margin: 15px 0 15px 0px;
          padding-left: 0;
          position: relative;
      }
      ol.lst-stps>li, .lst-stps>.lst-item {
          counter-increment: item;
      }
      ol.lst-stps>li, .lst-stps .lst-item {
          list-style: none;
          margin-top: 30px;
          position: relative;
          padding-left: 60px;
          padding-right: 15px;
          min-height: 2.2em;
      }
      ol.lst-stps fieldset {
          padding-top: 0;
      }
      ol.lst-stps li>*:last-child, .lst-stps .lst-item>*:last-child {
          margin-bottom: 0px;
      }
      ol.lst-stps>li:before, .lst-stps .lst-item:before {
          content: counter(item);
      }
      ol.lst-stps li>ol, .lst-stps .lst-item>.sub-lst-stps {
          counter-reset: subitem;
      }

      ol.lst-stps li>ol {
          margin-left: -35px;
      }

      .lst-stps .lst-item {
          position: relative;
          padding-left: 60px;
          margin-top: 30px;
      }
      ol.lst-stps li:before, .lst-stps .lst-item:before {
          -webkit-border-radius: 50%;
          -moz-border-radius: 50%;
          border-radius: 50%;
          border: 3px solid #26374a;
          background-color: #fff;
          float: left;
          position: absolute;
          box-sizing: content-box;
          line-height: 2.2;
          text-align: center;
          font-weight: 600;
          height: 2.2em;
          width: 2.2em;
          left: 0px;
          margin-top: -8px;
      }

      ol.lst-stps>li>ol>li:before, .lst-stps>.lst-item>.sub-lst-stps>.lst-item:before {
          counter-increment: subitem;
          content: counter(item) ""counter(subitem, lower-alpha) "";
      }
      .sub-lst-stps>.lst-item:last-child {
          margin-bottom: 0px
      }

      .lst-stps-striped>li ol, .lst-stps-striped>.lst-item>.sub-lst-stps {
          margin-top: 15px;
      }
      .lst-stps.lst-stps-striped li, .lst-stps.lst-stps-striped .lst-item {
          padding-top: 23px;
          padding-bottom: 23px;
          margin-top: 0px;
      }
      .lst-stps-striped>li:nth-child(odd), .lst-stps-striped>li:nth-child(even)>ol>li:nth-child(odd), .lst-stps-striped>li:nth-child(odd)>ol>li:nth-child(even), .lst-stps-striped>.lst-item:nth-child(odd), .lst-stps-striped>.lst-item:nth-child(even)>.sub-lst-stps>.lst-item:nth-child(odd), .lst-stps-striped>.lst-item:nth-child(odd)>.sub-lst-stps>.lst-item:nth-child(even) {
          background-color: #f5f5f5;
      }
      .lst-stps-striped>li:nth-child(odd)>ol>li:nth-child(odd), .lst-stps-striped>.lst-item:nth-child(odd)>.sub-lst-stps>.lst-item:nth-child(odd) {
          background-color: #fff !important;
      }
      .lst-stps-striped>li:nth-child(even)>ol>li:nth-child(even):last-child, .lst-stps-striped>li:nth-child(odd)>ol>li:nth-child(even):last-child, .lst-stps-striped>.lst-item:nth-child(even)>.sub-lst-stps>.lst-item:nth-child(even):last-child, .lst-stps-striped>.lst-item:nth-child(odd)>.sub-lst-stps>.lst-item:nth-child(even):last-child {
          padding-bottom: 0px;
      }
      ol.lst-stps li>:first-child, .lst-stps .lst-item>:first-child {
          margin-top: auto;
      }
      ol.lst-stps.lst-stps-striped li, .lst-stps.lst-stps-striped .lst-item {
          padding-left: 75px;
      }
      .lst-stps-striped li:before, .lst-stps-striped .lst-item:before {
          margin-left: 15px;
      }

      /* ol.lst-stps li ul, ol.lst-stps li ul li, ol.lst-stps.lst-stps-striped li ul, ol.lst-stps.lst-stps-striped li ul li { padding-left: 0px; } */
      @media all and (max-width: 767px) {
          ol.lst-stps li:before, .lst-stps .lst-item:before {
              font-size: 0.8em;
              line-height: 2;
              height: 2em;
              width: 2em;
              margin-top: -3px;
              font-weight: 600;
          }
          ol.lst-stps>li, .lst-stps>.lst-item {
              padding-left: 45px
          }
          .lst-stps.lst-stps-striped li, .lst-stps.lst-stps-striped .lst-item {
              padding-top: 19px;
              padding-bottom: 19px;
              margin-top: 0px;
          }
      }
      .lst-lwr-alph {
          list-style-position: outside;
      }
      .callout {
          padding: 19px;
          margin-bottom: 20px;
          border: 1px solid #e3e3e3;
          box-shadow: 0px 0px 10px #ddd;
      }

      /*Checkbox/Fieldflow radio input sizing,positioning*/
      .checkbox-lg>li.checkbox {
          margin-top: 0px;
      }

      .checkbox-lg>li {
          margin-left: -40px;
          padding-left: 40px;
          padding-top: 5px;
          padding-bottom: 10px;
          margin-bottom: 5px;
          padding-right: 15px;
      }

      .checkbox-zebra>li:nth-child(2n+1) {
          background-color: #f5f5f5;
          padding-top: 10px;
          padding-bottom: 15px;
      }

      .checkbox-lg>li.checkbox input[type=checkbox], .fieldflow-lg .radio input[type=radio] {
          margin-top: 12px;
          transform: scale(2);
      }

      .checkbox-lg label, .fieldflow-lg, .fieldflow-lg label, .fieldflow-lg div, .fieldflow-lg select, .std-blt {
          font-size: 20px;
          line-height: 1.65em;
      }

      .std-blt {
          list-style-type: disc;
      }

      .std-blt li label {
          display: block;
          padding-left: 0px;
      }

      .fieldflow-lg .radio label {
          margin-left: 40px;
      }

      .fieldflow-lg .radio input[type=radio] {
          margin-left: -40px;
      }

      .fieldflow-lg fieldset legend {
          font-size: 22px;
          margin-top: 0px;
      }

      /*Hide arrows in Chrome/FF for number input*/
      /* Chrome, Safari, Edge, Opera */
      input::-webkit-outer-spin-button, input::-webkit-inner-spin-button {
          -webkit-appearance: none;
          appearance: none;
          margin: 0;
      }

      /* Firefox */
      input[type=number] {
          -webkit-appearance: textfield;
          appearance: textfield;
      }

      output.wb-calc {
          display: inline;
      }

      /*Validation invisible text appearance */
      .wb-frmvld #errors-default .wb-inv, .wb-frmvld .has-error .wb-inv {
          clip: inherit;
          height: inherit;
          margin: inherit;
          overflow: inherit;
          position: inherit;
          width: inherit;
      }

      .wb-frmvld .has-error .wb-inv {
          color: #333;
      }

      :not(#wb-srch) main form:not(#gc-pg-hlpfl-frm), main .checkbox, main .checkbox-inline, main .radio, main .radio-inline, main form:not(#gc-pg-hlpfl-frm) :not(.btn-call-to-action).btn, main form :not(.btn-primary).btn {
          font-size: 20px !important;
          line-height: 1.65em !important;
      }

      /*Lower opacity for placeholders */
      ::-webkit-input-placeholder {
          /* Edge */
          opacity: 0.5;
      }

      :-ms-input-placeholder {
          /* Internet Explorer 10-11 */
          opacity: 0.5;
      }

      input::placeholder {
          opacity: 0.5;
      }

      /*placholder disappears on focus */
      input:focus::-webkit-input-placeholder {
          opacity: 0;
      }

      input:focus::placeholder {
          opacity: 0;
      }

      /*CSS eqht experimental */
      .wb-eqht-css {
          display: flex;
          flex-wrap: wrap;
          align-items: stretch;
          height: 100%;
      }

      .wb-eqht-css .wb-eqht-grid {
          display: flex;
          flex-direction: column;
          flex-grow: 1;
      }

      .wb-eqht-css .hght-inhrt-css {
          display: flex;
          flex-direction: column;
          flex: 1 1 auto;
      }

      .wb-eqht-css .hght-inhrt-css .eqht-trgt-css {
          flex: 1 1 auto;
      }
    </style>
    <style>
      .provisional.wb-steps .wb-tggle-fildst>legend:before {
          background-color: #fff;
          padding: 4px;
          -webkit-border-radius: 50%;
          -moz-border-radius: 50%;
          border-radius: 50%;
          border: 3px solid #6f6f6f;
          height: 1.2em;
          width: 1.2em;
          box-sizing: content-box;
          margin-right: 10px;
          display: inline-block;
          text-align: center;
          line-height: 1.2;
          content: counter(fieldset_counter) !important;
      }

      .panel-default>.panel-heading.wb-steps-active {
          background-color: #fff;
      }

      .provisional.wb-steps .wb-tggle-fildst>legend.wb-steps-active:before {
          background-color: #1c578a;
          border-color: #1c578a;
          color: #fff;
      }

      .provisional.wb-steps .wb-tggle-fildst>legend:not(.wb-steps-active) {
          font-size: 18px;
      }

      .provisional.wb-steps .wb-tggle-fildst>legend.wb-steps-active {
          font-weight: bold;
      }

      fieldset+.buttons {
          margin-left: 15px;
      }

      .wb-steps-active .panel-title {
          font-size: 1.3em;
      }

      fieldset fieldset {
          min-width: 1px;
      }

      .ds-example {
          margin-top: 15px;
          border: 1px solid #e3e3e3;
          box-shadow: 0px 0px 8px #e3e3e3;
      }

      .ds-example>.wb-tabs>.tabpanels {
          background: #f9f9f9;
      }

      .ds-example>.wb-tabs>.tabpanels legend {
          font-size: 80%;
          font-weight: 700;
          margin: 0 0 5px;
      }

      .ds-example>.wb-tabs>.tabpanels fieldset {
          padding-top: 0;
      }

      .ds-example>.wb-tabs>.tabpanels>details>summary {
          background: #fff;
          border-radius: 0;
      }

      .ds-example>.wb-tabs [role=tablist]>li:focus, .ds-example>.wb-tabs [role=tablist]>li:hover {
          background: #ddd;
      }

      .ds-example>.wb-tabs {
          margin-bottom: 0;
      }

      .ds-example>.wb-tabs>.tabpanels>details {
          margin-bottom: 0;
      }

      .ds-example .panel-body {
          box-shadow: none;
      }

      @media screen and (max-width: 991px) {
          .ds-example>.wb-tabs .tgl-panel {
              margin-top: 15px;
          }
      }

      @media screen and (min-width: 992px) {
          .ds-example>.wb-tabs>.tabpanels>details {
              border: none;
              padding: 15px;
          }

          .ds-example>.wb-tabs [role=tablist]>li {
              border: none;
              background: none;
          }

          .ds-example>.wb-tabs [role=tablist]>li.active a {
              border-width: 0 0 4px;
          }

          .ds-example>.wb-tabs>.tabpanels>details {
              padding: 30px;
          }

          .ds-example>.wb-tabs>.tabpanels>details {
              background: #f9f9f9;
              padding: 30px;
              margin-bottom: 0;
          }
      }

      .prev-wb-step .btn-lgnd {
          margin: 1px;
          text-decoration-line: underline;
      }

      .prev-wb-step:focus, .prev-wb-step:hover {
          color: #0535d2;
      }

      .prev-wb-step:focus {
          outline: 5px auto;
          outline-offset: -2px;
      }
    </style>
    <style>
        datalist {
            display: flex;
            justify-content: space-between;
        }

        .wb-input-range>output.wb-input-range-display, div.wb-input-range-display {
            font-size: 20px;
            min-width: 2em;
            text-align: center;
            position: absolute;
            left: 50%;
            padding-left: 6px;
            padding-right: 6px;
            transform: translate(-50%, -2.7em);
            border-radius: 6px;
            background: #e3e3e3;
        }

        output.wb-input-range-display {
            padding-top: 0px;
        }
        input[type=range]::-webkit-slider-thumb {
            transform: scale(1.5);
        }
        input[type=range]::-moz-range-thumb {
            transform: scale(1.5);
            height: 50px;
        }
        .range-input-group input[type=number] {
            border: 0;
            -webkit-box-shadow: unset;
            box-shadow: unset;
            background-color: inherit;
            width: 95px;
            font-size: 20px;
        }
        .range-input-group .input-group-addon {
            background-color: unset;
            border: 0;
            border-radius: 0;
            width: auto;
        }
        .range-input-group.panel-default {
            border-color:#e1dada;
        }
    </style>


    <!-- Write closure template -->
    <script>
        document.write(wet.builder.refTop({}));
    </script>
</head>

<body vocab="http://schema.org/" typeof="WebPage" resource="#wb-webpage">
    <div id="def-top">
    </div>
    <!-- Write closure template -->
    <script>
        var defTop = document.getElementById("def-top");
        defTop.outerHTML = wet.builder.top({
            lngLinks: [{
                lang: "fr", 
                href: "#", 
                text: "Français"
            }], 
            breadcrumbs: [{
                title: "Canada.ca", 
                href: "https://www.canada.ca/en.html"
            }, {
                title: "Taxes", 
                href: "https://www.canada.ca/en/services/taxes.html"
            }, {
                title: "Savings and pension plans", 
                href: "https://www.canada.ca/en/services/taxes/savings-and-pension-plans.html"
            }, {
                title: "First Home Savings Account (FHSA)", 
                href: "index.html"
            }], 
            search: true, 
            siteMenu: true, 
            showPreContent: true
        });
    </script>
    <main property="mainContentOfPage" resource="#wb-main" typeof="WebPageElement">
    <div class="mwsgeneric-base-html parbase section">

    <div class="container">
        <h1 property="name" id="wb-cont" class="gc-thickline">Tax-Free First Home Savings Account Estimators</h1>
        <p>You can use these estimators to help you understand how a tax-free first home savings account (FHSA) can help you save for your first home. The first tool estimates how much you can save for your down payment, and the second tool shows your potential tax savings.</p>
        <p><a href="index.html">Learn about the FHSA</a> before using these tools.</p>
        <p>These tools provide <strong>estimates</strong> based on the information you entered. They are intended for illustrative and general information purposes. They may not fully capture your particular tax situation, which may affect the accuracy of the results. The results generated are examples only.</p>
        <p>Your data is not collected or saved. If you leave or refresh the page, you will need to enter your information again.</p>
        <ul class="list-unstyled">
            <li>
                <details>
                    <summary>Read the privacy statement for the estimator tools</summary>
                    <p>The CRA is not collecting or retaining any of the information you enter on this page. The estimators' results are rough estimates and are based on the information that you entered. The results should not be considered financial advice. The results that are obtained after using these interactive tools are not binding on the CRA.</p>
                </details>
            </li>
        </ul>
        <div class="row">
            <div class="col-sm-12">
                <h2>Down payment estimator</h2>
                <p>Estimate how much you can save for your down payment by participating in a tax-free first home savings account (FHSA).</p>
            </div>
            <div class="wb-frmvld col-sm-12 provisional wb-steps">
                <form id="fhsa_downpay_form" name="fhsa_cal_form" action="#" method="get" autocomplete="off" class="panel panel-default">
                    <!-- Form 1 STEP 1-->
                    <fieldset class="panel-default p-0">
                        <legend class="panel-heading mrgn-bttm-0"><span class="panel-title">FHSA participation in prior years</span></legend>
                        <div class="panel-body mrgn-lft-md">

                            <fieldset class="mrgn-lft-md">

                                <legend class="mrgn-bttm-0 required gc-font-2019" tabindex="-1"><strong><span class="field-name">Did you open your FHSA in prior years?</span></strong> <strong class="required">(required)</strong></legend>
                                <div class="clearfix"></div>
                                <ul class="list-unstyled lst-spcd-2 gc-chckbxrdio chckbxrdio-grp">
                                    <li class="radio">
                                        <input type="radio" name="hasPriorPaymentFHSA" id="priorpayment-fhsa-true" value="true" data-priorpayment-fhsa="true" data-rule-required="true">
                                        <label for="priorpayment-fhsa-true">Yes &mdash; include prior year information</label>
                                    </li>
                                    <li class="radio">
                                        <input type="radio" name="hasPriorPaymentFHSA" id="priorpayment-fhsa-false" value="false" data-priorpayment-fhsa="false" data-rule-required="true">
                                        <label for="priorpayment-fhsa-false">No &mdash; continue to planned participation</label>
                                    </li>
                                </ul>
                            </fieldset>


                            <div id="priorPaymentFHSAfields" class="mrgn-lft-md hidden">
                                <div class="form-group">
                                    <label for="priorPaymentYearsFHSA" class="required"><span class="field-name">Number of years your FHSA has been open</span> (<span data-prior-year-range="true">1 to </span><span data-max-prior-years="true">14</span> year<span data-prior-year-range="true">s</span> max) <strong class="required">(required)</strong></label>
                                    <p data-single-year-range="true">If you opened your FHSA in 2023, enter "1" as the number of years</p>
                                    <div class="input-group col-xs-2 col-sm-1">
                                        <input type="text" name="priorPaymentYearsFHSA" min="1" max="14" id="priorPaymentYearsFHSA" data-rule-minlength="1" data-rule-maxlength="2" class="form-control text-right" data-rule-rangelength="[1,14]" maxlength="2" inputmode="numeric" data-rule-digits="true">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="priorPaymentBalance" class="required"><span class="field-name">Your<span data-first-year="true" class="hidden"> current</span> FHSA balance<span data-first-year="false"> as of December 31, <span data-prior-year="true">2023</span></span></span> <span class="wb-inv">(dollars only, no cents) </span><strong class="required">(required)</strong></label>
                                    <div class="input-group col-lg-3 col-sm-4 col-xs-10">
                                        <span class="input-group-addon">$</span>
                                        <input type="text" name="priorPaymentBalance" size="7" maxlength="7" id="priorPaymentBalance" class="form-control input-lg text-right" inputmode="numeric" pattern="[0-9]*" data-rule-digits="true">
                                        <span class="input-group-addon">.00</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="priorPaymentAmountFHSA" class="required"><span class="field-name">Your total FHSA participation for prior years</span><span class="wb-inv"> (dollars only, no cents)</span> <strong class="required">(required)</strong></label>
                                    <p>Include all amounts you have contributed and transferred</p>
                                    <div class="input-group col-lg-3 col-sm-4 col-xs-10">
                                        <span class="input-group-addon">$</span>
                                        <input type="text" name="priorPaymentAmountFHSA" size="7" maxlength="5" id="priorPaymentAmountFHSA" class="form-control input-lg text-right" inputmode="numeric" pattern="[0-9]*" min="1" max="40000" data-rule-digits="true">
                                        <span class="input-group-addon">.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>


                    <!-- Form 1 STEP 2-->
                    <fieldset class="panel-default p-0">

                        <legend class="panel-heading mrgn-bttm-0"><span class="panel-title">Planned FHSA participation</span></legend>
                        <div class="panel-body mrgn-lft-sm mrgn-bttm-lg">

                        <div class="form-group mrgn-lft-md">
                            <label for="paymentYears" id="paymentYearsLabel" class="mrgn-tp-lg"><span class="field-name">Number of years you plan to participate in your FHSA</span> <span class="wb-inv"> minimum: 1 year, maximum: 15 years</span></label>
                            <div class="range-input-group panel panel-default">
                                <div class="row panel-body">
                                    <div class="col-xs-4 col-xs-offset-8 col-sm-3 col-sm-offset-0 col-md-2">
                                        <div class="input-group pull-right mrgn-tp-sm">
                                            <input class="input-lg text-right" id="paymentYears" value="1" min="1" max="15" type="number" step="1">
                                            <span class="input-group-addon p-0"> year(s)</span>
                                        </div>
                                    </div>
                                    <div class="clearfix visible-xs"> </div>
                                    <hr class="brdr-bttm visible-xs mrgn-tp-md mrgn-bttm-md">
                                    <div class="col-sm-9 col-md-10 brdr-lft">
                                        <div class="slider-group">
                                            <input id="paymentYearsSld" class="form-range mrgn-tp-md" type="range" min="1" max="15" value="1" step="1" list="paymentYearsSldList" aria-controls="paymentYearsSld" aria-label="paymentYearsLabel" tabindex="-1">
                                            <datalist id="paymentYearsSldList" class="d-flex">
                                                <!--[if lte IE 9]><select><![endif]-->
                                                <option value="1" label="1"></option>
                                                <option value="3"></option>
                                                <option value="6"></option>
                                                <option value="9"></option>
                                                <option value="12"></option>
                                                <option value="15" label="15"></option>
                                                <!--[if lte IE 9]></select><![endif]-->
                                            </datalist>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                        <div class="form-group mrgn-lft-md">
                            <label for="paymentAmount" id="paymentAmountLabel" class="mrgn-tp-lg"><span class="field-name">Amount you plan to contribute and transfer annually to your FHSA</span> ($250 increments) <span class="wb-inv"> Minimum: $0, maximum: $8000 (dollars only, no cents)</span></label>
                            <div class="range-input-group panel panel-default">
                                <div class="row panel-body">
                                    <div class="col-xs-4 col-xs-offset-8 col-sm-3 col-sm-offset-0 col-md-2">
                                        <div class="input-group pull-right mrgn-tp-sm">
                                            <span class="input-group-addon p-0">$</span>
                                            <input class="input-lg text-right" id="paymentAmount" value="0" min="0" max="8000" type="number" step="250">
                                            <span class="input-group-addon p-0">.00</span>
                                        </div>
                                    </div>
                                    <div class="clearfix visible-xs"> </div>
                                    <hr class="brdr-bttm visible-xs mrgn-tp-md mrgn-bttm-md">
                                    <div class="col-sm-9 col-md-10 brdr-lft">
                                        <div class="slider-group">
                                            <input id="paymentAmountSld" class="form-range mrgn-tp-md" type="range" min="0" max="8000" value="0" step="250" list="paymentAmountSldList" aria-controls="paymentAmountSld" aria-label="paymentAmountLabel" tabindex="-1">
                                            <datalist id="paymentAmountSldList" class="d-flex">
                                                <!--[if lte IE 9]><select><![endif]-->
                                                <option value="0" label="$0"></option>
                                                <option value="1000"></option>
                                                <option value="2000"></option>
                                                <option value="3000"></option>
                                                <option value="4000"></option>
                                                <option value="5000"></option>
                                                <option value="6000"></option>
                                                <option value="7000"></option>
                                                <option value="8000" label="$8,000"></option>
                                                <!--[if lte IE 9]></select><![endif]-->
                                            </datalist>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="clearfix"></div>

                        <div class="form-group mrgn-tp-lg">
                            <div class="mrgn-lft-md">
                                <label for="paymentInterest" class="required"><span class="field-name">Expected annual rate of return from your investments</span> (up to 2 decimal points) <strong class="required">(required)</strong></label>
                                <p><a href="#return-rate-help" aria-controls="return-rate-help" class="wb-lbx" role="button">What is an annual rate of return from your investments?<span class="glyphicon glyphicon-question-sign mrgn-lft-sm"></span></a></p>
                            </div>
                            <div class="input-group mrgn-lft-md col-xs-5 col-sm-2">
                                <input type="text" name="paymentInterest" id="paymentInterest" class="form-control input-lg text-right" inputmode="decimal" pattern="^(\d{1,2}(\.\d{1,2})?|\.\d{1,2})$" min="0.01" max="99.99" required="required" maxlength="5">
                                <span class="input-group-addon">%</span>
                            </div>
                        </div>

                        <div class="clearfix"></div>
                        <button id="paymentresultsbtn" type="button" class="mrgn-lft-md mrgn-tp-md mrgn-bttm-md btn btn-primary btn-lg" data-btn-activated="Update results">Generate results</button>
                        <div class="col-xs-12 table-responsive">
                            <div id="holdingsResults" class="hidden" aria-live="polite">
                                <hr>
                                <h3>Account holdings estimate</h3>
                                <p class="small">Based on the information you entered, the amount in your FHSA that you could put towards a down payment could possibly be:</p>
                                <ul class="list-unstyled">
                                    <li><strong data-output="holdings-total">$0</strong> in total account holdings</li>
                                    <li id="paymentGrowthResult">including <strong data-output="investment-growth-total">$0</strong> in investment growth</li>
                                    <li>after <strong data-output="payment-years">0</strong> year<span data-payment-year-range="true">s</span><span id="paymentThresholdData">. By year <strong><span id="paymentThresholdYear" data-threshold-year="true">0</span></strong>, you will have reached your lifetime FHSA limit of <strong><span id="paymentMaxContributeTotal" data-max-contribution="true">$40,000</span></strong>.</span></li>
                                </ul>
                                <div id="holdingsResultsTableContainer"></div>
                                    <template id="holdtable">
                                        <table id="holdingsresultstable" class="text-right table-condensed full-width table-bordered table-striped table-hover" data-prior-payment-year-rows=" to " data-chart="line" data-chart-options="{&quot;elements&quot;: {&quot;point&quot;: {&quot;radius&quot;: 5}}, &quot;plugins&quot;: {&quot;tooltip&quot;: {&quot;titleFont&quot;: {&quot;size&quot;: 12}, &quot;bodyFont&quot;: {&quot;size&quot;: 15}}, &quot;legend&quot;: {&quot;position&quot;: &quot;bottom&quot;}}}">
                                            <caption>Account holdings by type (line chart)</caption>
                                            <thead>
                                                <tr class="bg-primary">
                                                    <th class="text-left">Years</th>
                                                    <th class="text-right" data-chart-set-options="{&quot;borderColor&quot;: &quot;#28667a&quot;, &quot;backgroundColor&quot;: &quot;#28667a&quot;, &quot;fill&quot;: true}">Amounts contributed or transferred</th>
                                                    <th class="text-right" data-chart-set-ignore="true">Investment income</th>
                                                    <th class="text-right" data-chart-set-options="{&quot;borderColor&quot;: &quot;#e58a65&quot;, &quot;backgroundColor&quot;: &quot;#e58a65&quot;, &quot;fill&quot;: true}">Total account holdings</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </template>
                                    <p>These results may not fully capture your particular financial situation, which may affect their accuracy.</p>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <input id="calc-paymemt-fhsa" class="btn btn-primary hidden" type="submit" value="Generate results">
                </form>
            </div>
        </div>




          
    </main>


<!--
    <script>
        _satellite.pageBottom();
    </script>
-->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="https://www.canada.ca/etc/designs/canada/wet-boew/js/ep-pp.min.js"></script>
    <script src="https://www.canada.ca/etc/designs/canada/wet-boew/js/wet-boew.min.js"></script>
    <script src="https://www.canada.ca/etc/designs/canada/wet-boew/js/theme.min.js"></script>
    <script src="https://wet-boew.github.io/themes-dist/GCWeb/GCWeb/méli-mélo/2024-09-kejimkujik.js"></script>
<!--
    <script src="data/income_rates.js"></script>
-->
    <script>
        "use strict";

        var incomeRates;

        $.getJSON("data/income_rates.json", function(data) {
            incomeRates = data;
        });
    </script>

    <script>
        "use strict";

        const maxContribution = 40000, 
            yearlyMaxContribution = 8000, 
            priorYearMax = 14, 
            fhsaStartYear = 2023;

        let currentYear, priorContributeMax, 
            paymentformId = "#fhsa_downpay_form", 
            savingsformId = "#fhsa_taxsavings_form", 
            pagelang = document.documentElement.lang, 
            NumberParser = class NumberParser {
                constructor(locale) {
                    const parts = new Intl.NumberFormat(locale).formatToParts(12345.6);
                    const numerals = [...new Intl.NumberFormat(locale, { useGrouping: false }).format(9876543210)].reverse();
                    const index = new Map(numerals.map((d, i) => [d, i]));

                    this._group = new RegExp(`[${parts.find(d => d.type === "group").value}]`, "g");
                    this._decimal = new RegExp(`[${parts.find(d => d.type === "decimal").value}]`);
                    this._numeral = new RegExp(`[${numerals.join("")}]`, "g");
                    this._index = d => index.get(d);
                }
                parse(string) {
                    return (string = string.trim().replace(this._group, "").replace(this._decimal, ".").replace(this._numeral, this._index)) ? +string : NaN;
                }
            },
//          Get field values from down payment form
            hasPriorPaymentFHSA = function () {
                return $(":input[type=radio][name=hasPriorPaymentFHSA]:checked", paymentformId).data("priorpayment-fhsa") || false;
            }, 
            priorPaymentYears = function () {
                if (hasPriorPaymentFHSA() === true) {
                    return parseInt($("#priorPaymentYearsFHSA").val(), 10) || 0;
                }
                return 0;
            }, 
            priorPaymentBalance = function () {
                if (hasPriorPaymentFHSA() === true) {
                    return parseInt($("#priorPaymentBalance").val(), 10) || 0;
                }
                return 0;
            }, 
            priorPaymentAmount = function () {
                if (hasPriorPaymentFHSA() === true) {
                    return parseInt($("#priorPaymentAmountFHSA").val(), 10) || 0;
                }
                return 0;
            }, 
            paymentYears = function () {
                return parseInt($("#paymentYears").val(), 10) || 1;
            }, 
            paymentAmount = function () {
                return parseInt($("#paymentAmount").val(), 10) || 0;
            }, 
            paymentInterest = function () {
                let payInterest = new NumberParser(pagelang + "-CA").parse($("#paymentInterest").val());

                return parseFloat(payInterest, 10) / 100 || 0;
            }, 
//          Get field values from potential tax savings form
            hasPriorSavingsFHSA = function () {
                return $(":input[type=radio][name=hasPriorSavingFHSA]:checked", savingsformId).data("priorsaving-fhsa") || false;
            }, 
            priorSavingYears = function () {
                if (hasPriorSavingsFHSA() === true) {
                    return parseInt($("#priorSavingYearsFHSA").val(), 10) || 0;
                }
                return 0;
            }, 
            priorSavingBalance = function () {
                if (hasPriorSavingsFHSA() === true) {
                    return parseInt($("#priorSavingBalance").val(), 10) || 0;
                }
                return 0;
            }, 
            priorSavingAmount = function () {
                if (hasPriorSavingsFHSA() === true) {
                    return parseInt($("#priorSavingAmountFHSA").val(), 10) || 0;
                }
                return 0;
            }, 
            hasPriorTaxSavings = function () {
                if (hasPriorSavingsFHSA() === true) {
                    return $(":input[type=radio][name=hasPriorTaxSaving]:checked", savingsformId).data("priortaxsaving") || false;
                }
                return false;
            }, 
            priorYearSavingAmount = function () {
                if (hasPriorTaxSavings() === true) {
                    return parseInt($("#priorYearSavingAmount").val(), 10) || 0;
                }
                return 0;
            }, 
            priorYearSavingTransfer = function () {
                if (hasPriorTaxSavings() === true) {
                    return parseInt($("#priorYearSavingTransfer").val(), 10) || 0;
                }
                return 0;
            }, 
            priorYearSavingInvest = function () {
                if (hasPriorTaxSavings() === true) {
                    return parseInt($("#priorYearSavingInvest").val(), 10) || 0;
                }
                return 0;
            }, 
            hasPriorYearSavingDiffIncome = function () {
                if (hasPriorTaxSavings() === true) {
                    return $(":input[type=radio][name=hasSavingIncomeDiff]:checked", savingsformId).data("incomediff") || false;
                }
                return false;
            }, 
            priorYearSavingIncome = function () {
                if (hasPriorYearSavingDiffIncome() === true) {
                    return parseInt($("#priorYearSavingIncome").val(), 10) || 0;
                }
                return 0;
            }, 
            priorYearSavingDeduction = function () {
                if (hasPriorYearSavingDiffIncome() === true) {
                    return parseInt($("#priorYearSavingDeduction").val(), 10) || 0;
                }
                return 0;
            }, 
            province = function () {
                return $("#province").find(":selected") || null;
            }, 
            yearlyTotalIncome = function () {
                return parseInt($("#approxYearlyIncome").val(), 10) || 0;
            }, 
            yearlyTotalDeductions = function () {
                return parseInt($("#approxYearlyDeductions").val(), 10) || 0;
            }, 
            yearlyIncome =  function () {
                let adjustedValIncome = yearlyTotalIncome() - yearlyTotalDeductions();
                    if (adjustedValIncome < 0) {
                        return 0;
                    }
                return adjustedValIncome;
            }, 
            savingYears = function () {
                return parseInt($("#savingYears").val(), 10) || 1;
            }, 
            savingsAmount = function () {
                return parseInt($("#savingsAmount").val(), 10) || 0;
            }, 
            savingsTransferAmount = function () {
                return parseInt($("#savingsTransferAmount").val(), 10) || 0;
            }, 
            hasSavingInvestGrowth = function () {
                return $(":input[type=radio][name=hasSavingInvestment]:checked", savingsformId).data("hassavinginvestment") || false;
            }, 
            savingInterest = function () {
                let savingInterest;

                if (hasSavingInvestGrowth() === true) {
                    savingInterest = new NumberParser(pagelang + "-CA").parse($("#savingInterest").val());
                    return parseFloat(savingInterest, 10) / 100 || 0;
                }
                return 0;
            }, 
            updatePriorPaymentYears = function () {
                if (priorSavingYears() !== 0 && priorSavingYears() !== priorPaymentYears()) {
                    $("#priorPaymentYearsFHSA").val($("#priorSavingYearsFHSA").val());
                }
            }, 
            updatePriorPaymentBalance = function () {
                if (priorSavingBalance() !== 0 && priorSavingBalance() !== priorPaymentBalance()) {
                    $("#priorPaymentBalance").val($("#priorSavingBalance").val());
                }
            }, 
            updatePriorPaymentAmount = function () {
                if (priorSavingAmount() !== 0 && priorSavingAmount() !== priorPaymentAmount()) {
                    $("#priorPaymentAmountFHSA").val($("#priorSavingAmountFHSA").val());
                }
            }, 
            updatePriorSavingYears = function () {
                if (priorPaymentYears() !== 0 && priorPaymentYears() !== priorSavingYears()) {
                    $("#priorSavingYearsFHSA").val($("#priorPaymentYearsFHSA").val());
                }
            }, 
            updatePriorSavingBalance = function () {
                if (priorPaymentBalance() !== 0 && priorPaymentBalance() !== priorSavingBalance()) {
                    $("#priorSavingBalance").val($("#priorPaymentBalance").val());
                }
            }, 
            updatePriorSavingAmount = function () {
                if (priorPaymentAmount() !== 0 && priorPaymentAmount() !== priorSavingAmount()) {
                    $("#priorSavingAmountFHSA").val($("#priorPaymentAmountFHSA").val());
                }
            }, 
            getCurrentYear = function () {
                let xmlHttp;

                function srvTime() {
                try {
                    //FF, Opera, Safari, Chrome
                    xmlHttp = new XMLHttpRequest();
                }
                catch (err1) {
                    //IE
                    try {
                        xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
                    }
                    catch (err2) {
                        try {
                            xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
                        }
                        catch (eerr3) {
                            return new Date().getFullYear();
                        }
                    }
                }
                xmlHttp.open("HEAD", window.location.href.toString(), false);
                xmlHttp.setRequestHeader("Content-Type", "text/html");
                xmlHttp.send("");
                return new Date(xmlHttp.getResponseHeader("Date")).getFullYear();
                }
                return srvTime();
            }, 
            getPriorContributeMax = function (fhsaStartYear, currentYear, priorYearMax, yearlyMaxContribution, maxContribution) {
                let adjustedYear = currentYear;

                if (currentYear <= fhsaStartYear) {
                    adjustedYear = fhsaStartYear + 1;
                }
                if (adjustedYear - fhsaStartYear <= priorYearMax && adjustedYear - fhsaStartYear * yearlyMaxContribution < maxContribution) {
                    return (adjustedYear - fhsaStartYear) * yearlyMaxContribution;
                } else {
                    return maxContribution;
                }
            }, 
            getContributeMax = function (compareVal) {
                if (parseInt(compareVal, 10) > priorContributeMax) {
                    return priorContributeMax;
                } else if (parseInt(compareVal, 10) > 0) {
                    return parseInt(compareVal, 10);
                }
                return 1;
            }, 
            initForms = function (fhsaStartYear, currentYear, priorYearMax, priorContributeMax, paymentformId, savingsformId) {
                let updatePriorYearMax = function (maxYearId, currentYear, fhsaStartYear, priorYearMax, formId) {
                        let adjustedPriorYears;

                        if (currentYear - fhsaStartYear <= priorYearMax) {
                            adjustedPriorYears = currentYear - fhsaStartYear;
                        } else {
                            adjustedPriorYears = priorYearMax;
                        }
                        $(maxYearId).attr("max", adjustedPriorYears);
                        $(maxYearId).data("rule-rangelength", "[1," + adjustedPriorYears + "]");
                        $("[data-max-prior-years=true]", formId).html(adjustedPriorYears);
                        if (adjustedPriorYears < 2) {
                            $("[data-prior-year-range=true]", formId).addClass("hidden");
                        }
                    };

                if (currentYear > fhsaStartYear + 1) {
                    $("[data-single-year-range=true]").addClass("hidden");
                } else {
                    $("[data-single-year-range=true]").removeClass("hidden");
                }
                if (currentYear <= fhsaStartYear) {
                    currentYear = fhsaStartYear + 1;
                    $("[data-first-year-date=true]").html(fhsaStartYear);
                    $("[data-first-year=true]").removeClass("hidden");
                    $("[data-first-year=false]").addClass("hidden");
                    $("[data-prior-year=true]").html(fhsaStartYear);
                    $("[data-future-year=true]").html(fhsaStartYear + 1);
                } else {
                    $("[data-first-year=true]").addClass("hidden");
                    $("[data-first-year=false]").removeClass("hidden");
                    $("[data-prior-year=true]").html(currentYear - 1);
                    $("[data-future-year=true]").html(currentYear);
                }
                updatePriorYearMax("#priorPaymentYearsFHSA", currentYear, fhsaStartYear, priorYearMax, paymentformId);
                $("#priorPaymentAmountFHSA").attr("max", priorContributeMax);
                updatePriorYearMax("#priorSavingYearsFHSA", currentYear, fhsaStartYear, priorYearMax, savingsformId);
                $("#priorSavingAmountFHSA").attr("max", priorContributeMax);
                $("#priorYearSavingAmount").attr("max", priorContributeMax);
                $("#priorYearSavingTransfer").attr("max", priorContributeMax);
            }, 
            updatePaymentResults = function (priorYearMax, maxContribution, paymentformId) {
                let paymentTotals, holdingsTableHeader, 
                    priorPaymentInvestment = priorPaymentBalance() - priorPaymentAmount(), 
                    generateHoldingsTableData = function (holdingYears, paymentAmount, investment, hasPriorPay, priorPaymentYrs, priorPayAmount, priorPayInvest, priorYearMax, maxContribution) {
                        let yearIncrement, holdingRow, 
                            amountCompound = 0, 
                            investmentCompound = 0, 
                            holdingBody = document.createElement("tbody"), 
                            loopYears = priorPaymentYrs + holdingYears, 
                            maxContributeYear = loopYears, 
                            createHoldingsTableRow = function (evalYear, isPriorYear, amountCompound, investmentCompound) {
                                let holdingCell, 
                                holdingRow = document.createElement("tr"), 
                                holdingHeader = document.createElement("th");

                                if (isPriorYear === true && evalYear > 1) {
                                    holdingHeader.textContent = "1" + ("#holdingsresultstable").data("prior-payment-year-rows") + evalYear;
                                } else {
                                    holdingHeader.textContent = evalYear;
                                }
                                holdingHeader.classList.add("text-right");
				switch (wb.lang)
                                {
                                    case "en": 
                                    var yrName = "Year ";
                                        break;
                                    case "fr":
                                        var yrName = "Année ";
                                }
                                holdingHeader.setAttribute("data-chart-value", yrName + evalYear);
                                holdingRow.appendChild(holdingHeader);
                                holdingCell = document.createElement("td");
                                holdingCell.setAttribute("data-chart-value", amountCompound);
                                holdingCell.textContent = currencyFormatter.format(amountCompound);
                                holdingRow.appendChild(holdingCell);
                                holdingCell = document.createElement("td");
                                holdingCell.textContent = currencyFormatter.format(investmentCompound);
                                holdingRow.appendChild(holdingCell);
                                holdingCell = document.createElement("td");
                                holdingCell.setAttribute("data-chart-value", amountCompound + investmentCompound);
                                holdingCell.textContent = currencyFormatter.format(amountCompound + investmentCompound);
                                holdingRow.appendChild(holdingCell);
                                return holdingRow;
                            };

                            if (hasPriorPay === true) {
                                amountCompound = priorPayAmount;
                                investmentCompound = priorPayInvest;
                                holdingRow = createHoldingsTableRow(priorPaymentYrs, true, amountCompound, investmentCompound);
                                holdingBody.appendChild(holdingRow);
                            }

                            if (amountCompound < maxContribution) {
                                if (loopYears >= priorYearMax + 1) {
                                    loopYears = priorYearMax + 1;
                                    maxContributeYear = loopYears;
                                }
                                for (yearIncrement = priorPaymentYrs + 1; yearIncrement <= loopYears; yearIncrement = yearIncrement + 1) {
                                    if (amountCompound + paymentAmount < maxContribution) {
                                        amountCompound = amountCompound + paymentAmount;
                                    } else {
                                        if (amountCompound !== maxContribution) {
                                            maxContributeYear = yearIncrement;
                                        }
                                        amountCompound = maxContribution;
                                    }
                                    investmentCompound = investmentCompound + (investmentCompound + amountCompound) * investment;
                                    holdingRow = createHoldingsTableRow(yearIncrement, false, amountCompound, investmentCompound);
                                    holdingBody.appendChild(holdingRow);
                                }
                                return {
                                    "tableContent": holdingBody, 
                                    "addedAmount": amountCompound, 
                                    "investment": investmentCompound, 
                                    "maxContributeYear": maxContributeYear, 
                                    "yearsheld": loopYears
                                };
                            }
                    };

                paymentTotals = generateHoldingsTableData(paymentYears(), paymentAmount(), paymentInterest(), hasPriorPaymentFHSA(), priorPaymentYears(), priorPaymentAmount(), priorPaymentInvestment, priorYearMax, maxContribution);
                $("[data-output=holdings-total]", paymentformId).html(currencyFormatter.format(paymentTotals.addedAmount + paymentTotals.investment));
                if (priorPaymentInvestment + paymentTotals.investment > 0) {
                    $("#paymentGrowthResult", paymentformId).removeClass("hidden");
                    $("[data-output=investment-growth-total]", paymentformId).html(currencyFormatter.format(paymentTotals.investment));
                } else {
                    $("#paymentGrowthResult", paymentformId).addClass("hidden");
                }
                $("[data-output=payment-years]", paymentformId).html(paymentTotals.yearsheld);
                if (paymentTotals.yearsheld === 1) {
                    $("[data-payment-year-range=true]", paymentformId).addClass("hidden");
                } else {
                    $("[data-payment-year-range=true]", paymentformId).removeClass("hidden");
                }
                if (paymentTotals.addedAmount === maxContribution) {
                    $("#paymentThresholdData", paymentformId).removeClass("hidden");
                    $("#paymentThresholdYear", paymentformId).html(paymentTotals.maxContributeYear);
                    $("#paymentContributeTotal", paymentformId).html(currencyFormatter.format(paymentTotals.addedAmount));
                } else {
                    $("#paymentThresholdData", paymentformId).addClass("hidden");
                }
                if ("content" in document.createElement("template")) {
                    document.getElementById("holdingsResultsTableContainer").textContent = "";
                    holdingsTableHeader = document.getElementById("holdtable").content.cloneNode(true);
                    document.getElementById("holdingsResultsTableContainer").appendChild(holdingsTableHeader);
                    document.getElementById("holdingsresultstable").appendChild(paymentTotals.tableContent);
/*
                    $("#holdingsresultstable").addClass("wb-charts wb-charts-area");
                    $("#holdingsresultstable").trigger("wb-init.wb-charts");
*/
                    $("#holdingsresultstable").trigger("wb-init[data-chart]");
                    $(".chart-inited").wrap("<div class=\"table-responsive\"></div>");
                }
            }, 
            updateSavingResults = function (incomeRates, currentYear, fhsaStartYear, priorYearMax, maxContribution, pagelang, savingsformId) {
                let savingsTotals, summaryTotal, currentTbody, 
                    priorSavingsInvestment = priorSavingBalance() - priorSavingAmount(), 
                    prov = province(), 
                    generateSavingsTableData = function (area, federalName, abatementID, income, savingYears, savingsAmount, savingsTransferAmount, hasInvestGrowth, investment, hasPriorSavings, priorSavingYears, priorSavingAmount, priorSavingsInvest, hasPriorYrSaving, priorYrSavingAmt, priorYrSavingTransfer, priorYrSavingInvest, hasPriorYearSavingDiffIncome, priorYearSavingIncome, priorYearSavingDeduction, priorYearMax, maxContribution, startYear, currentYear, incomeRates, pagelang) {
                    let juristictionArr, federalRates, abatement, provinceRates, yearIncrement, priorYear, priorIncome, saveAmountsObj, savingsRow, 
                        priorYearSavingData = {}, 
                        fedrates = [], 
                        arearates = [], 
                        amountCompound = 0, 
                        investmentAmount = 0, 
                        investmentCompound = 0, 
                        deductContribAmt = 0, 
                        deductCumulative = 0, 
                        fedMinCumulative = 0, 
                        fedMaxCumulative = 0, 
                        areaMinCumulative = 0, 
                        areaMaxCumulative = 0, 
                        savingsBody = document.createElement("tbody"), 
                        loopYears = priorSavingYears + savingYears, 
                        maxContributeYear = loopYears, 
                        hasInvestment = hasInvestGrowth === true || priorSavingsInvest > 0, 
                        getRatesArr = function (area, ratesArr, pagelang) {
                            let areaRateArr;

                            if (typeof incomeRates !== "undefined" && incomeRates.length > 0) {
                                areaRateArr = ratesArr.find(function findLoc(rateLocs) {
                                    return rateLocs[pagelang] === area;
                                }, pagelang, area);
                                if (typeof areaRateArr !== "undefined") {
                                    return areaRateArr;
                                }
                            }
                            return {};
                        }, 
                        areaRates = function (juristictionArr, rateYear, startYear) {
                            let yearRateArrLen, evalYear;

                            if (Object.prototype.hasOwnProperty.call(juristictionArr, "timeframe") === true) {
                                for (yearRateArrLen = juristictionArr.timeframe.length - 1; yearRateArrLen >= 0; yearRateArrLen = yearRateArrLen - 1) {
                                    for (evalYear = rateYear; evalYear >= startYear; evalYear = evalYear - 1) {
                                        if (juristictionArr.timeframe[yearRateArrLen].year === evalYear) {
                                            return juristictionArr.timeframe[yearRateArrLen];
                                        }
                                    }
                                }
                            }
                            return {};
                        }, 
                        getAbatement = function (juristictionArr, abatementId, rateYear, startYear) {
                            let yearRateArrLen, evalYear, abate;

                            if (abatementId !== "undefined" && Object.prototype.hasOwnProperty.call(juristictionArr, "regionaladjust") === true) {
                                for (yearRateArrLen = juristictionArr.regionaladjust.length - 1; yearRateArrLen >= 0; yearRateArrLen = yearRateArrLen - 1) {
                                    for (evalYear = rateYear; evalYear >= startYear; evalYear = evalYear - 1) {
                                        if (juristictionArr.regionaladjust[yearRateArrLen].year === evalYear && Object.prototype.hasOwnProperty.call(juristictionArr.regionaladjust[yearRateArrLen], "abatement")) {
                                            abate = juristictionArr.regionaladjust[yearRateArrLen].abatement.find(function findLoc(abateVal) {
                                                return Object.keys(abateVal)[0] === abatementId;
                                            }, abatementId);
                                        }
                                    }
                                }
                                if (typeof abate === "object") {
                                    return abate[abatementId];
                                }
                            }
                            return 1;
                        }, 
                        createSavingsTableBody = function (savingsRow, currentYear, evalYear, amountCompound, investmentCompound, deductContribAmt, fedMinVal, fedMaxVal, areaMinVal, areaMaxVal, hasInvestment, isPriorYear, showPriorYr, isTotal) {
                            let savingsCell, 
                                savingsHeader = document.createElement("th"), 
                                cellContentEval = function (savingsCell, cellContent, naCondCheck) {
                                    let noInvestText;

                                    if (naCondCheck) {
                                        if ("content" in document.createElement("template")) {
                                            noInvestText = document.getElementById("noInvestText").content.cloneNode(true);
                                        }
                                        savingsCell.appendChild(noInvestText);
                                    } else {
                                        savingsCell.textContent = cellContent;
                                    }
                                    return savingsCell;
                                }, 
                                getRateCalcRange = function (minVal, maxVal) {
                                    if (parseInt(maxVal, 10) === 0) {
                                        return currencyFormatter.format(maxVal);
                                    } else if (parseInt(minVal, 10) === parseInt(maxVal, 10)) {
                                        return $("#savingsTable").data("savings-text") + currencyFormatter.format(maxVal);
                                    }
                                    return currencyFormatter.format(minVal) + $("#savingsTable").data("savings-range-text") + currencyFormatter.format(maxVal);
                                };

                            if (showPriorYr === true) {
                                savingsHeader.textContent = "[" + currentYear + "]" + String.fromCharCode(160) + evalYear;
                                savingsHeader.classList.add("nowrap");
                            } else if (isPriorYear === true && evalYear > 1) {
                                savingsHeader.textContent = "1" + $("#savingsTable").data("prior-savings-year-rows") + evalYear;
                            } else {
                                savingsHeader.textContent = evalYear;
                            }
                            savingsHeader.classList.add("text-right");
                            savingsRow.appendChild(savingsHeader);
                            savingsCell = document.createElement("td");
                            savingsRow.appendChild(cellContentEval(savingsCell, currencyFormatter.format(amountCompound), isTotal === true));
                            savingsCell = document.createElement("td");
                            savingsRow.appendChild(cellContentEval(savingsCell, currencyFormatter.format(deductContribAmt), isPriorYear === true));
                            savingsCell = document.createElement("td");
                            savingsRow.appendChild(cellContentEval(savingsCell, currencyFormatter.format(investmentCompound), hasInvestment === false));
                            savingsCell = document.createElement("td");
                            savingsRow.appendChild(cellContentEval(savingsCell, getRateCalcRange(areaMinVal, areaMaxVal), isPriorYear === true));
                            savingsCell = document.createElement("td");
                            savingsRow.appendChild(cellContentEval(savingsCell, getRateCalcRange(fedMinVal, fedMaxVal), isPriorYear === true));
                            return savingsRow;
                        }, 
                        calcLocAmounts = function (income, investmentAmount, deductContribAmt, federalRates, fedrates, provinceRates, arearates, abatement) {
                            let fedSavingsAmt, areaSavingsAmt, 
                            getRefundAmount = function (income, investmentAmount, deductContribAmt, tax, abatement) {
                                let rateLoop, taxRates, lastRate, surtax, 
                                    maxlimit = 0, 
                                    currentIncome = income, 
                                    getSurtaxAdjust = function (taxRates, taxArr, currentIncome) {
                                        let surtaxloop, 
                                            adjustedThreshold = taxRates.threshold, 
                                            adjustedRate = 1;

                                        if (Object.prototype.hasOwnProperty.call(taxArr, "surtax") === true) {
                                            for (surtaxloop = 0; surtaxloop <= taxArr.surtax.length - 1; surtaxloop = surtaxloop + 1) {
                                                if (currentIncome >= taxArr.surtax[surtaxloop].threshold) {
                                                    adjustedRate = adjustedRate + taxArr.surtax[surtaxloop].rate;
                                                    if (taxRates.threshold > taxArr.surtax[surtaxloop].threshold && taxRates.threshold <= currentIncome) {
                                                        adjustedThreshold = taxArr.surtax[surtaxloop].threshold;
                                                    }
                                                }
                                            }
                                        }
                                        return {
                                            "rate": adjustedRate, 
                                            "threshold": adjustedThreshold
                                        };
                                    };

                                if (Object.prototype.hasOwnProperty.call(tax, "rates") === true) {
                                    for (rateLoop = tax.rates.length - 1; rateLoop >= 0; rateLoop = rateLoop - 1) {
                                        taxRates = tax.rates[rateLoop];
                                        surtax = getSurtaxAdjust(taxRates, tax, currentIncome);
                                        if (taxRates.threshold <= currentIncome && taxRates.threshold <= Math.max(0, currentIncome - deductContribAmt)) {
                                            maxlimit = (deductContribAmt + investmentAmount) * taxRates.rate * surtax.rate * abatement;
                                            break;
                                        } else if (taxRates.threshold < currentIncome - deductContribAmt) {
                                            maxlimit = (taxRates.threshold) * taxRates.rate * surtax.rate + (currentIncome - taxRates.threshold) * lastRate.rate * abatement;
                                            taxRates = lastRate;
                                            break;
                                        }
                                        lastRate = {
                                            "rate": taxRates.rate * surtax.rate,
                                            "threshold": taxRates.threshold
                                        };
                                    }
                                    return {
                                        "min": (deductContribAmt + investmentAmount) * tax.rates[0].rate * abatement, 
                                        "minrates": tax.rates[0],
                                        "max": maxlimit, 
                                        "maxrates": taxRates
                                    };
                                }
                                return {
                                    "min": 0, 
                                    "minrates": 0, 
                                    "max": 0, 
                                    "maxrates": 0
                                };
                            };

                            fedSavingsAmt = getRefundAmount(income, investmentAmount, deductContribAmt, federalRates, abatement);
                            if ($.inArray(fedSavingsAmt.maxrates, fedrates) === -1) {
                                fedrates.push(fedSavingsAmt.maxrates);
                            }
                            areaSavingsAmt = getRefundAmount(income, investmentAmount, deductContribAmt, provinceRates, 1);
                            if ($.inArray(areaSavingsAmt.maxrates, arearates) === -1) {
                                arearates.push(areaSavingsAmt.maxrates);
                            }
                            return {
                                "fed": {
                                    "rates": fedrates,
                                    "min": fedSavingsAmt.min, 
                                    "max": fedSavingsAmt.max
                                },
                                "area": {
                                    "rates": arearates,
                                    "min": areaSavingsAmt.min, 
                                    "max": areaSavingsAmt.max
                                }
                            };
                        }, 
                        zeroAdjust = function (firstVal, secondVal) {
                            let adjustedVal = firstVal - secondVal;

                            if (adjustedVal < 0) {
                                return 0;
                            }
                            return adjustedVal;
                        };

                    savingsBody.classList.add("text-right");
                    if (hasPriorSavings === true) {
                        savingsRow = document.createElement("tr");
                        if (hasPriorYrSaving === true) {
                            deductContribAmt = priorYrSavingAmt - priorYrSavingTransfer;
                            priorYear = currentYear;
                            priorIncome = income;
                            if (hasPriorYearSavingDiffIncome === true) {
                                priorIncome = zeroAdjust(priorYearSavingIncome, priorYearSavingDeduction);
                                priorYear = currentYear - 1;
                            }
                            juristictionArr = getRatesArr(federalName, incomeRates, pagelang);
                            federalRates = areaRates(juristictionArr, priorYear, startYear);
                            abatement = getAbatement(juristictionArr, abatementID, priorYear, startYear);
                            juristictionArr = getRatesArr(area, incomeRates, pagelang);
                            provinceRates = areaRates(juristictionArr, priorYear, startYear);
                            priorYearSavingData = calcLocAmounts(priorIncome, investmentAmount, deductContribAmt, federalRates, fedrates, provinceRates, arearates, abatement);
                            fedMinCumulative = priorYearSavingData.fed.min;
                            fedMaxCumulative = priorYearSavingData.fed.max;
                            areaMinCumulative = priorYearSavingData.area.min;
                            areaMaxCumulative = priorYearSavingData.area.max;
                            if (priorSavingYears > 1) {
                                amountCompound = zeroAdjust(priorSavingAmount, priorYrSavingAmt);
                                investmentCompound = priorSavingsInvest - priorYrSavingInvest;
                                savingsBody.appendChild(createSavingsTableBody(savingsRow, currentYear, priorSavingYears - 1, amountCompound, investmentCompound, 0, 0, 0, 0, 0, hasInvestment, true, false, false));
                                savingsRow = document.createElement("tr");
                            }
                            amountCompound = amountCompound + priorYrSavingAmt;
                            investmentCompound = investmentCompound + priorYrSavingInvest;
                            deductCumulative = deductContribAmt;
                            savingsBody.appendChild(createSavingsTableBody(savingsRow, currentYear - 1, priorSavingYears, amountCompound, investmentCompound, deductContribAmt, fedMinCumulative, fedMaxCumulative, areaMinCumulative, areaMaxCumulative, hasInvestment, false, hasPriorYrSaving, false));
                        } else {
                            amountCompound = priorSavingAmount;
                            investmentCompound = priorSavingsInvest;
                            savingsBody.appendChild(createSavingsTableBody(savingsRow, currentYear, priorSavingYears, amountCompound, investmentCompound, 0, 0, 0, 0, 0, hasInvestment, true, false, false));
                        }
                    }
                    if (amountCompound < maxContribution) {
                        if (loopYears >= priorYearMax + 1) {
                            loopYears = priorYearMax + 1;
                            maxContributeYear = loopYears;
                        }
                        juristictionArr = getRatesArr(federalName, incomeRates, pagelang);
                        federalRates = areaRates(juristictionArr, currentYear, startYear);
                        abatement = getAbatement(juristictionArr, abatementID, currentYear, startYear);
                        juristictionArr = getRatesArr(area, incomeRates, pagelang);
                        provinceRates = areaRates(juristictionArr, currentYear, startYear);
                        for (yearIncrement = priorSavingYears + 1; yearIncrement <= loopYears; yearIncrement = yearIncrement + 1) {
                            if (amountCompound + savingsAmount < maxContribution) {
                                deductContribAmt = savingsAmount - savingsTransferAmount;
                                amountCompound = amountCompound + savingsAmount;
                            } else {
                                deductContribAmt = ((savingsAmount - savingsTransferAmount) / savingsAmount) * (maxContribution - amountCompound);
                                if (amountCompound !== maxContribution) {
                                    maxContributeYear = yearIncrement;
                                }
                                amountCompound = maxContribution;
                            }
                            deductCumulative = deductCumulative + deductContribAmt;
                            investmentAmount = (investmentCompound + amountCompound) * investment;
                            investmentCompound = investmentCompound + investmentAmount;
                            saveAmountsObj = calcLocAmounts(income, investmentAmount, deductContribAmt, federalRates, fedrates, provinceRates, arearates, abatement);
                            fedMinCumulative = fedMinCumulative + saveAmountsObj.fed.min;
                            fedMaxCumulative = fedMaxCumulative + saveAmountsObj.fed.max;
                            areaMinCumulative = areaMinCumulative + saveAmountsObj.area.min;
                            areaMaxCumulative = areaMaxCumulative + saveAmountsObj.area.max;
                            savingsRow = document.createElement("tr");
                            savingsBody.appendChild(createSavingsTableBody(savingsRow, currentYear, yearIncrement, amountCompound, investmentAmount, deductContribAmt, saveAmountsObj.fed.min, saveAmountsObj.fed.max, saveAmountsObj.area.min, saveAmountsObj.area.max, hasInvestment, false, false, false));
                        }
                        savingsRow = document.createElement("tr");
                        savingsRow.setAttribute("class", "success text-right");
                        savingsBody.appendChild(createSavingsTableBody(savingsRow, currentYear, $("#savingsTable").data("total-header"), 0, investmentCompound, deductCumulative, fedMinCumulative, fedMaxCumulative, areaMinCumulative, areaMaxCumulative, hasInvestment, false, false, true));
                        return {
                            "tableContent": savingsBody,
                            "addedAmount": amountCompound, 
                            "investment": investmentCompound, 
                            "deductContribute": deductCumulative, 
                            "fedExempt": federalRates.exemption, 
                            "fedAmountMin": fedMinCumulative, 
                            "fedAmountMax": fedMaxCumulative, 
                            "priorYearSavings": priorYearSavingData, 
                            "fedRates": saveAmountsObj.fed.rates, 
                            "abatement": abatement,
                            "areaExempt": provinceRates.exemption, 
                            "areaAmountMin": areaMinCumulative, 
                            "areaAmountMax": areaMaxCumulative, 
                            "areaRates": saveAmountsObj.area.rates, 
                            "maxContributeYear": maxContributeYear, 
                            "yearssaved": loopYears
                        };
                    }
                };

                savingsTotals = generateSavingsTableData(prov.val(), $("#province").data("fed"), prov.data("id"), yearlyIncome(), savingYears(), savingsAmount(), savingsTransferAmount(), hasSavingInvestGrowth(), savingInterest(), hasPriorSavingsFHSA(), priorSavingYears(), priorSavingAmount(), priorSavingsInvestment, hasPriorTaxSavings(), priorYearSavingAmount(), priorYearSavingTransfer(), priorYearSavingInvest(), 
                    hasPriorYearSavingDiffIncome(), priorYearSavingIncome(), priorYearSavingDeduction(), priorYearMax, maxContribution, fhsaStartYear, currentYear, incomeRates, pagelang);
                if (yearlyIncome() <= savingsTotals.areaExempt && yearlyIncome() <= savingsTotals.fedExempt) {
                    $("[data-min-threshold=false]").removeClass("hidden");
                    $("[data-min-threshold=true]").addClass("hidden");
                    $("[data-zero-val]").addClass("hidden");
                } else {
                    $("[data-min-threshold=false]").addClass("hidden");
                    if ((savingsTotals.deductContribute === 0 && savingsTotals.investment === 0) || (savingsTotals.fedAmountMax === 0 && savingsTotals.areaAmountMax === 0)) {
                        $("[data-min-threshold=true]").addClass("hidden");
                        if (savingsAmount() === 0) {
                            $("[data-zero-val=false]").removeClass("hidden");
                            $("[data-zero-val=true]").addClass("hidden");
                        } else {
                            $("[data-zero-val=false]").addClass("hidden");
                            $("[data-zero-val=true]").removeClass("hidden");
                        }
                    } else {
                        $("[data-zero-val]").addClass("hidden");
                        if (hasPriorTaxSavings() === true) {
                            if (parseInt(savingsTotals.priorYearSavings.fed.min, 10) === parseInt(savingsTotals.priorYearSavings.fed.max, 10)) {
                                summaryTotal = $("#savingsTable").data("savings-text") + "<strong>" + currencyFormatter.format(savingsTotals.priorYearSavings.fed.max) + "</strong>";
                            } else {
                                summaryTotal = "<strong>" + currencyFormatter.format(savingsTotals.priorYearSavings.fed.min) + "</strong>" + $("#savingsTable").data("savings-range-text") + "<strong>" + currencyFormatter.format(savingsTotals.priorYearSavings.fed.max) + "</strong>";
                            }
                            $("[data-output=prior-fed-tax]", savingsformId).html(summaryTotal);
                            if (parseInt(savingsTotals.priorYearSavings.area.min, 10) === parseInt(savingsTotals.priorYearSavings.area.max, 10)) {
                                summaryTotal = $("#savingsTable").data("savings-text") + "<strong>" + currencyFormatter.format(savingsTotals.priorYearSavings.area.max) + "</strong>";
                            } else {
                                summaryTotal = "<strong>" + currencyFormatter.format(savingsTotals.priorYearSavings.area.min) + "</strong>" + $("#savingsTable").data("savings-range-text") + "<strong>" + currencyFormatter.format(savingsTotals.priorYearSavings.area.max) + "</strong>";
                            }
                            $("[data-output=prior-area-tax]", savingsformId).html(summaryTotal);
                            $("#currentYearSummary").removeClass("hidden");
                            $("#AllYearSummary").addClass("cnjnctn-col-40");
                            $("#savingsResultList").addClass("cnjnctn-type-and cnjnctn-xs");
                        } else {
                            $("#currentYearSummary").addClass("hidden");
                            $("#AllYearSummary").removeClass("cnjnctn-col-40");
                            $("#savingsResultList").removeClass("cnjnctn-type-and cnjnctn-xs");
                        }
                        if (parseInt(savingsTotals.fedAmountMin, 10) === parseInt(savingsTotals.fedAmountMax, 10)) {
                            summaryTotal = $("#savingsTable").data("savings-text") + "<strong>" + currencyFormatter.format(savingsTotals.fedAmountMax) + "</strong>";
                        } else {
                            summaryTotal = "<strong>" + currencyFormatter.format(savingsTotals.fedAmountMin) + "</strong>" + $("#savingsTable").data("savings-range-text") + "<strong>" + currencyFormatter.format(savingsTotals.fedAmountMax) + "</strong>";
                        }
                        $("[data-output=fed-tax]", savingsformId).html(summaryTotal);
                        $("[data-area-name=provincial-territorial]", savingsformId).html(prov.val());
                        if (parseInt(savingsTotals.areaAmountMin, 10) === parseInt(savingsTotals.areaAmountMax, 10)) {
                            summaryTotal = $("#savingsTable").data("savings-text") + "<strong>" + currencyFormatter.format(savingsTotals.areaAmountMax) + "</strong>";
                        } else {
                            summaryTotal = "<strong>" + currencyFormatter.format(savingsTotals.areaAmountMin) + "</strong>" + $("#savingsTable").data("savings-range-text") + "<strong>" + currencyFormatter.format(savingsTotals.areaAmountMax) + "</strong>";
                        }
                        $("[data-output=area-tax]", savingsformId).html(summaryTotal);
                        $("[data-output=saving-years]", savingsformId).html(savingsTotals.yearssaved);
                        if (savingsTotals.yearssaved === 1) {
                            $("[data-savings-year-range=true]", savingsformId).addClass("hidden");
                        } else {
                            $("[data-savings-year-range=true]", savingsformId).removeClass("hidden");
                        }
                        if (hasPriorSavingsFHSA() === true && hasPriorTaxSavings() === false) {
                            $("[data-show-prior=true]").removeClass("hidden");
                        } else {
                            $("[data-show-prior=true]").addClass("hidden");
                        }
                       if (document.getElementById("priorsaving-fhsa-false").checked || document.getElementById("priortaxsaving-false").checked) {
                            $("[data-show-prior=true]").removeClass("hidden");
                        } else {
                            $("[data-show-prior=true]").addClass("hidden");
                        }
                        currentTbody = document.getElementById("savingsTable").querySelector("tbody");
                        if (currentTbody !== null) {
                            currentTbody.remove();
                        }
                        document.getElementById("savingsTable").appendChild(savingsTotals.tableContent);
                        $("[data-min-threshold=true]").removeClass("hidden");
                    }
                }
                if (savingsTotals.addedAmount === maxContribution) {
                    $("#savingsThresholdData", savingsformId).removeClass("hidden");
                    $("#savingsThresholdYear", savingsformId).html(savingsTotals.maxContributeYear);
                    $("#savingsContributeTotal", savingsformId).html(currencyFormatter.format(savingsTotals.addedAmount));
                } else {
                    $("#savingsThresholdData", savingsformId).addClass("hidden");
                }
            };

            var currencyFormatter = new Intl.NumberFormat(pagelang + "-CA", {
                style: "currency", 
                currency: "CAD", 
                minimumFractionDigits: 0, 
                maximumFractionDigits: 0, 
                roundingPriority: "auto", 
                roundingMode: "trunc"
            }), 
            changeSavings = function (savingsVal) {
                if (parseInt(savingsVal, 10) < parseInt(document.getElementById("savingsTransferAmount").value, 10)) {
                    document.getElementById("savingsTransferAmount").value = savingsVal;
                    document.getElementById("savingsTransferAmountOutput").innerHTML = currencyFormatter.format(savingsVal);
                }
                return currencyFormatter.format(savingsVal);
            }, 
            changeSavingsTransfer = function (savingsTransferVal) {
                let savingsAmt = document.getElementById("savingsAmount").value;

                if (parseInt(savingsTransferVal, 10) > parseInt(savingsAmt, 10)) {
                    document.getElementById("savingsTransferAmount").value = savingsAmt;
                    return currencyFormatter.format(savingsAmt);
                }
                return currencyFormatter.format(savingsTransferVal);
            };

        currentYear = getCurrentYear(fhsaStartYear);
        priorContributeMax = getPriorContributeMax(fhsaStartYear, currentYear, priorYearMax, yearlyMaxContribution, maxContribution);
        initForms(fhsaStartYear, currentYear, priorYearMax, priorContributeMax, paymentformId, savingsformId);
        if (currentYear <= fhsaStartYear) {
            currentYear = fhsaStartYear + 1;
        }

        $(paymentformId).on("click vclick touchstart", "input[type=radio][name=hasPriorPaymentFHSA]", function () {
            if (hasPriorPaymentFHSA() === true) {
                $("#priorPaymentFHSAfields").removeClass("hidden");
                $("#priorPaymentYearsFHSA").attr("required", "required");
                $("#priorPaymentBalance").attr("required", "required");
                $("#priorPaymentAmountFHSA").attr("required", "required");
                    updatePriorPaymentYears();
                    updatePriorPaymentBalance();
                    updatePriorPaymentAmount();
            } else {
                $("#priorPaymentFHSAfields").addClass("hidden");
                $("#priorPaymentYearsFHSA").removeAttr("required");
                $("#priorPaymentBalance").removeAttr("required");
                $("#priorPaymentAmountFHSA").removeAttr("required");
            }
        });

        $(paymentformId).on("change", "#priorPaymentYearsFHSA", function () {
            if (priorSavingYears() === 0) {
                updatePriorSavingYears();
            }
        });

        $(paymentformId).on("change", "#priorPaymentBalance", function () {
            if (priorSavingBalance() === 0) {
                updatePriorSavingBalance();
            }
            if (this.value === 0) {
                $("#priorPaymentAmountFHSA").attr("min", 0);
            } else {
                $("#priorPaymentAmountFHSA").attr("min", 1);
            }
        });

        $(paymentformId).on("change", "#priorPaymentAmountFHSA", function () {
            if (priorSavingAmount() === 0) {
                updatePriorSavingAmount();
            }
        });

        $(paymentformId).on("click vclick touchstart", "#paymentresultsbtn", function (event) {
            event.preventDefault();
            let isFormValid = true, 
                parentElement = this.parentElement, 
                parentPreviousClassList = parentElement.previousElementSibling.classList;

            if (jQuery.validator && jQuery.validator !== "undefined") {
                isFormValid = $(paymentformId).valid();
            }

            if (isFormValid === true) {
                parentPreviousClassList.remove("wb-steps-error");
                $("#paymentresultsbtn").removeClass("btn-primary");
                $("#paymentresultsbtn").addClass("btn-default");
                $("#paymentresultsbtn").html($("#paymentresultsbtn").data("btn-activated"));
                updatePaymentResults(priorYearMax, maxContribution, paymentformId);
                $("#holdingsResults").removeClass("hidden");
            }

        });

        $(savingsformId).on("click vclick touchstart", "input[type=radio][name=hasPriorSavingFHSA]", function () {
            if (hasPriorSavingsFHSA() === true) {
                $("#priorSavingFHSAfields").removeClass("hidden");
                $("#priorSavingYearsFHSA").attr("required", "required");
                $("#priorSavingBalance").attr("required", "required");
                $("#priorSavingAmountFHSA").attr("required", "required");
                    updatePriorSavingYears();
                    updatePriorSavingBalance();
                    updatePriorSavingAmount();
            } else {
                $("#priorSavingFHSAfields").addClass("hidden");
                $("#priorSavingYearsFHSA").removeAttr("required");
                $("#priorSavingBalance").removeAttr("required");
                $("#priorSavingAmountFHSA").removeAttr("required");
            }
        });

        $(savingsformId).on("change", "#priorSavingYearsFHSA", function () {
            if (priorPaymentYears() === 0) {
                updatePriorPaymentYears();
            }
        });

        $(savingsformId).on("change", "#priorSavingBalance", function () {
            if (priorPaymentBalance() === 0) {
                updatePriorPaymentBalance();
            }
            if (this.value === 0) {
                $("#priorSavingAmountFHSA").attr("min", 0);
            } else {
                $("#priorSavingAmountFHSA").attr("min", 1);
            }
        });

        $(savingsformId).on("change", "#priorSavingAmountFHSA", function () {
            if (priorPaymentAmount() === 0) {
                updatePriorPaymentAmount();
            }
            $("#priorYearSavingAmount").attr("max", getContributeMax($(this).val()));
            $("#priorYearSavingTransfer").attr("max", getContributeMax($(this).val()));
        });

        $(savingsformId).on("click vclick touchstart", "input[type=radio][name=hasPriorTaxSaving]", function () {
            if (hasPriorTaxSavings() === true) {
                $("#priorTaxSavingfields").removeClass("hidden");
                $("#priorYearSavingAmount").attr("required", "required");
                $("#priorYearSavingTransfer").attr("required", "required");
            } else {
                $("#priorTaxSavingfields").addClass("hidden");
                $("#priorYearSavingAmount").removeAttr("required");
                $("#priorYearSavingTransfer").removeAttr("required");
            }
        });

        $(savingsformId).on("change", "#priorYearSavingAmount", function () {
            $("#priorYearSavingTransfer").attr("max", getContributeMax($(this).val()));
        });

        $(savingsformId).on("click vclick touchstart", "input[type=radio][name=hasSavingIncomeDiff]", function () {
            if (hasPriorYearSavingDiffIncome() === true) {
                $("#priorIncomeDiffFields").removeClass("hidden");
                $("#priorYearSavingIncome").attr("required", "required");
            } else {
                $("#priorIncomeDiffFields").addClass("hidden");
                $("#priorYearSavingIncome").removeAttr("required");
            }
        });

        $(savingsformId).on("click vclick touchstart", "input[type=radio][name=hasSavingInvestment]", function () {
            if (hasSavingInvestGrowth() === true) {
                $("#savingInvestPercentGroup").removeClass("hidden");
                $("#savingInterest").attr("required", "required");
            } else {
                $("#savingInvestPercentGroup").addClass("hidden");
                $("#savingInterest").removeAttr("required");
            }
        });

        $(savingsformId).on("click vclick touchstart", "#savingsresultsbtn", function (event) {
            event.preventDefault();
            let isFormValid = true, 
                parentElement = this.parentElement, 
                parentPreviousClassList = parentElement.previousElementSibling.classList;

            if (jQuery.validator && jQuery.validator !== "undefined") {
                isFormValid = $(savingsformId).valid();
            }

            if (isFormValid === true) {
                parentPreviousClassList.remove("wb-steps-error");
                $("#savingsresultsbtn").removeClass("btn-primary");
                $("#savingsresultsbtn").addClass("btn-default");
                $("#savingsresultsbtn").html($("#savingsresultsbtn").data("btn-activated"));
                updateSavingResults(incomeRates, currentYear, fhsaStartYear, priorYearMax, maxContribution, pagelang, savingsformId);
                $("#savingsResults").removeClass("hidden");
            }
        });
    </script>
    <script>
        //Code that binds the slider with the number input

        $(".range-input-group").each(function(e) {
            let inputNumber = jQuery("input[type=number]", this);
            let inputRange = jQuery("input[type=range]", this);

            $(inputRange).on("change input", function() {
                $(inputNumber).val($(this).val())
            });

            $(inputNumber).on("change input", function(){
                if ($(this).val() === "" || isNaN($(this).val())) {
                    $(inputRange).val(0);
                } else {
                    $(inputRange).val($(this).val());
                }
            });
        });
    </script>        
    <script>
        $(document).on("click", ".steps-wrapper div.buttons > :button", function () {
            let $form = $(this).parents("form:first");
            $form.find("legend.wb-steps-active").parents().prevAll().find("legend.panel-heading").addClass("prev-wb-step");
            $form.find("legend.wb-steps-active").parents().nextAll().find("legend.panel-heading").removeClass("prev-wb-step");
            $form.find("legend.wb-steps-active").removeClass("prev-wb-step").attr("tabindex", "0");
            $form.find("legend:not(.wb-steps-active)").attr("tabindex", "-1");
            //wrap with button
            $form.find("legend.wb-steps-active").parents().prevAll().find("legend.panel-heading").wrapInner("<button class=\"btn-link p-0 btn-lgnd\" type=\"button\"></button>");
            $form.find("fieldset legend.wb-steps-active").nextAll().addBack().find(".btn-lgnd").contents().unwrap();
            $form.find(".btn-lgnd .btn-lgnd").contents().unwrap();
        });
        $(document).on("click", ".prev-wb-step", function () {
            let $form = $(this).parents("form:first");
            $form.find(".wb-steps-active, legend.prev-wb-step").removeClass("wb-steps-active prev-wb-step");
            $form.find("legend + div.panel-body, .buttons").addClass("hidden");
            $form.find("legend.wb-steps-active").parents().nextAll().each(function () {});
            $(this).addClass("wb-steps-active").removeClass("prev-wb-step");
            $(this).parent().parent().find("legend + div.panel-body.hidden, .buttons").removeClass("hidden");
        });
    </script>
    <script>
        //Script that prevents second slider and input in well from exceeding first slider and input value
        // First set
        const rangeInput1 = document.getElementById("savingsAmountSld");
        const numberInput1 = document.getElementById("savingsAmount");
        numberInput1.value = rangeInput1.value;
    
        rangeInput1.addEventListener("input", function() {
            numberInput1.value = this.value;
            // Update Set 2 only if Set 1 value decreases
            if (parseInt(this.value) < parseInt(rangeInput2.value)) {
	        rangeInput2.value = this.value;
		numberInput2.value =this.value;
	    }
        });

        numberInput1.addEventListener("change", function() {
            rangeInput1.value = this.value;
            // Update Set 2 only if Set 1 value decreases
            if (parseInt(this.value) < parseInt(rangeInput2.value)) {
	        rangeInput2.value = this.value;
		numberInput2.value = this.value;
	    }
        });

        // Second set
        const rangeInput2 = document.getElementById('savingsTransferAmountSld');
        const numberInput2 = document.getElementById('savingsTransferAmount');
        numberInput2.value = rangeInput2.value;

        rangeInput2.addEventListener("input", function() {
            // Ensure Set 2 value doesn't exceed Set 1 value
            if (parseInt(this.value) > parseInt(rangeInput1.value)) {
                this.value = rangeInput1.value;
            }
            numberInput2.value = this.value;
        });

        numberInput2.addEventListener("change", function() {
            // Ensure Set 2 value doesn't exceed Set 1 value
            if (parseInt(this.value) > parseInt(rangeInput1.value)) {
                this.value = rangeInput1.value;
            }
            rangeInput2.value = this.value;
        });
    </script>
</body>
</html>
